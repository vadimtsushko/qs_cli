#SECTION :Продажи
---
set: СуммаПродажи
definition: Money(Sum({$<ТипДокумента={'Sales'}, ТипПериода={'Current'}>}Сумма),'# ##0,00')
label:Продажи руб.
comment: Сумма продаж в руб.
---
set: СуммаПродажиТыс
definition: Money(Sum({$<ТипДокумента={'Sales'}, ТипПериода={'Current'}>}Сумма)/1000,'# ##0,00')
label:Продажи тыс.руб.
comment: Сумма продаж в тыс. руб.
---
set: СуммаПродажиТысЧеки
definition: Money(Sum({$<ТипДокумента={'Sales'}, ТипПериода={'Current'}>}Сумма)/1000,'# ##0')
label:Продажи тыс.руб.
comment: Сумма продаж в тыс. руб.
---
set: СуммаПродажиТысНавигатор
definition: Money(Sum({$<$(Измерение(ГруппаИзмерений)), ТипДокумента={'Sales'}, ТипПериода={'Current'}>}Сумма)/1000,'# ##0,00')
label:Продажи тыс.руб.
comment: Сумма продаж в тыс. руб.
---
set: ПланПродаж
definition: Money(Sum({<_ФлагДействующаяДата={1},ТипДокумента={'SalePlan'},ТипПериода={'Current'}>} Сумма),'# ##0,00')
label:План Продаж, руб
comment: План Продаж (за неполный месяц)  руб
---
set: ПланПродажТыс
definition: Money(Sum({<_ФлагДействующаяДата={1},ТипДокумента={'SalePlan'},ТипПериода={'Current'}>} Сумма)/1000,'# ##0,00')
label:План Продаж тыс.руб.
comment: План Продаж (за неполный месяц) в тыс. руб.
---
set: ПланПродажПолный
definition: Money(Sum({<ТипДокумента={'SalePlan'},ТипПериода={'Current'}>} Сумма),'# ##0,00')
label: План Продаж за полный месяц, руб
comment: План Продаж (за полный месяц)  руб
---
set: ПланПродажПолныйТыс
definition: Money(Sum({<ТипДокумента={'SalePlan'},ТипПериода={'Current'}>} Сумма)/1000,'# ##0,00')
label: План Продаж за полный месяц, в тыс. руб.
comment: План Продаж (за полный месяц)  в тыс. руб.
---
set: ПФ_Продажи
definition: Money($(СуммаПродажи)/$(ПланПродаж),'# ##0,0%')
label:% вып. плана Продаж
comment: Факт отнесенный к плану по продажам
---
set: П_Ф_Продажи
definition: Money(($(СуммаПродажи)-$(ПланПродаж)),'# ##0,00')
label:∆ ПФ Продажи
comment: План минус факт по продажам, руб.
---
set: П_Ф_ПродажиТыс
definition: Money(($(СуммаПродажи)-$(ПланПродаж))/1000,'# ##0,00')
label:∆ П-Ф Продажи тыс. руб.
comment: План минус факт по продажам тыс. руб.
---
set: ПродажиПредГодРуб
definition: Money(sum({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},
				ТипПериода={'Год'}>}Сумма),'# ##0,00')
label:Продажи пред. (1) Год, руб.
comment: Cумма продажи за предыдущий год, руб.  
---
set: ПродажиПредГод
definition: Money(sum({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},
				ТипПериода={'Год'}>}Сумма)/1000,'# ##0,00')
label:Продажи пред. (1) Год, тыс. руб.
comment: Cумма продажи за предыдущий год тыс.руб.  
---
set: ПродажиПредГод2Руб
definition: Money((sum({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},
		ТипПериода={'Год-2'}>}Сумма)),'# ##0,00')
label:Продажи пред. (2) Год, руб.
comment: Cумма продажи за предпредыдущий год руб.
---
set: ПродажиПредГод2
definition: Money((sum({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},
		ТипПериода={'Год-2'}>}Сумма)/1000),'# ##0,00')
label:Продажи пред. (2) Год, тыс. руб.
comment: Cумма продажи за предпредыдущий год тыс.руб.
---
set: ПродажиПредГодДеньНедели
definition: Money(sum({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},
				ТипПериода={'ГодДеньНедели'}>}Сумма)/1000,'# ##0,00')
label:Продажи пред. (1) Год тот же день недели, тыс. руб.
comment: Cумма продажи за предыдущий год тот же день недели, тыс.руб.  
---
set: ПродажиПредГодДеньНеделиРуб
definition: Money(sum({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},
				ТипПериода={'ГодДеньНедели'}>}Сумма),'# ##0,00')
label:Продажи пред. (1) Год тот же день недели, руб.
comment: Cумма продажи за предыдущий год тот же день недели, руб.  
---
set: ПродажиПредГод2ДеньНедели
definition: Money(sum({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},
				ТипПериода={'Год2ДеньНедели'}>}Сумма)/1000,'# ##0,00')
label:Продажи пред. (2) Год тот же день недели, тыс.руб.
comment: Cумма продажи за предпредыдущий год тот же день недели, тыс.руб.  
---
set: ПродажиПредГод2ДеньНеделиРуб
definition: Money(sum({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},
				ТипПериода={'Год2ДеньНедели'}>}Сумма),'# ##0,00')
label:Продажи пред. (2) Год тот же день недели, руб.
comment: Cумма продажи за предпредыдущий год тот же день недели, руб.  
---
set: ПроцентПродажиПредГод
definition: Money($(СуммаПродажиТыс)/$(ПродажиПредГод),'# ##0,00%')
label:% изм.Продаж к пред. (1) Год
comment: Процент Продажи к предыдущему году
---
set: ПроцентПродажиПредГодНавигатор
definition: Money(Sum({$<ТипДокумента={'Sales'}, $(Измерение(ГруппаИзмерений)), ТипПериода={'Current'}>}Сумма) / 
	sum({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1}, $(Измерение(ГруппаИзмерений)), ТипПериода={'Год'}>}Сумма),'# ##0,00%')
label:% изм.Продаж к пред. (1) Год
comment: Процент Продажи к предыдущему году
---
set: ПроцентПродажиПредГод2
definition: Money($(СуммаПродажиТыс)/$(ПродажиПредГод2),'# ##0,00%')
label:% изм.Продаж к пред. (2) Год
comment: Процент Продажи к предпредыдущему году
---
set: СуммаРостаПродажиПредГод
definition: Money($(СуммаПродажиТыс)-$(ПродажиПредГод),'# ##0,00')
label:∆ изм. Продаж к пред. (1) Год
comment: Сумма роста Продажи к предыдущему году
---
set: СуммаРостаПродажиПредГод2
definition: Money($(СуммаПродажиТыс)-$(ПродажиПредГод2),'# ##0,00')
label:∆ изм. Продаж к пред. (2) Год
comment: Сумма роста Продажи к предпредыдущему году
---
set: ПроцентПродажиПредГодДеньНедели
definition: Money($(СуммаПродажиТыс)/$(ПродажиПредГодДеньНедели),'# ##0,00%')
label: % Продажи к пред. (1) Год тот же день недели, тыс.руб.
comment: Процент Продажи к предыдущему году тот же день недели тыс.руб.
---
set: ПроцентПродажиПредГод2ДеньНедели
definition: Money($(СуммаПродажиТыс)/$(ПродажиПредГод2ДеньНедели),'# ##0,00%')
label: % Продажи к пред. (2) Год тот же день недели, тыс.руб.
comment: Процент Продажи к предпредыдущему году тот же день недели тыс.руб.
---
set: СуммаРостаПродажиПредГодДеньНедели
definition: Money($(СуммаПродажиТыс)-$(ПродажиПредГодДеньНедели),'# ##0,00')
label: Сумма роста Продаж к пред. (1) Год тот же день недели, тыс.руб.
comment: Сумма роста Продажи к предыдущему году тот же день недели, тыс.руб.
---
set: СуммаРостаПродажиПредГод2ДеньНедели
definition: Money($(СуммаПродажиТыс)-$(ПродажиПредГод2ДеньНедели),'# ##0,00')
label: Сумма роста Продаж к пред. (2) Год тот же день недели тыс.руб.
comment: Сумма роста Продажи к предпредыдущему году тот же день недели тыс.руб.
---
set: ПродажиПредМесРуб
definition: Money(sum({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},
				ТипПериода={'ГодМесяц'}>}Сумма),'# ##0,00')
label: Продажи пред мес, руб.
comment: Cумма продажи за предыдущий мес руб. 
---
set: ПродажиПредМес
definition: Money(sum({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},
				ТипПериода={'ГодМесяц'}>}Сумма)/1000,'# ##0,00')
label: Продажи пред мес, тыс.руб.
comment: Cумма продажи за предыдущий мес тыс.руб.  
---
set: ПроцентПродажиПредМес
definition: Money($(СуммаПродажиТыс)/$(ПродажиПредМес),'# ##0,00%')
label: % Продажи к пред мес
comment: Процент Продажи к предыдущему месяцу
---
set: СуммаРостаПродажиПредМес
definition: Money($(СуммаПродажиТыс)-$(ПродажиПредМес),'# ##0,00')
label: Сумма роста Продаж к пред мес
comment: Сумма роста Продажи к предыдущему месяцу
---
set: ДоляСуммыПродажГруппы
definition: Money(Aggr( Sum({$<ТипДокумента={'Sales'},
	ТипПериода={'Current'}>} Сумма)/Sum({$<ТипДокумента={'Sales'},
	ТипПериода={'Current'}>} TOTAL <$(Измерение(ГруппаСклад))> Сумма), $(Измерение(ГруппаСклад)), $(Измерение(ГруппаКлассификатор))),'# ##0,00%')
label: Доля продаж в магазине
comment: Доля продаж товара в магазине
---
set: ДоляСуммыПродажСклад
definition: Money(Aggr( Sum({$<ТипДокумента={'Sales'},
	ТипПериода={'Current'}>} Сумма)/Sum({$<ТипДокумента={'Sales'},
	ТипПериода={'Current'}>} TOTAL <$(Измерение(ГруппаКлассификатор))> Сумма), $(Измерение(ГруппаКлассификатор)), $(Измерение(ГруппаСклад))),'# ##0,00%')
label: Доля продаж в группе товаров
comment: Доля продаж в группе товаров
---
set: ДоляСуммыПродажКомпании
definition: Money(Aggr( Sum({$<ТипДокумента={'Sales'},
	ТипПериода={'Current'}>} Сумма)/Sum({<Склад,ТипДокумента={'Sales'},
	ТипПериода={'Current'}>} TOTAL Сумма), $(Измерение(ГруппаСклад)), $(Измерение(ГруппаКлассификатор))),'# ##0,00%')
label: Доля продаж по компании
comment: Доля продаж товара по компании в целом
---
set: ДоляСуммыПродажКомпанииКонструктор
definition: Money(Aggr( Sum({$<ТипДокумента={'Sales'},
	ТипПериода={'Current'}>} Сумма)/Sum({<ТипДокумента={'Sales'},
	ТипПериода={'Current'}>} TOTAL Сумма), $(Измерение(ГруппаИзмерений)), $(Измерение(ГруппаИзмерений2))),'# ##0,00%')
label: Доля продаж по компании
comment: Доля продаж товара по компании в целом
---
set: СуммаПродажиПроверкаТыс
definition: Money(Sum({$<ТипДокумента={'TestDataSales'}, ТипПериода={'Current'}>}Сумма)/1000,'# ##0,00')
label:Продажи проверка тыс.руб.
comment: Сумма продаж проверка в тыс. руб.
---
set: СуммаПродажиРасхожденияТыс
definition: Money($(СуммаПродажиТыс) - $(СуммаПродажиПроверкаТыс),'# ##0,00')
label:Дельта проверка тыс.руб.
comment: Дельта продаж проверка в тыс. руб.
---
set: РейтингНоменклатурыПоКомпанииТОABC
definition: Min(РейтингНоменклатурыПоКомпанииТО)
label: Рейтинг продаж по компании
comment: Рейтинг продаж товара по компании в целом
---
set: РейтингНоменклатурыПоМагазинуТОABC
definition: Min(РейтингНоменклатурыПоМагазинуТО)
label: Рейтинг продаж по магазину
comment: Рейтинг продаж товара в рамках магазина
---
set: КоэффициентВариации
definition: Money(avg(_XyzНоменклатураКоэффВариацииЗаМесяц),'# ##0,00')
label: Коэффициент Вариации
comment: Коэффициент вариации (для расчета XYZ) средненедельный показатель за последние 120 дней


#SECTION :ПродажиКоличество

---
set: ПродажиКоличество
definition: Money(Sum({$<ТипДокумента ={'Sales'},ТипПериода={'Current'}>}Количество),'# ##0,0')
label:Кол Проданого товара, шт
comment: Количество проданного товара, шт
---
set: ПродажиКоличествоБезШкалыЛиквидности
definition: Money(Sum({$<ТипДокумента ={'Sales'},ШкалаЛиквидности,ТипПериода={'Current'}>}Количество),'# ##0,00')
label: Кол Продано, шт
comment: Количество проданного товара, шт
---
set: ДнейВПериоде
definition: Floor((Max({<_ФлагДействующаяДата={1}>} TOTAL Дата)-Min({<_ФлагДействующаяДата={1}>}  TOTAL Дата)+1)/3)
---
set: УсловиеПериод1
definition: Дата={">$(=Date(Max({<_ФлагДействующаяДата={1}>} TOTAL Дата)-$(ДнейВПериоде)))<=$(=Date(Max({<_ФлагДействующаяДата={1}>} TOTAL Дата)))"}
---
set: УсловиеПериод2
definition: Дата={">$(=Date(Max({<_ФлагДействующаяДата={1}>} TOTAL Дата)-$(ДнейВПериоде)*2))<=$(=Date(Max({<_ФлагДействующаяДата={1}>} TOTAL Дата)-$(ДнейВПериоде)))"}
---
set: УсловиеПериод3
definition: Дата={">$(=Date(Max({<_ФлагДействующаяДата={1}>} TOTAL Дата)-$(ДнейВПериоде)*3))<=$(=Date(Max({<_ФлагДействующаяДата={1}>} TOTAL Дата)-$(ДнейВПериоде)*2))"}
---
set: УсловиеПериод4
definition: Дата={">=$(=Date(Min({<_ФлагДействующаяДата={1}>} TOTAL Дата)))<=$(=Date(Max({<_ФлагДействующаяДата={1}>} TOTAL Дата)-$(ДнейВПериоде)*3))"}
---
set: ПродажиКоличествоПериод1
definition: Money(Sum({$<ТипДокумента={'Sales'},ТипПериода={'Current'},$(УсловиеПериод1)>}Количество),'# ##0')
---
set: ПродажиКоличествоПериод1Заголовок
definition: 'Продажи c '  & Min({<$(УсловиеПериод1)>} Дата) & ' по ' & Max({<$(УсловиеПериод1)>} Дата)
---
set: ПродажиКоличествоПериод2
definition: Money(Sum({$<ТипДокумента={'Sales'},ТипПериода={'Current'},$(УсловиеПериод2)>}Количество),'# ##0')
---
set: ПродажиКоличествоПериод2Заголовок
definition: 'Продажи c '  & Min({<$(УсловиеПериод2)>} Дата) & ' по ' & Max({<$(УсловиеПериод2)>} Дата)
---
set: ПродажиКоличествоПериод3
definition: Money(Sum({$<ТипДокумента={'Sales'},ТипПериода={'Current'},$(УсловиеПериод3)>}Количество),'# ##0')
---
set: ПродажиКоличествоПериод3Заголовок
definition: 'Продажи c '  & Min({<$(УсловиеПериод3)>} Дата) & ' по ' & Max({<$(УсловиеПериод3)>} Дата)
---
set: ПродажиКоличествоПериод4
definition: Money(Sum({$<ТипДокумента={'Sales'},ТипПериода={'Current'},$(УсловиеПериод4)>}Количество),'# ##0')
---
set: ПродажиКоличествоПериод4Заголовок
definition: 'Продажи c '  & Min({<$(УсловиеПериод4)>} Дата) & ' по ' & Max({<$(УсловиеПериод4)>} Дата)
---
set: УсловиеПоказаПериод4 
definition: Max(Дата)-Min(Дата)>3 AND Mod(Max(Дата)-Min(Дата)+1,3)
---
set: ПродажиКоличествоПредМес
definition: Money(sum({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},
				ТипПериода={'ГодМесяц'}>}Количество),'# ##0,00')
label: Продажи количество пред мес
comment: Количество продано за предыдущий мес  
---
set: ПроцентПродажиКоличествоПредМес
definition: Money($(ПродажиКоличество)/$(ПродажиКоличествоПредМес),'# ##0,00%')
label: % Количество продано к пред мес
comment: Процент Количество проданных к предыдущему месяцу
---
set: СуммаРостаПродажиКоличествоПредМес
definition: Money($(ПродажиКоличество)-$(ПродажиКоличествоПредМес),'# ##0,00')
label: ∆ изм. Количество продано к пред мес
comment: Сумма роста Количество продано к предыдущему месяцу
---
set: ПродажиКоличествоПредГод
definition: Money(sum({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},
				ТипПериода={'Год'}>}Количество),'# ##0')
label: Продажи количество пред. (1) Год, шт
comment: Количество продано за предыдущий год, шт
---
set: ПроцентПродажиКоличествоПредГод
definition: Money($(ПродажиКоличество)/$(ПродажиКоличествоПредГод),'# ##0,00%')
label: % Количество продано к пред. (1) Год
comment: Процент Количество проданных к предыдущему году
---
set: СуммаРостаПродажиКоличествоПредГод
definition: Money($(ПродажиКоличество)-$(ПродажиКоличествоПредГод),'# ##0,00')
label:∆ изм. Количество продано к пред. (1) Год, шт
comment: Сумма роста Количество продано к предыдущему году, шт
---
set: ПродажиКоличествоПредГод2
definition: Money(sum({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},
				ТипПериода={'Год-2'}>}Количество),'# ##0,00')
label: Продажи количество пред. (2) Год, шт
comment: Количество продано за предпредыдущий год, шт
---
set: ПроцентПродажиКоличествоПредГод2
definition: Money($(ПродажиКоличество)/$(ПродажиКоличествоПредГод2),'# ##0,00%')
label: % Количество продано к пред. (2) Год
comment: Процент Количество проданных к предпредыдущему году
---
set: СуммаРостаПродажиКоличествоПредГод2
definition: Money($(ПродажиКоличество)-$(ПродажиКоличествоПредГод2),'# ##0,00')
label:∆ изм. Количество продано к пред. (2) Год, шт
comment: Сумма роста Количество продано к предпредыдущему году, шт
---
set: ПродажиКоличествоПредГодДеньНедели
definition: Money(sum({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},
				ТипПериода={'ГодДеньНедели'}>}Количество),'# ##0,00')
label: Продажи количество пред. (1) Год тот же день недели, шт
comment: Количество продано за предыдущий год, шт
---
set: ПроцентПродажиКоличествоПредГодДеньНедели
definition: Money($(ПродажиКоличество)/$(ПродажиКоличествоПредГодДеньНедели),'# ##0,00%')
label: % Количество продано к пред. (1) Год тот же день недели
comment: Процент Количество проданных к предыдущему году тот же день недели
---
set: СуммаРостаПродажиКоличествоПредГодДеньНедели
definition: Money($(ПродажиКоличество)-$(ПродажиКоличествоПредГодДеньНедели),'# ##0,00')
label:∆ изм. Количество продано к пред. (1) Год тот же день недели, шт
comment: Сумма роста Количество продано к предыдущему году тот же день недели, шт
---
set: ПродажиКоличествоПредГод2ДеньНедели
definition: Money(sum({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},
				ТипПериода={'Год2ДеньНедели'}>}Количество),'# ##0,00')
label: Продажи количество пред. (2) Год тот же день недели, шт
comment: Количество продано за предпредыдущий год тот же день недели, шт
---
set: ПроцентПродажиКоличествоПредГод2ДеньНедели
definition: Money($(ПродажиКоличество)/$(ПродажиКоличествоПредГод2ДеньНедели),'# ##0,00%')
label: % Количество продано к пред. (2) Год тот же день недели
comment: Процент Количество проданных к предпредыдущему году тот же день недели
---
set: СуммаРостаПродажиКоличествоПредГод2ДеньНедели
definition: Money($(ПродажиКоличество)-$(ПродажиКоличествоПредГод2ДеньНедели),'# ##0,00')
label:∆ изм. Количество продано к пред. (2) Год тот же день недели, шт
comment: Сумма роста Количество продано к предпредыдущему году тот же день недели, шт
---

#SECTION :ВаловаяПрибыль
---
set: СуммаВП
definition: Money(Sum({$<ТипДокумента = {'Sales'},ТипПериода={'Current'}>} ВП),'# ##0,00')
label: ВП, руб
comment: Валовая прибыль с НДС, руб.
---
set: СуммаВПТыс
definition: Money($(СуммаВП)/1000,'# ##0,00')
label: ВП, тыс.руб.
comment: Валовая прибыль в тыс.руб.
---
set: СуммаВПТысЧеки
definition: Money($(СуммаВП)/1000,'# ##0,00')
label: ВП, тыс.руб.
comment: Валовая прибыль в тыс.руб.
---
set: ПланВП
definition: Money(Sum({<_ФлагДействующаяДата={1},ТипДокумента={'SalePlan'},ТипПериода={'Current'}>} ВП),'# ##0,00')
label: План ВП, руб
comment: План валовой прибыли (за неполный месяц) руб
---
set: ПланВПТыс
definition: Money(Sum({<_ФлагДействующаяДата={1},ТипДокумента={'SalePlan'},ТипПериода={'Current'}>} ВП)/1000,'# ##0,00')
label: План ВП, тыс.руб.
comment: План валовой прибыли (за неполный месяц) тыс. руб.
---
set: ПланВППолный
definition: Money(Sum({<ТипДокумента={'SalePlan'},ТипПериода={'Current'}>} ВП),'# ##0,00')
label: План ВП полный месяц, руб
comment: План валовой прибыли (за полный месяц), руб
---
set: ПланВППолныйТыс
definition: Money(Sum({<ТипДокумента={'SalePlan'},ТипПериода={'Current'}>} ВП)/1000,'# ##0,00')
label: План ВП полный месяц, тыс.руб.
comment: План валовой прибыли (за полный месяц) тыс. руб.
---
set: ПФ_ВП
definition: Money($(СуммаВП)/$(ПланВП),'# ##0,0%')
label:% вып. плана ВП
comment: Факт отнесенный к плану по валовой прибыли
---
set: П_Ф_ВП
definition: Money($(СуммаВП)-$(ПланВП),'# ##0,0')
label:∆ ПФ ВП
comment: Факт отнесенный к плану по валовой прибыли
---
set: П_Ф_ВПТыс
definition: Money(($(СуммаВП)-$(ПланВП))/1000,'# ##0,0')
label:∆ П-Ф ВП, тыс.руб.
comment: Факт отнесенный к плану по валовой прибыли, тыс. руб.
---
set: ВППредГод
definition: Money((sum({<ТипДокумента = {'Sales'},
		_ФлагДействующаяДата={1},ТипПериода={'Год'}>}ВП)/1000),'# ##0,00')
label: ВП пред год, тыс.руб.
comment: Валовая прибыль за в предыдущий год тыс.руб.
---
set: ПроцентВППредГод
definition: Money($(СуммаВПТыс)/$(ВППредГод),'# ##0,00%')
label:% изм. ВП к пред. (1) Год
comment: Процент валовой прибыли к предыдущему году
---
set: СуммаРостаВППредГод
definition: Money($(СуммаВПТыс)-$(ВППредГод),'# ##0,00')
label:∆ изм. ВП. к пред. (1) Год, тыс. руб.
comment: Сумма роста валовой прибыли к предыдущему году
---
set: ВППредГод2
definition: Money((sum({<ТипДокумента = {'Sales'},
		_ФлагДействующаяДата={1},ТипПериода={'Год-2'}>}ВП)/1000),'# ##0,00')
label: ВП пред. (2) Год, тыс.руб.
comment: Валовая прибыль за вычетом себестоимости и НДС за предпредыдущий год тыс.руб.
---
set: ПроцентВППредГод2
definition: Money($(СуммаВПТыс)/$(ВППредГод2),'# ##0,00%')
label:% изм. ВП к пред. (2) Год
comment: Процент валовой прибыли к предпредыдущему году
---
set: СуммаРостаВППредГод2
definition: Money($(СуммаВПТыс)-$(ВППредГод2),'# ##0,00')
label:∆ изм. ВП к пред. (2) Год, тыс. руб.
comment: Сумма роста валовой прибыли к предпредыдущему году
---
set: ВППредГодДеньНедели
definition: Money((sum({<ТипДокумента = {'Sales'},
		_ФлагДействующаяДата={1},ТипПериода={'Год'}>}ВП)/1000),'# ##0,00')
label: ВП пред год тот же день недели, тыс.руб.
comment: Валовая прибыль за в предыдущий год тот же день недели, тыс.руб.
---
set: ПроцентВППредГодДеньНедели
definition: Money($(СуммаВПТыс)/$(ВППредГодДеньНедели),'# ##0,00%')
label:% изм. ВП к пред. (1) Год тот же день недели
comment: Процент валовой прибыли к предыдущему году тот же день недели
---
set: СуммаРостаВППредГодДеньНедели
definition: Money($(СуммаВПТыс)-$(ВППредГодДеньНедели),'# ##0,00')
label:∆ изм. ВП. к пред. (1) Год тот же день недели, тыс. руб.
comment: Сумма роста валовой прибыли к предыдущему году тот же день недели
---
set: ВППредГод2ДеньНедели
definition: Money((sum({<ТипДокумента = {'Sales'},
		_ФлагДействующаяДата={1},ТипПериода={'Год-2'}>}ВП)/1000),'# ##0,00')
label: ВП пред. (2) Год тот же день недели, тыс.руб.
comment: Валовая прибыль за вычетом себестоимости и НДС за предпредыдущий год тот же день недели, тыс.руб.
---
set: ПроцентВППредГод2ДеньНедели
definition: Money($(СуммаВПТыс)/$(ВППредГод2ДеньНедели),'# ##0,00%')
label:% изм. ВП к пред. (2) Год тот же день недели
comment: Процент валовой прибыли к предпредыдущему году тот же день недели
---
set: СуммаРостаВППредГод2ДеньНедели
definition: Money($(СуммаВПТыс)-$(ВППредГод2ДеньНедели),'# ##0,00')
label:∆ изм. ВП к пред. (2) Год тот же день недели, тыс. руб.
comment: Сумма роста валовой прибыли к предпредыдущему году тот же день недели
---
set: ВППредМес
definition: Money((sum({<ТипДокумента = {'Sales'},
		_ФлагДействующаяДата={1},ТипПериода={'ГодМесяц'}>}ВП)/1000),'# ##0,00')
label: ВП пред месяц, тыс.руб.
comment: Валовая прибыль за вычетом себестоимости и НДС за предыдущий месяц тыс.руб.
---
set: ПроцентВППредМес
definition: Money($(СуммаВПТыс)/$(ВППредМес),'# ##0,00%')
label: % ВП к пред месяцу
comment: Процент валовой прибыли к предыдущему месяцу
---
set: СуммаРостаВППредМес
definition: Money($(СуммаВПТыс)-$(ВППредМес),'# ##0,00')
label: ∆ изм. ВП к пред месяцу
comment: Сумма роста валовой прибыли к предыдущему месяцу
---
set: ДоляСуммыНаценкиГруппы
definition: Money(Aggr( Sum({$<ТипДокумента={'Sales'},
	ТипПериода={'Current'}>} ВП)/Sum({$<ТипДокумента={'Sales'},
	ТипПериода={'Current'}>} TOTAL <$(Измерение(ГруппаСклад))> ВП), $(Измерение(ГруппаСклад)), $(Измерение(ГруппаКлассификатор))),'# ##0,00%')
label: Доля ВП группы по магазину
comment: Доля валовой прибыли группы товара по магазину
---
set: ДоляСуммыНаценкиСклад
definition: Money(Aggr( Sum({$<ТипДокумента={'Sales'},
	ТипПериода={'Current'}>} ВП)/Sum({$<ТипДокумента={'Sales'},
	ТипПериода={'Current'}>} TOTAL <$(Измерение(ГруппаКлассификатор))> ВП), $(Измерение(ГруппаКлассификатор)), $(Измерение(ГруппаСклад))),'# ##0,00%')
label: Доля ВП склада по группе
comment: Доля валовой прибыли склада по группе товаров
---
set: ДоляСуммыНаценкиКомпании
definition: Money(Aggr( Sum({$<ТипДокумента={'Sales'},
	ТипПериода={'Current'}>} ВП)/Sum({<Склад,ТипДокумента={'Sales'},
	ТипПериода={'Current'}>} TOTAL ВП), $(Измерение(ГруппаСклад)), $(Измерение(ГруппаКлассификатор))),'# ##0,00%')
label: Доля ВП по компании
comment: Доля валовой прибыли по компании в целом
---
set: СуммаНаценкиПроверкаТыс
definition: Money(Sum({$<ТипДокумента={'TestDataSales'}, ТипПериода={'Current'}>}ВП)/1000,'# ##0,00')
label:ВП проверка тыс.руб.
comment: Сумма валовой прибыли проверка в тыс. руб.
---
set: СуммаНаценкиРасхожденияТыс
definition: Money($(СуммаВПТыс) - $(СуммаНаценкиПроверкаТыс),'# ##0,00')
label:Дельта ВП тыс.руб.
comment: Дельта валовой прибыли проверка в тыс. руб.

#SECTION :РентабельностьВП


---
set: ПрцРентВП
definition: Money(($(СуммаВП)/$(СуммаПродажи)),'# ##0,00%')
label: % Маржи
comment: % Маржи
---
set: ПланРентВП
definition: Money(($(ПланВП)/$(ПланПродаж)),'# ##0,00%')
label: План по % Маржи
comment: План по %  Маржи
---
set: ПланРентВППолный
definition: Money(($(ПланВППолный)/$(ПланПродажПолный)),'# ##0,00%')
label: План по % Маржи полный месяц
comment: План по % Маржи полный месяц
---
set: ПФРентВП
definition: Money(($(ПрцРентВП)/$(ПланРентВП)),'# ##0,00%')
label: ПФ % Маржи
comment: ПФ % Маржи
---
set: П_Ф_РентВП
definition: Money(($(ПланРентВП)-$(ПрцРентВП)),'# ##0,00%')
label: П-Ф % Маржи
comment: П-Ф % Маржи
---
set:РентВППредГод
definition: Money(($(ВППредГод)/$(ПродажиПредГод)),'# ##0,00%')
label: % Маржи пред. (1) Год
comment: % Маржи за предыдущий год
---
set: ПроцентРентВППредГод
definition: Money($(ПрцРентВП)/$(РентВППредГод),'# ##0,00%')
label: % изм. % Маржи к пред. (1) Год
comment: Процент Маржи к предыдущему году
---
set: СуммаРостаРентВППредГод
definition: Money($(ПрцРентВП)-$(РентВППредГод),'# ##0,00%')
label: ∆ изм. % Маржи к пред. (1) Год
comment: сумма изм % Маржи к предыдущему году
---
set: РентВППредГод2
definition: Money(($(ВППредГод2)/$(ПродажиПредГод2)),'# ##0,00%')
label: % Маржи пред. (2) Год
comment: % Маржи за предпредыдущий год
---
set: ПроцентРентВППредГод2
definition: Money($(ПрцРентВП)/$(РентВППредГод2),'# ##0,00%')
label: % изм. % Маржи к пред. (2) Год
comment: Процент изм. % Маржи к предыдущему году
---
set: СуммаРостаРентВППредГод2
definition: Money($(ПрцРентВП)-$(РентВППредГод2),'# ##0,00%')
label: ∆ изм. % Маржи к пред. (2) Год
comment: сумма изм. % Маржи к предпредыдущему году
---
set:РентВППредГодДеньНедели
definition: Money(($(ВППредГод)/$(ПродажиПредГодДеньНедели)),'# ##0,00%')
label: % Маржи пред. (1) Год
comment: % Маржи за предыдущий год
---
set: ПроцентРентВППредГодДеньНедели
definition: Money($(ПрцРентВП)/$(РентВППредГодДеньНедели),'# ##0,00%')
label: % изм. % Маржи к пред. (1) Год
comment: Процент изменения % Маржи к предыдущему году
---
set: СуммаРостаРентВППредГодДеньНедели
definition: Money($(ПрцРентВП)-$(РентВППредГодДеньНедели),'# ##0,00%')
label: ∆ изм. % Маржи к пред. (1) Год
comment: Сумма изм % Маржи к предыдущему году
---
set: РентВППредГод2ДеньНедели
definition: Money(($(ВППредГод2)/$(ПродажиПредГод2ДеньНедели)),'# ##0,00%')
label: % Маржи пред. (2) Год
comment: % Маржи за предпредыдущий год
---
set: ПроцентРентВППредГод2ДеньНедели
definition: Money($(ПрцРентВП)/$(РентВППредГод2ДеньНедели),'# ##0,00%')
label: % изм. % Маржи к пред. (2) Год
comment: Процент  изм. % Маржи к предыдущему году
---
set: СуммаРостаРентВППредГод2ДеньНедели
definition: Money($(ПрцРентВП)-$(РентВППредГод2ДеньНедели),'# ##0,00%')
label: ∆ изм. % Маржи к пред. (2) Год
comment: Сумма изм. % Маржи к предпредыдущему году
---
set: РентВППредМес
definition: Money(($(ВППредМес)/$(ПродажиПредМес)),'# ##0,00%')
label: % Маржи пред месяц
comment: % Маржи за предпредыдущий месяц
---
set: ПроцентРентВППредМес
definition: Money($(ПрцРентВП)/$(РентВППредМес),'# ##0,00%')
label: % изм. % Маржи к пред. месяцу
comment: Процент  изм. % Маржи к предыдущему месяцу
---
set: СуммаРостаРентВППредМес
definition: Money($(ПрцРентВП)-$(РентВППредМес),'# ##0,00%')
label: ∆ изм. % Маржи к пред месяцу
comment: Сумма изм. % Маржи к предпредыдущему месяцу

#SECTION :ПроцентНаценка
---
set: ПрцНаценки
definition: Money(($(СуммаВП)/$(УчСебестоимостьПолный)),'# ##0,00%')
label: % Наценки
comment: % Наценки
---
set: ПрцНаценкиЧеки
definition: Money(($(СуммаВП)/$(УчСебестоимостьПолный)),'# ##0%')
label: % Наценки
comment: % Наценки
---
set: ПрцНаценкиПредГод
definition: Money(($(ВППредГод)/$(УчСебестоимостьПолныйПредГод)),'# ##0,00%')
label: % Наценки пред.(1) Год
comment: % Наценки за предыдущий год
---
set: ПроцентПрцНаценкиПредГод
definition: Money($(ПрцНаценки)/$(ПрцНаценкиПредГод),'# ##0,00%')
label: % изм. Наценки к пред.(1) Год
comment: Процент Наценки к предыдущему году
---
set: СуммаРостаПрцНаценкиПредГод
definition: Money($(ПрцНаценки)-$(ПрцНаценкиПредГод),'# ##0,00%')
label: ∆ изм. Наценки к пред.(1) Год
comment: Сумма изм Наценки к предыдущему году
---
set: ПрцНаценкиПредМесяц
definition: Money(($(ВППредМес)/$(УчСебестоимостьПолныйПредМесяц)),'# ##0,00%')
label: % Наценки пред месяц
comment: % Наценки за предыдущий месяц
---
set: ПроцентПрцНаценкаПредМес
definition: Money($(ПрцНаценки)/$(ПрцНаценкиПредМесяц),'# ##0,00%')
label: % Наценки к пред месяцу
comment: Процент Наценки к предыдущему месяцу
---
set: СуммаРостаПрцНаценкаПредМес
definition: Money($(ПрцНаценки)-$(ПрцНаценкиПредМесяц),'# ##0,00%')
label: ∆ изм. Наценки к пред месяцу
comment: Сумма изм Наценки к предыдущему месяцу
---
set: ПрцНаценкиПредГод2
definition: Money(($(ВППредГод2)/$(УчСебестоимостьПолныйПредГод2)),'# ##0,00%')
label: % Наценки пред.(2) Год
comment: % Наценки за предпредыдущий год
---
set: ПроцентПрцНаценкиПредГод2
definition: Money($(ПрцНаценки)/$(ПрцНаценкиПредГод2),'# ##0,00%')
label: % изм. Наценки к пред.(2) Год
comment: Процент Наценки к предпредыдущему году
---
set: СуммаРостаПрцНаценкиПредГод2
definition: Money($(ПрцНаценки)-$(ПрцНаценкиПредГод2),'# ##0,00%')
label: ∆ изм. Наценки к пред.(2) Год
comment: Сумма изм Наценки к предпредыдущему году
---
set: ПрцНаценкиПредГодДеньНедели
definition: Money(($(ВППредГод)/$(УчСебестоимостьПолныйПредГодДеньНедели)),'# ##0,00%')
label: % Наценки пред.(1) Год тот же день недели
comment: % Наценки за предыдущий год тот же день недели
---
set: ПроцентПрцНаценкиПредГодДеньНедели
definition: Money($(ПрцНаценки)/$(ПрцНаценкиПредГодДеньНедели),'# ##0,00%')
label: % изм. Наценки к пред.(1) Год тот же день недели
comment: Процент Наценки к предыдущему году тот же день недели
---
set: СуммаРостаПрцНаценкиПредГодДеньНедели
definition: Money($(ПрцНаценки)-$(ПрцНаценкиПредГодДеньНедели),'# ##0,00%')
label: ∆ изм. Наценки к пред.(1) Год тот же день недели
comment: Сумма изм Наценки к предыдущему году тот же день недели
---
set: ПрцНаценкиПредГод2ДеньНедели
definition: Money(($(ВППредГод2)/$(УчСебестоимостьПолныйПредГод2ДеньНедели)),'# ##0,00%')
label: % Наценки пред.(2) Год тот же день недели
comment: % Наценки за предпредыдущий год тот же день недели
---
set: ПроцентПрцНаценкиПредГод2ДеньНедели
definition: Money($(ПрцНаценки)/$(ПрцНаценкиПредГод2ДеньНедели),'# ##0,00%')
label: % изм. Наценки к пред.(2) Год тот же день недели
comment: Процент Наценки к предпредыдущему году тот же день недели
---
set: СуммаРостаПрцНаценкиПредГод2ДеньНедели
definition: Money($(ПрцНаценки)-$(ПрцНаценкиПредГод2ДеньНедели),'# ##0,00%')
label: ∆ изм. Наценки к пред.(2) Год тот же день недели
comment: Сумма изм Наценки к предпредыдущему году тот же день недели
---
set: ПланПрцНаценка
definition: Money($(ПланПродажТыс)/($(ПланПродажТыс)-$(ПланВПТыс))-1,'# ##0,00%')
label: План по % Наценки 
comment: План по % Наценки 
---
set: ПланПрцНаценкаПолный
definition: Money($(ПланПродажПолныйТыс)/($(ПланПродажПолныйТыс)-$(ПланВППолныйТыс))-1,'# ##0,00%')
label: План по % Наценки полный месяц
comment: План по % Наценки полный месяц
---
set: ПФПрцНаценка
definition: Money($(ПрцНаценки)/$(ПланПрцНаценка),'# ##0,0%')
label: ПФ % Наценки
comment: ПФ % Наценки
---
set: П_Ф_ПрцНаценка
definition: Money($(ПрцНаценки)-$(ПланПрцНаценка),'# ##0,0%')
label: ∆ П-Ф % Наценки
comment: П-Ф % Наценки

#SECTION :ОстаткиКоличество
---
set: ОстаткиКоличествоСреднее
definition: Money((Sum({$<ТипДокумента = {'OnHandSum'},$(СбросФильтраПоОстаткам),ТипПериода={'Current'}>} Количество) 
	/ $(КоличествоДней)),'# ##0,00')
label:Среднедневные Остатки за период, шт.
comment: Остатки среднее количество, шт

#SECTION :ОстаткиКоличествоНаКонецПериода

---
set: ОстатокШтукНаКонецПериода_Формула
definition: Sum({<ТипПериода={'Current'},ТипДокумента={'OnHandEoM'},$(СбросФильтраПоОстаткам),Дата={"$(=Max({<$(СбросФильтраПоОстаткам),_ФлагДействующаяДата={1}>} Дата))"}>} Количество)
---
set: ОстатокШтукНаКонецПериода
definition: Money($(ОстатокШтукНаКонецПериода_Формула),'# ##0,00')
label:Остатки на конец периода, шт
comment: Складские остатки в штуках на конец периода, шт
---
set: ОстатокШтукНаКонецМесяца
definition: Money(Sum({<ТипПериода={'Current'},ТипДокумента={'OnHandEoM'},$(СбросФильтраПоОстаткам)>} Количество),'# ##0,00')
label:Остатки на конец месяца, шт
comment: Складские остатки в штуках на конец месяца, шт
---
set: ОстатокСебестоимостьНаКонецПериода_Формула
definition: Sum({<ТипПериода={'Current'},ТипДокумента={'OnHandEoM'},$(СбросФильтраПоОстаткам),Дата={"$(=Max({<$(СбросФильтраПоОстаткам),_ФлагДействующаяДата={1}>} Дата))"}>} Себестоимость)
---
set: ОстатокСебестоимостьНаКонецПериода
definition: Money($(ОстатокСебестоимостьНаКонецПериода_Формула),'# ##0,00')
label: Остатки по себестоимости, руб
comment: Складские остатки по себестоимости на конец периода, руб
---
set: ОстатокСебестоимостьНаКонецПериодаТыс
definition: Money($(ОстатокСебестоимостьНаКонецПериода_Формула)/1000,'# ##0,00')
label: Остатки по себестоимости на конец, тыс.руб.
comment: Складские остатки по себестоимости на конец периода, тыс.руб.
---
set: ОстатокСебестоимостьНаКонецПериодаТысМесяц
definition: Money(fabs(Aggr(Sum({<ТипПериода={'Current'},ТипДокумента={'OnHandEoM'},$(СбросФильтраПоОстаткам)>} Себестоимость)/1000,ГодМесяц,ШкалаЛиквидностиИсторическая)),'# ##0,00')
label: Остатки по себестоимости, тыс.руб.
comment: Складские остатки по себестоимости на конец месяца, тыс.руб.
---
set: ОстатокСебестоимостьНаКонецМесяца
definition: Money(Sum({<ТипПериода={'Current'},ТипДокумента={'OnHandEoM'},$(СбросФильтраПоОстаткам)>} Себестоимость)/1000,'# ##0,00')
label: Остатки в СЦ на конец месяца, тыс.руб.
comment: Складские остатки в СЦ на конец месяца, тыс.руб.
---
set: ОстатокСебестоимостьБезТранспортныхНаКонецПериода_Формула
definition: Sum({<ТипПериода={'Current'},ТипДокумента={'OnHandEoM'},$(СбросФильтраПоОстаткам),Дата={"$(=Max({<$(СбросФильтраПоОстаткам),_ФлагДействующаяДата={1}>} Дата))"}>} СебестоимостьБезТранспортных)
---
set: ОстатокСебестоимостьБезТранспортныхНаКонецПериодаТыс
definition: Money($(ОстатокСебестоимостьБезТранспортныхНаКонецПериода_Формула)/1000,'# ##0,00')
label: Остатки в ЗЦ, тыс.руб.
comment: Складские остатки в ЗЦ на конец периода, тыс.руб.
---
set: ОстатокСебестоимостьБезТранспортныхМесяц
definition: Money(Sum({<ТипПериода={'Current'},ТипДокумента={'OnHandEoM'},$(СбросФильтраПоОстаткам)>} СебестоимостьБезТранспортных)/1000,'# ##0,00')
label: Остатки в ЗЦ на конец месяца, тыс.руб.
comment: Складские остатки в ЗЦ на конец месяца, тыс.руб.
---
set: ТранспортныеМесяц
definition: Money(($(УчСебестоимостьПолный)-$(УчСебестоимостьБезТранспортныхПолный))/1000,'# ##0,00')
label: Расходы на товарный транспорт, тыс.руб.
comment: Расходы на товарный транспорт, тыс.руб.
#SECTION :ОстаткиНаКонецДня
---
set: ОстатокШтукНаКонецДня_Формула
definition: (Sum({<$(СбросФильтраПоОстаткам),_ФлагДействующаяДата={1},ТипПериода={'OnHand_Sum'},ТипДокумента={'InventTrans'}>} Количество) 
	+ Sum({<$(СбросФильтраПоОстаткам),_ФлагДействующаяДата={1},ТипПериода={'OnHand_Eom'},ТипДокумента={'OnHandEoM'}>} Количество))
---
set: ОстатокШтукНаКонецДня
definition: Money($(ОстатокШтукНаКонецДня_Формула),'# ##0,00')
label: Остаток на конец периода, шт
comment: Складские остатки в штуках на конец дня, шт
---
set: ОстатокСебестоимостьНаКонецДня_Формула
definition: (Sum({<$(СбросФильтраПоОстаткам),ТипПериода={'OnHand_Sum'},ТипДокумента={'InventTrans'}>} Себестоимость) 
	+ Sum({<$(СбросФильтраПоОстаткам),ТипПериода={'OnHand_Eom'},ТипДокумента={'OnHandEoM'}>} Себестоимость))
---
set: ОстатокСебестоимостьНаКонецДня
definition: Money($(ОстатокСебестоимостьНаКонецДня_Формула),'# ##0,00')
label: Себестоимость остатков на конец дня, руб
comment: Себестоимость складских остатков на конец дня, руб
---
set: ОстатокШтукНаПоследнийДеньВыборки_Формула
definition: (Sum({<$(СбросФильтраПоОстаткам),_ФлагДействующаяДата={1},ТипПериода={'OnHand_Sum'}, Дата={"$(=Max({<$(СбросФильтраПоОстаткам),_ФлагДействующаяДата={1}>} Дата))"},ТипДокумента={'InventTrans'}>} Количество) + Sum({<$(СбросФильтраПоОстаткам),_ФлагДействующаяДата={1},ТипПериода={'OnHand_Eom'}, Дата={"$(=Max({<$(СбросФильтраПоОстаткам),_ФлагДействующаяДата={1}>} Дата))"},ТипДокумента={'OnHandEoM'}>} Количество))
---
set: ОстатокШтукНаПоследнийДеньВыборки
definition: Money($(ОстатокШтукНаПоследнийДеньВыборки_Формула),'# ##0,00')
#SECTION :ЗапасыВДнях

---
set: ПродажиСуммаСреднедневные
definition: Money(($(СуммаПродажи) / Count({<_ФлагДействующаяДата={1}>} TOTAL DISTINCT Дата)),'# ##0,00')
label: Среденедневная покупка, руб
comment: Среднедневная сумма продаж за выбранный период, руб
---
set: ПродажиКоличествоСреднедневные
definition: Money(($(ПродажиКоличество) / Count({<_ФлагДействующаяДата={1}>} TOTAL DISTINCT Дата)),'# ##0,00')
label: Среднедневная покупка за выбранный период, шт
comment: Среднедневное количество проданного товара за выбранный период, шт
---
set: T30
definition: Money(Sum({$<ТипДокумента ={'Sales'},ТипПериода={'Current'},Год,Месяц,ГодМесяц,Квартал,Полугодие,День,ДеньНедели,ДеньИНомерНедели,
		Дата={'>=$(=Date(Max({<_ФлагДействующаяДата={1}>} Дата)-29))<=$(=Date(Max({<_ФлагДействующаяДата={1}>} Дата)))'}>} Количество)/30,'# ##0,00')
label:Ср мес продажи (30), шт
comment: Среднедневная покупка, за последние 30 дней от конечной даты выбранного периода, шт
---
set: ЗапасыВДнях30
definition: 
	Money(if(($(T30))=0 and ($(ОстатокШтукНаКонецПериода_Формула))>0,30000,
		if(($(ОстатокШтукНаКонецПериода_Формула))<>0 and ($(T30))<=0,0,
		if(($(ОстатокШтукНаКонецПериода_Формула))<=0 and ($(T30))>0,0,
		if(($(ОстатокШтукНаКонецПериода_Формула))=0 and ($(T30))=0,0,
			($(ОстатокШтукНаКонецПериода_Формула))/($(T30)))))),'# ##0,00')
label:Запас в Днях (30)
comment: Запасы в днях на конец периода (исходя из продаж за 30 дней)
---
set: T90
definition: Money(Sum({$<ТипДокумента ={'Sales'},ТипПериода={'Current'},Год,Месяц,ГодМесяц,Квартал,Полугодие,День,ДеньНедели,ДеньИНомерНедели,
		Дата={'>=$(=Date(Max({<_ФлагДействующаяДата={1}>} Дата)-89))<=$(=Date(Max({<_ФлагДействующаяДата={1}>} Дата)))'}>} Количество)/90,'# ##0,00')
label:Ср мес продажи (90), шт
comment: Среднедневная покупка, за последние 90 дней от конечной даты выбранного периода, шт
---
set: ЗапасыВДнях90
definition: 
	Money(if(($(T30))=0 and ($(ОстатокШтукНаКонецПериода_Формула))>0,30000,
		if(($(ОстатокШтукНаКонецПериода_Формула))<>0 and ($(T90))<=0,0,
		if(($(ОстатокШтукНаКонецПериода_Формула))<=0 and ($(T90))>0,0,
		if(($(ОстатокШтукНаКонецПериода_Формула))=0 and ($(T90))=0,0,
			($(ОстатокШтукНаКонецПериода_Формула))/($(T90)))))),'# ##0,00')
label:Запас в Днях (90)
comment: Запасы в днях на конец периода (исходя из продаж 90 дней)
---
set: T30ТорговыеДни
definition: Money(Sum({$<ТипДокумента ={'Sales'},ТипПериода={'Current'}
		>} Количество)/
		Sum({<ТипДокумента={'OutOfStock'},ТипПериода={'Current'}
		>} Скидка),'# ##0,00')
label:Ср мес продажи (месяц с учетом наличия), шт
comment: Среднедневная продажа, за месяц с учетом наличия, шт
---
set: T30ТорговыеДниПоКомпании
definition: Money($(T30ТорговыеДни)*(Sum(If(Aggr($(ОстатокШтукНаКонецПериода),СкладСсылка,НоменклатураСсылка)>0,1,0))),'# ##0,00')
label:Ср мес продажи (месяц с учетом наличия), шт
comment: Среднедневная продажа, за месяц с учетом наличия, шт
---
set: T30ТорговыеДниДинамика
definition: (Sum({<$(СбросФильтраПоОстаткамПоДням),_ФлагДействующаяДата={1},ТипПериода={'OnHand_Sum'},ТипДокумента={'InventTrans'},Год,Месяц,ГодМесяц,Квартал,Полугодие,День,ДеньНедели,ДеньИНомерНедели,
		Дата={'>=$(=Date(Max({<_ФлагДействующаяДата={1}>} Дата)-29))<=$(=Date(Max({<_ФлагДействующаяДата={1}>} Дата)))'}>} Количество) 
	+ Sum({<$(СбросФильтраПоОстаткамПоДням),_ФлагДействующаяДата={1},ТипПериода={'OnHand_Eom'},ТипДокумента={'OnHandEoM'},Год,Месяц,ГодМесяц,Квартал,Полугодие,День,ДеньНедели,ДеньИНомерНедели,
		Дата={'>=$(=Date(Min({<_ФлагДействующаяДата={1}>} Дата)-29))<=$(=Date(Min({<_ФлагДействующаяДата={1}>} Дата)))'}>} Количество))
label:Ср мес продажи (30), шт
comment: Среднедневная покупка, за последние 30 дней от конечной даты выбранного периода, шт
---
set: ЗапасыПоТорговымДням30
definition: 
	Money(if(alt($(T30ТорговыеДни),0)=0 and ($(ОстатокШтукНаКонецПериода_Формула))>0,30000,
		if(($(ОстатокШтукНаКонецПериода_Формула))<>0 and ($(T30ТорговыеДни))<=0,0,
		if(($(ОстатокШтукНаКонецПериода_Формула))<=0 and ($(T30ТорговыеДни))>0,0,
		if(($(ОстатокШтукНаКонецПериода_Формула))=0 and alt($(T30ТорговыеДни),0)=0,0,
			($(ОстатокШтукНаКонецПериода_Формула))/($(T30ТорговыеДни)))))),'# ##0,00')
label:Запас в Днях (месяц с учетом наличия)
comment: Запасы в днях на конец периода (исходя из продаж и наличия за месяц)
---
set: ЗапасыПоТорговымДням30ПоКомпании
definition: 
	Money(if(alt($(T30ТорговыеДниПоКомпании),0)=0 and ($(ОстатокШтукНаКонецПериода_Формула))>0,30000,
		if(($(ОстатокШтукНаКонецПериода_Формула))<>0 and ($(T30ТорговыеДниПоКомпании))<=0,0,
		if(($(ОстатокШтукНаКонецПериода_Формула))<=0 and ($(T30ТорговыеДниПоКомпании))>0,0,
		if(($(ОстатокШтукНаКонецПериода_Формула))=0 and alt($(T30ТорговыеДниПоКомпании),0)=0,0,
			($(ОстатокШтукНаКонецПериода_Формула))/($(T30ТорговыеДниПоКомпании)))))),'# ##0,00')
label:Запас в Днях (месяц с учетом наличия)
comment: Запасы в днях на конец периода (исходя из продаж и наличия за месяц)

#SECTION :Фрагменты фильтров. QvSuppressError
---
set: СбросФильтраПоОстаткам 
definition: КлиентСсылка,Клиент
---
set: СбросФильтраПоПланам
definition: НоменклатураКод,НоменклатураНаименование,Уровень4,Уровень3,ШкалаЛиквидности
---
set: ПоляПоиска
definition: НоменклатураНаименование,Логист,КатегорийныйМенеджер,МенеджерПродаж,Клиент,Бренд,Группа,Подгруппа,РекламнаяАкцияИстория
---
#SECTION :ОстаткиСебестоимость
---
set: ОстаткиСебестоимость
definition: Sum({<$(СбросФильтраПоОстаткам),ТипДокумента={'OnHandEoM'},
		_ДеньПоПорядку={'$(=Max({<_ФлагДействующаяДата={1},_КонецНеделиМесяца={1}>} _ДеньПоПорядку))'},
		ТипПериода={'Current'}>} Себестоимость)
label:Остатки на конец полного (мес) периода по себестоимости, руб
comment: Остаток себестоимость на конец выбранного периода, руб
---
set: ОстаткиСебестоимостьПоШкалеЛиквидности
definition: Money((Sum({$<ТипДокумента = {'OnHandSum'},ТипПериода={'Current'},Канал,КодКлиента,Клиент,ГруппаКлиента>} Себестоимость) / $(КоличествоДней))/1000,'# ##0,00')
label: Остатки средние, руб
comment: Остатки средняя себестоимость по суммам, руб
---
set: ОстаткиСебестоимостьТыс
definition: Money(($(ОстаткиСебестоимость)/1000),'# ##0,00')
label:Остатки на конец полного (мес) периода в сред Закуп. Ценах, тыс.руб.
comment: Остаток себестоимость на конец выбранного периода тыс. руб.
---
set: ОстаткиТыс
definition: Money((Sum({$<ТипДокумента = {'OnHandSum'},ТипПериода={'Current'},$(СбросФильтраПоОстаткам)>} Себестоимость) / (Sum({<_КонецМесяца={1},ТипПериода={'Current'}>} _ДниДляСреднихОстатков))/1000),'# ##0,00')
label: Остатки средние, тыс.руб
comment: Остатки себестоимость среднедневная за выбранный период, тыс. руб.
---
set: Остатки
definition: Money((Sum({$<ТипДокумента = {'OnHandSum'},ТипПериода={'Current'},$(СбросФильтраПоОстаткам)>} Себестоимость) / Sum({<_КонецМесяца={1},ТипПериода={'Current'}>} _ДниДляСреднихОстатков)),'# ##0,00')
label: Остатки средние, руб
comment: Остатки себестоимость среднедневная за выбранный период, рублей
---
set: ДоляСуммыОстатковГруппы
definition: Money(Aggr( Sum({$<ТипДокумента={'OnHandSum'},
	ТипПериода={'Current'},$(СбросФильтраПоОстаткам)>} Себестоимость)/Sum({$<ТипДокумента={'OnHandSum'},
	ТипПериода={'Current'},$(СбросФильтраПоОстаткам)>} TOTAL <$(Измерение(ГруппаСклад))> Себестоимость), $(Измерение(ГруппаСклад)), $(Измерение(ГруппаКлассификатор))),'# ##0,00%')
label: Доля остатков группы по магазину
comment: Доля остатков группы товара по магазину
---
set: ДоляСуммыОстатковСклад
definition: Money(Aggr( Sum({$<ТипДокумента={'OnHandSum'},
	ТипПериода={'Current'},$(СбросФильтраПоОстаткам)>} Себестоимость)/Sum({$<ТипДокумента={'OnHandSum'},
	ТипПериода={'Current'},$(СбросФильтраПоОстаткам)>} TOTAL <$(Измерение(ГруппаКлассификатор))> Себестоимость), $(Измерение(ГруппаКлассификатор)), $(Измерение(ГруппаСклад))),'# ##0,00%')
label: Доля остатков склада по группе
comment: Доля остатков склада по группе товаров
---
set: ДоляСуммыОстатковКомпании
definition: Money(Aggr( Sum({$<ТипДокумента={'OnHandSum'},
	ТипПериода={'Current'},$(СбросФильтраПоОстаткам)>} Себестоимость)/Sum({<Склад,ТипДокумента={'OnHandSum'},
	ТипПериода={'Current'},$(СбросФильтраПоОстаткам)>} TOTAL Себестоимость), $(Измерение(ГруппаСклад)), $(Измерение(ГруппаКлассификатор))),'# ##0,00%')
label: Доля остатков по компании
comment: Доля остатков по компании в целом
---
set: ПланОстатки
definition: Money(Sum({$<ТипДокумента = {'OnHand_Plan'},ТипПериода={'Current'}>} Себестоимость) / $(КоличествоДнейВключаяБудущийПериод),'# ##0,00')
label: План остатки, руб 
comment: Плановые остатки средние (расчет), руб
---
set: ПланОстаткиТыс
definition: Money((Sum({$<ТипДокумента = {'OnHand_Plan'},ТипПериода={'Current'}>} Себестоимость) / $(КоличествоДнейВключаяБудущийПериод))/1000,'# ##0,00')
label: План остатки , тыс.руб.
comment: Плановые остатки средние (расчет) , тыс. руб.
---
set: ПланОборачиваемость
definition: Money((Sum({$<ТипДокумента = {'OnHand_Plan'},ТипПериода={'Current'}>} Себестоимость) / ($(ПланПродажПолный)- $(ПланВППолный))),'# ##0,00')
label: План оборачиваемость
comment: План по оборачиваемости
---
set: ПФ_Остатки
definition: Money($(ОстаткиТыс)/$(ПланОстаткиТыс),'# ##0,0%')
label:% отношения к плановым Остатков в сред. Закуп. Ценах
comment: Факт отнесенный к плану по остаткам
---
set: П_Ф_Остатки
definition:Money( (-$(ПланОстатки)+($(ОстаткиТыс)/1000)),'# ##0,00')
label:∆ П-Ф остатков, руб.
comment: План минус  факт по остаткам
---
set: П_Ф_ОстаткиТыс
definition: Money(($(П_Ф_Остатки))/1000,'# ##0,00')
label:∆ П-Ф остатков тыс. руб.
comment: План минус  факт по остаткам
---
set: ОстаткиПредГодОбщие
definition: Money((Sum({<ТипДокумента = {'OnHandSum'},ТипПериода={'КонецМесяцаГод'},$(СбросФильтраПоОстаткам)>} Себестоимость)/1000),'# ##0,00')
label: Остатки пред год, руб
comment: Остатки себестоимость по суммам за предыдущий год, руб
---
set: ОстаткиПредГод
definition: Money((Sum({<ТипДокумента = {'OnHandSum'},ТипПериода={'КонецМесяцаГод'},$(СбросФильтраПоОстаткам)>} Себестоимость)/1000) / Sum({<_КонецМесяца={1},ТипПериода={'КонецМесяцаГод'}>} _ДнейПрошлогоПериодаВМесяце),'# ##0,00')
label: Остатки средние пред.(1) Год, руб
comment: Остатки  средняя себестоимость по суммам за предыдущий год, руб
---
set: ПроцентОстаткиПредГод
definition: Money(($(ОстаткиТыс))/($(ОстаткиПредГод)),'# ##0,00%')
label: % Остатков к пред году
comment: Процент Остатков к предыдущему году
---
set: СуммаРостаОстаткиПредГод
definition: Money(($(ОстаткиТыс))-($(ОстаткиПредГод)),'# ##0,00')
label: СуммаРостаОстатков к пред году
comment: СуммаРоста Остатков к предыдущему году
---
set: ОстаткиПредГод2Общие
definition: Money((Sum({<ТипДокумента = {'OnHandSum'},ТипПериода={'КонецМесяцаГод2'},$(СбросФильтраПоОстаткам)>} Себестоимость)/1000),'# ##0,00')
label: Остатки пред.(2) Год, руб
comment: Остатки себестоимость по суммам за предпредыдущий год, руб
---
set: ОстаткиПредГод2
definition: Money(((Sum({<ТипДокумента = {'OnHandSum'},ТипПериода={'КонецМесяцаГод2'},$(СбросФильтраПоОстаткам)>} Себестоимость)/1000) / Sum({<_КонецМесяца={1},ТипПериода={'КонецМесяцаГод2'}>} _ДнейПрошлогоПериодаВМесяце)),'# ##0,00')
label: Остатки средние пред.(2) Год, руб
comment: Остатки  средняя себестоимость по суммам за предпредыдущий год, руб
---
set: ПроцентОстаткиПредГод2
definition: Money(($(ОстаткиТыс))/($(ОстаткиПредГод2)),'# ##0,00%')
label: % Остатков к пред.(2) Году
comment: Процент Остатков к предпредыдущему го
---
set: СуммаРостаОстаткиПредГод2
definition: Money(($(ОстаткиТыс))-($(ОстаткиПредГод2)),'# ##0,00')
label: СуммаРоста Остатков к пред.(2) Году
comment: СуммаРоста Остатков к предпредыдущему году 
---
set: ОстаткиПредМесОбщие
definition: Money((Sum({<ТипДокумента = {'OnHandSum'},ТипПериода={'ГодМесяц'},$(СбросФильтраПоОстаткам)>} Себестоимость)/1000),'# ##0,00')
label: Остатки пред месяц, руб
comment: Остатки себестоимость по суммам за предыдущий месяц, руб
---
set: ОстаткиПредМес
definition: Money(((Sum({<ТипДокумента = {'OnHandSum'},ТипПериода={'ГодМесяц'},$(СбросФильтраПоОстаткам)>} Себестоимость)/1000) / Sum({<_КонецМесяца={1},ТипПериода={'КонецМесяца'}>} _ДнейПрошлогоПериодаВМесяце)),'# ##0,00')
label: Остатки средние пред месяц, руб
comment: Остатки  средняя себестоимость по суммам за предыдущий месяц, руб
---
set: ПроцентОстаткиПредМес
definition: Money(($(ОстаткиТыс))/($(ОстаткиПредМес)),'# ##0,00%')
label: % Остатков к пред месяцу
comment: Процент Остатков к предыдущему месяцу
---
set: СуммаРостаОстаткиПредМес
definition: Money(($(ОстаткиТыс))-($(ОстаткиПредМес)),'# ##0,00')
label: СуммаРоста Остатков к пред месяцу
comment: СуммаРоста Остатков к предыдущему месяцу 
---
set: СуммаОстаткиПроверкаТыс
definition: Money(Sum({$<ТипДокумента={'TestDataOnHand'}, ТипПериода={'Current'}>}Себестоимость)/1000,'# ##0,00')
label:Остатки проверка тыс.руб.
comment: Сумма остатков проверка в тыс. руб.
---
set: СуммаОстаткиРасхожденияТыс
definition: Money($(ОстатокСебестоимостьНаКонецПериодаТыс) - $(СуммаОстаткиПроверкаТыс),'# ##0,00')
label:Дельта проверка тыс.руб.
comment: Дельта остатки проверка в тыс. руб.
---
set: КоличествоОстаткиПроверка
definition: Money(Sum({$<ТипДокумента={'TestDataOnHand'}, ТипПериода={'Current'}>}Количество),'# ##0,00')
label:Остатки проверка штук
comment: Сумма остатков проверка штук
---
set: КоличествоОстаткиРасхождения
definition: Money($(ОстатокШтукНаКонецПериода) - $(КоличествоОстаткиПроверка),'# ##0,00')
label:Дельта проверка штук
comment: Дельта остатки проверка штук
#SECTION :Себестоимость продаж
---
set: УчСебестоимостьПолный
definition: Money((Sum({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},ТипПериода={'Current'}>}Себестоимость)),'# ##0,0')
label: Себестоимость, руб 
comment: Учетная себестоимость, руб
---
set: УчСебестоимостьПолныйТысРуб
definition: Money((Sum({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},ТипПериода={'Current'}>}Себестоимость))/1000,'# ##0,0')
label: Себестоимость продаж, тыс.руб.
comment: Учетная себестоимость, тыс.руб.
---
set: УчСебестоимостьБезТранспортныхПолный
definition: Money((Sum({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},ТипПериода={'Current'}>}СебестоимостьБезТранспортных)),'# ##0,0')
label: Себестоимость без транспортных, руб 
comment: Учетная себестоимость без транспортных, руб
---
set: УчСебестоимостьПолныйПредГод
definition: Money((Sum({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},ТипПериода={'Год'}>}Себестоимость)/1000),'# ##0,0')
label: Себестоимость пред год, руб
comment: Учетная себестоимость за предыдущий год, руб
---
set: УчСебестоимостьПолныйПредГод2
definition: Money((Sum({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},ТипПериода={'Год-2'}>}Себестоимость)/1000),'# ##0,0')
label: Себестоимость пред.(2) Год, руб
comment: Учетная себестоимость за предпредыдущий год, руб
---
set: УчСебестоимостьПолныйПредГодДеньНедели
definition: Money((Sum({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},ТипПериода={'ГодДеньНедели'}>}Себестоимость)/1000),'# ##0,0')
label: Себестоимость пред год тот же день недели, руб
comment: Учетная себестоимость за предыдущий год тот же день недели, руб
---
set: УчСебестоимостьПолныйПредГод2ДеньНедели
definition: Money((Sum({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},ТипПериода={'Год2ДеньНедели'}>}Себестоимость)/1000),'# ##0,0')
label: Себестоимость пред.(2) Год тот же день недели, руб
comment: Учетная себестоимость за предпредыдущий год тот же день недели, руб
---
set: УчСебестоимостьПолныйПредМесяц
definition: Money((Sum({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},ТипПериода={'ГодМесяц'}>}Себестоимость)/1000),'# ##0,0')
label: Себестоимость пред месяц, руб
comment: Учетная себестоимость за предыдущий месяц, руб


#SECTION :Оборачиваемость
---
set: Оборачиваемость
definition: Money((Sum({$<ТипДокумента = {'OnHandSum'},$(СбросФильтраПоОстаткам),ТипПериода={'Current'}>} Себестоимость)  / ($(ПродажиСебестоимостьИзОстатков))),'# ##0,0')
label: Оборачиваемость, дни
comment: Оборачиваемость (считается только вплоть до месяцов), дни
---
set: ПродажиСебестоимостьИзОстатков
definition: Sum({$<ТипДокумента = {'OnHandSum'},$(СбросФильтраПоОстаткам),ТипПериода={'Current'}>} Сумма) 
label: Себестоимость продаж, руб
comment: Себестоимость продаж, руб
---
set: ПродажиСебестоимостьИзОстатковПредГод
definition: Sum({$<ТипДокумента = {'OnHandSum'},$(СбросФильтраПоОстаткам),ТипПериода={'Год'}>} Сумма)/1000 
label: Себестоимость продаж, руб
comment: Себестоимость продаж, руб
---
set: ПродажиСебестоимостьИзОстатковПредГод2
definition: Sum({$<ТипДокумента = {'OnHandSum'},$(СбросФильтраПоОстаткам),ТипПериода={'Год-2'}>} Сумма)/1000 
label: Себестоимость продаж, руб
comment: Себестоимость продаж, руб
---
set: ПродажиСебестоимостьИзОстатковПредМесяц
definition: Sum({$<ТипДокумента = {'OnHandSum'},$(СбросФильтраПоОстаткам),ТипПериода={'ГодМесяц'}>} Сумма)/1000 
label: Себестоимость продаж, руб
comment: Себестоимость продаж, руб
---
set: НормаОборачиваемость
definition: Money(Avg({$<ТипДокумента={'TurnoverPlan'},$(СбросФильтраПоОстаткам),ШкалаЛиквидности,ТипПериода={'Current'}>} Количество),'# ##0,0')
label: Норматив оборачиваемости, дни
comment: Норматив оборачиваемости по третьему уровню классификатора, дни
---
set: ПФ_Оборачиваемость
definition: Money(($(Оборачиваемость)/$(ПланОборачиваемость)),'# ##0,00%')
label:% вып. плана Оборачиваемости
comment: ПФ Оборачиваемость
---
set: П_Ф_Оборачиваемость
definition: Money((-$(ПланОборачиваемость)+$(Оборачиваемость)),'# ##0,00')
label:∆ П-Ф Оборачиваемость, дни
comment: План минус  факт по оборачиваемости
---
set: ОборачиваемостьПредГод
definition: Money((($(ОстаткиПредГодОбщие))/($(ПродажиСебестоимостьИзОстатковПредГод))),'# ##0,0')
label:Оборачиваемость пред. (1) Год, дни
comment: Оборачиваемость за предыдущий год, дни
---
set: ПроцентОборачиваемостьПредГод
definition: Money($(Оборачиваемость)/$(ОборачиваемостьПредГод),'# ##0,00%')
label:% изм. Оборачиваемости к пред. (1) Год
comment: Процент Оборачиваемости к предыдущему году
---
set: СуммаРостаОборачиваемостьПредГод
definition: Money($(Оборачиваемость)-$(ОборачиваемостьПредГод),'# ##0,0')
label:∆ изм. Оборачиваемости к пред. (1) Год, дни
comment: СуммаРоста Оборачиваемости к предыдущему году

---
set: ОборачиваемостьПредГод2
definition: Money((($(ОстаткиПредГод2Общие))/($(ПродажиСебестоимостьИзОстатковПредГод2))),'# ##0,0')
label:Оборачиваемость пред. (2) Год, дни
comment: Оборачиваемость за предпредыдущий год, дни
---
set: ПроцентОборачиваемостьПредГод2
definition: Money($(Оборачиваемость)/$(ОборачиваемостьПредГод2),'# ##0,00%')
label:% изм. Оборачиваемости к пред. (2) Год
comment: Процент Оборачиваемости к предыдущему году
---
set: СуммаРостаОборачиваемостьПредГод2
definition: Money($(Оборачиваемость)-$(ОборачиваемостьПредГод2),'# ##0,0')
label:∆ изм. Оборачиваемости к пред. (2) Год, дни
comment: СуммаРоста Оборачиваемости к предыдущему году
---
set: ОборачиваемостьПредМес
definition: Money((($(ОстаткиПредМесОбщие))/($(ПродажиСебестоимостьИзОстатковПредМесяц))),'# ##0,0')
label: Оборачиваемость пред мес, дни
comment: Оборачиваемость за предыдущий месяц, дни
---
set: ПроцентОборачиваемостьПредМес
definition: Money($(Оборачиваемость)/$(ОборачиваемостьПредМес),'# ##0,00%')
label: % Оборачиваемости к пред мес
comment: Процент Оборачиваемости к предыдущему месяц
---
set: СуммаРостаОборачиваемостьПредМес
definition: Money($(Оборачиваемость)-$(ОборачиваемостьПредМес),'# ##0,0')
label: СуммаРоста Оборачиваемости к пред мес
comment: СуммаРоста Оборачиваемости к предыдущему месяц


#SECTION :СуммаСкидки

---
set: СуммаСкидки
definition: Money((Sum({$<ТипДокумента={'Sales'},ТипПериода={'Current'}>}Скидка)),'# ##0,00')
label:Сумма скидки, руб
comment: Сумма предоставленной скидки в руб.
---
set: СуммаСкидкиТыс
definition: Money((Sum({$<ТипДокумента={'Sales'},ТипПериода={'Current'}>}Скидка)/1000),'# ##0,00')
label:Сумма скидки, тыс.руб.
comment: Сумма предоставленной скидки в тыс. руб.
---
set: СуммаСкидкиТысПредГод
definition: Money((Sum({$<ТипДокумента={'Sales'},_ФлагДействующаяДата={1},ТипПериода={'Год'}>}Скидка)/1000),'# ##0,00')
label:Сумма скидки пред. (1) Год, тыс.руб.
comment: Сумма предоставленной скидки за пред год в тыс. руб.
---
set: ПроцентСуммаСкидкиТысПредГод
definition: Money($(СуммаСкидкиТыс)/$(СуммаСкидкиТысПредГод),'# ##0,00%')
label:% изм.суммы Скидки к пред. (1) Год
comment: Процент Суммы скидки к предыдущему году
---
set: СуммаРостаСуммаСкидкиТысПредГод
definition: Money($(СуммаСкидкиТыс)-$(СуммаСкидкиТысПредГод),'# ##0,00')
label:∆ изм. %Скидок к пред. (1) Год
comment: Изменение Суммы скидки к предыдущему году
---
set: СуммаСкидкиТысПредГод2
definition: Money((Sum({$<ТипДокумента={'Sales'},_ФлагДействующаяДата={1},ТипПериода={'Год-2'}>}Скидка)/1000),'# ##0,00')
label:Сумма скидки пред. (2) Год, тыс.руб.
comment: Сумма предоставленной скидки за предпред год в тыс. руб.
---
set: ПроцентСуммаСкидкиТысПредГод2
definition: Money($(СуммаСкидкиТыс)/$(СуммаСкидкиТысПредГод2),'# ##0,00%')
label:% изм.суммы скидки к пред. (2) Год
comment: Процент суммы скидки к пердпредыдущему году 
---
set: СуммаРостаСуммаСкидкиТысПредГод2
definition: Money($(СуммаСкидкиТыс)-$(СуммаСкидкиТысПредГод2),'# ##0,00')
label:∆ изм. %Скидок к пред. (2) Год
comment: Изменение суммы скидки к предпредыдущему году 
---
set: СуммаСкидкиТысПредГодДеньНедели
definition: Money((Sum({$<ТипДокумента={'Sales'},_ФлагДействующаяДата={1},ТипПериода={'ГодДеньНедели'}>}Скидка)/1000),'# ##0,00')
label:Сумма скидки пред. (1) Год тот же день недели, тыс.руб.
comment: Сумма предоставленной скидки за пред год тот же день недели в тыс. руб.
---
set: ПроцентСуммаСкидкиТысПредГодДеньНедели
definition: Money($(СуммаСкидкиТыс)/$(СуммаСкидкиТысПредГодДеньНедели),'# ##0,00%')
label:% изм.суммы Скидки к пред. (1) Год тот же день недели
comment: Процент Суммы скидки к предыдущему году тот же день недели
---
set: СуммаРостаСуммаСкидкиТысПредГодДеньНедели
definition: Money($(СуммаСкидкиТыс)-$(СуммаСкидкиТысПредГодДеньНедели),'# ##0,00')
label:∆ изм. %Скидок к пред. (1) Год тот же день недели
comment: Изменение Суммы скидки к предыдущему году тот же день недели
---
set: СуммаСкидкиТысПредГод2ДеньНедели
definition: Money((Sum({$<ТипДокумента={'Sales'},_ФлагДействующаяДата={1},ТипПериода={'Год2ДеньНедели'}>}Скидка)/1000),'# ##0,00')
label:Сумма скидки пред. (2) Год тот же день недели, тыс.руб. 
comment: Сумма предоставленной скидки за предпредыдущий год тот же день недели в тыс. руб.
---
set: ПроцентСуммаСкидкиТысПредГод2ДеньНедели
definition: Money($(СуммаСкидкиТыс)/$(СуммаСкидкиТысПредГод2ДеньНедели),'# ##0,00%')
label:% изм.суммы скидки к пред. (2) Год тот же день недели
comment: Процент суммы скидки к пердпредыдущему году тот же день недели 
---
set: СуммаРостаСуммаСкидкиТысПредГод2ДеньНедели
definition: Money($(СуммаСкидкиТыс)-$(СуммаСкидкиТысПредГод2ДеньНедели),'# ##0,00')
label:∆ изм. %Скидок к пред. (2) Год тот же день недели
comment: Изменение суммы скидки к предпредыдущему году тот же день недели
---
set: СуммаСкидкиТысПредМес
definition: Money((Sum({$<ТипДокумента={'Sales'},_ФлагДействующаяДата={1},ТипПериода={'ГодМесяц'}>}Скидка)/1000),'# ##0,00')
label: Сумма скидки пред мес, тыс.руб.
comment: Сумма предоставленной скидки за предыдущий месяц в тыс. руб.
---
set: ПроцентСуммаСкидкиТысПредМес
definition: Money($(СуммаСкидкиТыс)/$(СуммаСкидкиТысПредМес),'# ##0,00%')
label: % Суммы скидки к пред мес
comment: Процент Суммы скидки к предыдущему месяцу 
---
set: СуммаРостаСуммаСкидкиТысПредМес
definition: Money($(СуммаСкидкиТыс)-$(СуммаСкидкиТысПредМес),'# ##0,00')
label: Изменение суммы скидки к пред мес
comment: Изменение Суммы скидки к предыдущему месяцу 

#SECTION :ПроцентСкидки

---
set: ПроцентСкидки
definition: Money(alt($(СуммаСкидки)/($(СуммаПродажи)+$(СуммаСкидки)),0),'# ##0,00%')
label: Процент скидки
comment: Процент предоставленной скидки
---
set: ПроцентСкидкиПредГод
definition: Money(alt($(СуммаСкидкиТысПредГод)/($(ПродажиПредГод)+$(СуммаСкидкиТысПредГод)),0),'# ##0,00%')
label:% Скидки пред. (1) Год
comment: Процент предоставленной скидки за пред год
---
set: ПроцентПроцентСкидкиПредГод
definition: Money($(ПроцентСкидки)/$(ПроцентСкидкиПредГод),'# ##0,00%')
label:% изм. %Скидки к пред. (1) Год
comment: Процент от Процента скидки к предыдущему году
---
set: СуммаРостаСПроцентСкидкиПредГод
definition: Money($(ПроцентСкидки)-$(ПроцентСкидкиПредГод),'# ##0,00%')
label:∆ изм. %Скидок к пред. (1) Год
comment: Изменение от Процента скидки к предыдущему году


---
set: ПроцентСкидкиПредГод2
definition: Money(alt($(СуммаСкидкиТысПредГод2)/($(ПродажиПредГод2)+$(СуммаСкидкиТысПредГод2)),0),'# ##0,00%')
label:% Скидки пред. (2) Год
comment: Процент предоставленной скидки за предпред год
---
set: ПроцентПроцентСкидкиПредГод2
definition: Money($(ПроцентСкидки)/$(ПроцентСкидкиПредГод2),'# ##0,00%')
label:% изм. %Скидки к пред. (2) Год
comment: Процент от Процента скидки к предпредыдущему году
---
set: СуммаРостаСПроцентСкидкиПредГод2
definition: Money($(ПроцентСкидки)-$(ПроцентСкидкиПредГод2),'# ##0,00%')
label:∆ изм. %Скидок к пред. (2) Год
comment: Изменение от Процента скидки к предпредыдущему году


---
set: ПроцентСкидкиПредМес
definition: Money(alt($(СуммаСкидкиТысПредМес)/($(ПродажиПредМес)+$(СуммаСкидкиТысПредМес)),0),'# ##0,00%')
label: Процент скидки пред мес
comment: Процент предоставленной скидки  предыдущего месяца
---
set: ПроцентПроцентСкидкиПредМес
definition: Money($(ПроцентСкидки)/$(ПроцентСкидкиПредМес),'# ##0,00%')
label: % Процента скидки к пред мес
comment: Процент от Процента скидки к предыдущему месяцу
---
set: СуммаРостаСПроцентСкидкиПредМес
definition: Money($(ПроцентСкидки)-$(ПроцентСкидкиПредМес),'# ##0,00%')
label: Изменение процента скидки к пред мес
comment: Изменение от Процента скидки к предыдущему месяцу


#SECTION : Границы красного
---
set: ПредМесГраницаКрасного 
definition: 0.95
---
set: ПредМесГраницаЗеленого 
definition: 1.05
---
set: ПредМесГраницаКрасного2
definition: 0.90
---
set: ПредМесГраницаЗеленого2
definition: 1.10
---
set: ГруппаПланГраницаКрасного 
definition: $(=if(_ГруппаПоказателей_План='% изм. План-Факт' 
	or _ГруппаПоказателей_План='% изм. к пред (-1) год' 
	or _ГруппаПоказателей_План='% изм. к пред (-2) год'
	or _ГруппаПоказателей_План='% изм. к пред (-1) месяц'
	,0.8,0))
---
set: ГруппаПГГраницаКрасного
definition: $(=if(_ГруппаПоказателей_ПГ='% изм. План-Факт' 
	or _ГруппаПоказателей_ПГ='% изм. к пред (-1) год' 
	or _ГруппаПоказателей_ПГ='% изм. к пред (-2) год' 
	or _ГруппаПоказателей_ПГ='% изм. к пред (-1) месяц',0.8,0))
---
set: ГруппаПланСкидкаГраницаКрасного 
definition: $(=if(_ГруппаПоказателей_План='% изм. План-Факт' 
	or _ГруппаПоказателей_План='% изм. к пред (-1) год' 
	or _ГруппаПоказателей_План='% изм. к пред (-2) год' 
	or _ГруппаПоказателей_План='% изм. к пред (-1) месяц',1.2,10000000000))
---
set: ГруппаПГСкидкаГраницаКрасного
definition: $(=if(_ГруппаПоказателей_ПГ='% изм. План-Факт' 
	or _ГруппаПоказателей_ПГ='% изм. к пред (-1) год' 
	or _ГруппаПоказателей_ПГ='% изм. к пред (-2) год' 
	or _ГруппаПоказателей_ПГ='% изм. к пред (-1) месяц',1.2,10000000000))
---
set: ГруппаПланОстаткиГраницаКрасного 
definition: $(=if(_ГруппаПоказателей_План='% изм. План-Факт' 
	or _ГруппаПоказателей_План='% изм. к пред (-1) год' 
	or _ГруппаПоказателей_План='% изм. к пред (-2) год' 
	or _ГруппаПоказателей_План='% изм. к пред (-1) месяц',1.2,10000000000))
---
set: ГруппаПГОстаткиГраницаКрасного
definition: $(=if(_ГруппаПоказателей_ПГ='% изм. План-Факт' 
	or _ГруппаПоказателей_ПГ='% изм. к пред (-1) год' 
	or _ГруппаПоказателей_ПГ='% изм. к пред (-2) год' 
	or _ГруппаПоказателей_ПГ='% изм. к пред (-1) месяц',1.2,10000000000))
---
set: ПредГодГраницаКрасного 
definition: 0.90
---
set: ПредГодГраницаЗеленого 
definition: 1.10
---
set: ПредГодГраницаКрасного2
definition: 0.80
---
set: ПредГодГраницаЗеленого2
definition: 1.20

#SECTION :Служебные формулы
---
set: ЦветФонаМатрица
definition:  if($(КоличествоСКУОстаток)=0,
		rgb(255,60,60),
		 if( $(СуммаПродажиТыс)=0,
 			LightCyan(),
		if ($(ГруппаВыражение(ПоказательАбс,'Факт'))>=0 ,
			ColorMix1 (Fabs($(=Alt(Only({ПоказательАбс} _ГП_ПоказательАбс_ФлагОстатки),0)) - ($(ГруппаВыражение(ПоказательАбс,'Факт'))/max(TOTAL<НоменклатураНаименование> aggr($(ГруппаВыражение(ПоказательАбс,'Факт')),НоменклатураНаименование,$(Измерение(ГруппаСклад))))))
			, ARGB(0, 250, 250, 120), ARGB(250, 80, 242, 100)),
 				RGB(250, 250, 120)
		)))
---
set: ВыбранныеПоляКалендаря
definition: =if(GetSelectedCount(Дата)>0, ',Дата={"' & GetFieldSelections(Дата,'","',1000) &'"}', '')
 	& if(GetSelectedCount(Год)>0, ',Год={"' & GetFieldSelections(Год,'","',1000) &'"}', '')
 	& if(GetSelectedCount(Месяц)>0, ',Месяц={"' & GetFieldSelections(Месяц,'","',1000) &'"}', '') 
---
set: ГрупповоеВыражение_ФорматТыс 
definition:  If(IsNull(Only({$1 <ГП_$1={$2}>}  _ГП_$1_ФорматТыс)),'млн','тыс')
---
set: ГрупповоеВыражение_ФорматМлн 
definition:  If(IsNull(Only({$1 <ГП_$1={$2}>}  _ГП_$1_ФорматМлн)),'мрд','млн')
---
set: ГрупповоеВыражение_ОтносительныйПоказатель 
definition:  (Only({$1 <ГП_$1={$2}>}  _ГП_$1_ФлагОтносительныйПоказатель) = 1)
---
set: ГрупповоеВыражение_ФорматМрд 
definition:  If(IsNull(Only({$1 <ГП_$1={$2}>}  _ГП_$1_ФорматМлрд)),'трн','мрд')
---
set: ПоказатьОстаткиПоМесяцам 
definition: (only(_Группа$1)='Дата'  or only(_Группа$1)='Неделя' or only(_Группа$1)='Посл 8 Дней') 
	and (only(_ГруппаПоказателей_$2)='Остатки' 
	or only(_ГруппаПоказателей_$2)='Оборачиваемость')
---
set: СтрелкаТренда
definition: if ($1 = 0 OR IsNull($1), null(), 'qmem://<builtin>/' & 
	if($1 >= 1.20,'Arrow_N_G.png',
	if($1 >= 1.051,'Arrow_NE_G.png',
	if($1 >= 1.05 ,'Arrow_NE_G.png',
	if($1 >= 1,'Arrow_E_Y.png',
	if($1 >= .95 ,'Arrow_W_Y.png',
	if($1 >= .801  ,'Arrow_SE_R.png',
	if($1 >= .80 ,'Arrow_S_R.png',
	if($1 >= 0 ,'Arrow_S_R.png','Arrow_S_R.png') ))))))))
label:СтрелкаТренда
---
set: ТрендПродажиПредГод
macro: СтрелкаТренда
	- $(ПроцентПродажиПредГод)
comment: Тренд продаж к предыдущему году	
---
set: ТрендВППредГод
macro: СтрелкаТренда
	- $(ПроцентВППредГод)
comment: Тренд ВП к предыдущему году	
---
set: ТрендРентВППредГод
macro: СтрелкаТренда
	- $(ПроцентРентВППредГод)
comment: Тренд рентабельности ВП к предыдущему году		
---
set: ТрендОборачиваемостьПредГод
macro: СтрелкаТренда
	- $(ПроцентОборачиваемостьПредГод)	
comment: Тренд оборачиваемости к предыдущему году		
---
set: ТрендОстаткиПредГод
macro: СтрелкаТренда
	- $(ПроцентОстаткиПредГод)		
comment: Тренд остатков к предыдущему году			
---
set: ТрендСуммаСкидкиПредГод
macro: СтрелкаТренда
	- $(ПроцентСуммаСкидкиТысПредГод)	
comment: Тренд суммы скидки к предыдущему году		
---
set: ТрендПроцентСкидкиПредГод
macro: СтрелкаТренда
	- $(ПроцентПроцентСкидкиПредГод)
comment: Тренд процента скидок к предыдущему году			
---
set: КоличествоДней
definition: =COUNT(DISTINCT {1<_ФлагДействующаяДата={1} $(ВыбранныеПоляКалендаря)>} Дата)
label:КоличествоДней
---
set: КоличествоДнейВключаяБудущийПериод
definition: =COUNT(DISTINCT {1<_ФлагДействующаяДата= $(ВыбранныеПоляКалендаря)>} Дата)
---
set: ГруппаВыражение 
definition:  $($(=Only({$1 <ГП_$1={$2}>}  _ГП_$1)))
description: Основная формула для динамического выражения
---
set: ГруппаЗаголовок 
definition:  $(=Only({$1 <ГП_$1={$2}>}  _ГП_$1) & '.Заголовок')
---
set: ГруппаОписание 
definition:  $(=Only({$1 <ГП_$1={$2}>}  _ГП_$1) & '.Описание')
---
set: ГруппаВыражениеПредГодОтладка
definition:  Only({$1 <ГП_$1={$(=chr(39) & Only({<ГП_ТипПоказателя={ПредГод}>} _ГП_ТипПоказателя) & chr(39))}>}  _ГП_$1)
---
set: ГруппаВыражениеОтладка
definition:  Only({$1 <ГП_$1={$2}>}  _ГП_$1)
---
set: Измерение
definition:  $(=Only({$1} _$1_Измерение))
---
set: Календарь
definition:  $(=If(Only({$2} _ГП_$2_ФлагОстатки)= 1 AND (only({$1} _$1)='Дата'  or only({$1} _$1)='Неделя' or only({$1} _$1)='Посл 8 Дней'),'ГодМесяц',Only({$1} _$1_Измерение)))
---
set: ВыбранКлассификатор
definition:  '$(Измерение($1))'='[Классификатор товаров]'
comment: Пример:    ВыбранКлассификатор(ГруппаКлассификатор) или ВыбранКлассификатор(ГруппаИзмерений)
---
set: ВыбранНоменклатура
definition:  '$(Измерение($1))'='НоменклатураНаименование'
comment: Пример:    ВыбранНоменклатура(ГруппаКлассификатор) или ВыбранНоменклатура(ГруппаИзмерений)
---
set: ВыбранКомпания
definition:  '$(Измерение($1))'='[Компания в целом]'
comment: Пример:    ВыбранКомпания(ГруппаСклад) или ВыбранКомпания(ГруппаИзмерений)
---
set: ВыбраноМеню
definition:  '$(=Only({ГруппаМеню} _ГруппаМеню_Измерение))'='$1'
comment: Пример:    ВыбраноМеню(DynLFL) или ВыбраноМеню(Abc)
---
set: Выбран1ЗначениеИзмерения
definition:  Count(DISTINCT $(Измерение($1))) = 1 
comment: Пример:    Выбран1ЗначениеИзмерения(ГруппаСклад) или Выбран1ЗначениеИзмерения(ГруппаИзмерений)

---
set: ПоказателиНесовместимы 
definition: If(Count({<_ГП_Ошибки_$1={$2}>} _ГП_Ошибки_$1_ГруппаИзмерений)=0,0,
	If(MinString({<_ГП_Ошибки_$1={$2}>} _ГП_Ошибки_$1_ГруппаИзмерений)='*' AND GetSelectedCount(Канал)>0, -1,
	Count({<_ГП_Ошибки_$1={$2},_ГП_Ошибки_$1_ГруппаИзмерений={'$(=Only(_ГруппаИзмерений))'}>} _ГП_Ошибки_$1_ГруппаИзмерений)=1)) 
label: ПоказателиНесовместимы
---
set: СкроллПоказатель
definition: aggr(Rank($(ГруппаВыражение(ПоказательАбс,'Факт')),4),$(=Only(_ГруппаИзмерений_Измерение)))
label: СкроллПоказатель
---
set: СкроллВид
definition: (if(СкроллМакс-СкроллИзмерении<0,1,СкроллИзмерении-СкроллИзмерений2))
---
set: СкроллМакс
definition: (Count(DISTINCT $(=Only(_ГруппаИзмерений_Измерение))))
---
set: ГруппаВыбранаПоказатель
definition: IsNull(Only(_ГруппаПоказателей_$1)) = 0 
---
set: ПоказательСУчетомНедель
definition: $(=if(Only({$1} _ГП_$1_ФлагОстатки)<> 1 and (Only({$3} _$3)='Дата' or Only({$3} _$3)='Неделя'or Only({$3} _$3)='Посл 8 Дней') and WildMatch(Only({$1} _$1),'*месяц*')=0,
	'$(=Only({$1 <ГП_$1={$2}>}  _ГП_$1))' & 'ДеньНедели',
	'$(=Only({$1 <ГП_$1={$2}>}  _ГП_$1))'))
description: ПримерИспользования $($(ПоказательСУчетомНедель(ПоказательАбс,ПрцПредГод,ГруппаКалендарь3)))
 Параметры 
 	- Значение колонки _ГрупповойПоказательНазваниеГруппы в Лист1 настроечного файла (без кавычек)
 	- Значение колонки ГрупповойПоказатель в Лист1 настроечного файла (без кавычек)
    - ГруппаКалендарь1 или ГруппаКалендарь2 или ГруппаКалендарь3
    Если выбран показатель по остаткам (Остатки, оборачиваемость и т.д.) возвращается формула по умолчанию, так как данные 
    по остаткам есть только в разрезе месяцов, сравнение по дням недели по ним неприменимо 
---
set: ТрендПредГод
definition: $(=if(Only({$2} _$2)='Дата' or Only({$2} _$2)='Неделя'or Only({$2} _$2)='Посл 8 Дней',
	'$1' & 'ДеньНедели',
	'$1'))
description: ПримерИспользования $($(ПроцентПредГодСУчетомНедель(ПроцентПродажиПредГод,ГруппаКалендарь3)))
 Параметры 
 	- Название базового показателя. При выборе выборе недель или дат в календаре к нему добавляется суффикс ДеньНедели
 	- ГруппаКалендарь1 или ГруппаКалендарь2 или ГруппаКалендарь3
---
set: КрасныйШрифт
definition: Money(Only({<ГП_$1={$2}>}  _ГП_$1_КраснаяГраница))
---
set: _1.ПустоеВыражение
definition: 'Формула не найдена'
---
set: __.Empty
definition: '_1.ПустоеВыражение'
---
set: ВыражениеДляКарточки
definition: $($(=Only({<ГП_$1={$3},_ГруппаПоказателей_$1={$2}>}  _ГП_$1)))
comment: Пример использования: ВыражениеДляКарточки(ПоказательАбс,'Наценка','ПредМес')
---
set: ВыражениеДляКарточкиОтладка
definition: Only({<ГП_$1={$3},_ГруппаПоказателей_$1={$2}>}  _ГП_$1)
---
set: Меню_tab
definition: 0
---
set: HomeSheet
definition: 'SH32'
---
set: Субменю_tab
definition: 0
---
set: СкрытьЛисты
definition: 0
---
set: ЛистЧеки_Вкладки
definition: 0
---
set: Абс_Отн
definition: 1

#SECTION :Проверки
---
set: Проверка_Календаря
definition: 
   if( GetSelectedCount(Дата)>0,1,
   if (GetSelectedCount(Год)>0 
 	and  (GetSelectedCount(Полугодие)>0 
 	 or GetSelectedCount(Квартал)>0 
 	 or GetSelectedCount(Месяц)>0 
 	 or GetSelectedCount(ГодПолугодие)>0 
 	 or GetSelectedCount(ГодКвартал)>0 
 	 or GetSelectedCount(ГодМесяц)>0 
 	 or GetSelectedCount(ГодНеделя)>0 
 	 or GetSelectedCount(День)>0 
 	 or GetSelectedCount(ДеньНедели)>0 
 	 or GetSelectedCount(ДеньИНомерНедели)>0 
 	 )
 	 ,1,0))
label: Проверка_Календаря
comment: Проверка_Календаря
---
set: ГруппаВыбрана 
definition: IsNull(Only({$1} _ГруппаПоказателей_$1)) = 0 AND Left(Only({$1} _ГруппаПоказателей_$1),1) <> ' ' AND If($(ВыбранПлановыйПоказатель($1)),$(ФлагПланУстановлен(ГруппаСклад)),-1)
comment: Формула для использовании в Show Condition. Примеры использования: $(ГруппаВыбрана(План)) $(ГруппаВыбрана(ПГ)) 
---
set: ГруппаВыбранаБезПлановыхПоказателей 
definition: IsNull(Only({$1} _ГруппаПоказателей_$1)) = 0 AND Left(Only({$1} _ГруппаПоказателей_$1),1) <> ' ' AND If($(ВыбранПлановыйПоказатель($1)),0,$(ФлагПланУстановлен(ГруппаСклад)))
comment: Формула для использовании в Show Condition. Примеры использования: $(ГруппаВыбрана(План)) $(ГруппаВыбрана(ПГ)) 
---
set: ПоказательВыбран 
definition: Left(Only({$1} _ГруппаПоказателей_$1),1) <> ' '
comment: Формула для использовании в Show Condition. Примеры использования: $(ПоказательВыбран(План)) $(ПоказательВыбран(ПГ)) 
---
set: ГруппаИзмерений_План
definition: $(=if($(УстановленФильтрПоИзмерениюБезПлана),0,If(Only({ГруппаИзмерений} _ГруппаИзмерений_Измерение)='[Классификатор товаров]',
	Only({ГруппаИзмерений <_ГруппаИзмерений={'$(=GetCurrentField([Классификатор товаров]))'}>} _ГруппаИзмерений_План),
	Only({ГруппаИзмерений} _ГруппаИзмерений_План))))
comment: Условие отображения плановых показателей
---
set: ФлагПланУстановлен
definition: $(=if($(УстановленФильтрПоИзмерениюБезПлана),0,If(Only({$1} _$1_Измерение)='[Классификатор товаров]',
	Only({$1 <_$1={'$(=GetCurrentField([Классификатор товаров]))'}>} _$1_План),
	Only({$1} _$1_План))))
comment: Условие отображения плановых показателей
---
set: ВыбранПлановыйПоказатель
definition: $(=Only({$1} _ГруппаПоказателей_$1) = 'План' 
	or Only({$1} _ГруппаПоказателей_$1) = '% изм. План-Факт' 
	or Only({$1} _ГруппаПоказателей_$1) = '∆ изм. План-Факт' 
	or Only({$1} _ГруппаПоказателей_$1) = 'План за  полный месяц')
---
set: УстановленФильтрПоИзмерениюБезПлана
definition: $(=GetSelectedCount(Подкатегория) +GetSelectedCount(НоменклатураНаименование)+GetSelectedCount(Клиент)
+GetSelectedCount(Подкатегория)+GetSelectedCount(Производитель))
---
set: ВыбранПоказательСПланом
definition: (Only({$1} _ГруппаПоказателей_$1) = 'Продажи' OR Only({$1} _ГруппаПоказателей_$1) = 'Валовая прибыль' OR Only({$1} _ГруппаПоказателей_$1) = '% Маржи' 
	OR Only({$1} _ГруппаПоказателей_$1) = 'Остатки' OR Only({$1} _ГруппаПоказателей_$1) = 'Оборачиваемость' OR Only({$1} _ГруппаПоказателей_$1) = 'Проданные SKU, ед.'
	OR Only({$1} _ГруппаПоказателей_$1) = 'Коэффициент обслуживания, %' OR Only({$1} _ГруппаПоказателей_$1) = 'Коэффициент ТайПо, %' OR Only({$1} _ГруппаПоказателей_$1) = 'ISE, %')
---
set: ЗаголовокИзмерения
definition: Only({$1} _$1) & Chr(10) & text('Выбрано: ' & Chr(10) &(GetCurrentSelections(Chr(10) ,'= ',',',30)))& Chr(10)
description: Пример использования - $(ЗаголовокИзмерения(ГруппаСклад))
---
set: ЗаголовокНоменклатураКод
definition: 'Номенклатура Код' & Chr(10) & text('Выбрано: ' & Chr(10) &(GetCurrentSelections(Chr(10) ,'= ',',',30)))& Chr(10)
---
set: ИзмерениеНоменклатураНепустаяСтрока
definition: aggr(If(Min(МатричныйТовар) = 1 OR Alt($(СуммаПродажиТыс),0)<>0 OR Alt($(ОстатокШтукНаКонецПериода),0)<> 0 ,НоменклатураКод),НоменклатураКод, СкладКод)
---
set: КоличествоСтрокНоменклатураСклад
definition: Sum(aggr(If(Min(МатричныйТовар) = 1 OR Alt($(СуммаПродажиТыс),0)<>0 OR Alt($(ОстатокШтукНаКонецПериода),0)<> 0 ,1, 0),НоменклатураКод,Склад))
---
set: НичегоНеВыбрано
definition: GetSelectedCount(_ГруппаПоказателей_$1, 0, '$1') = 0
description: Пример использования - $(НичегоНеВыбрано(ПоказательАбсМ))
---
set: ЗаголовокИзмеренияСклад
definition: $(НаименованиеИзмерения(ГруппаСклад)) & Chr(10) & text('Выбрано: ' & Chr(10) &(GetCurrentSelections(Chr(10) ,'= ',',',30)))& Chr(10)
---
set: НаименованиеИзмерения
definition: $(=Only({$1} _$1))
---
set: ВыбраноПустоеЗначение
definition: Len(Trim(Only({$1} _$1)))=0
---
set: ВыбраноЗначение
definition: '$(=Only({$1} _$1))'=$2
description: Пример использования $(ВыбраноЗначение(ГруппаКалендарь,'Неделя'))
---
set: ЗаголовокИзмеренияФильтр
definition: Only(_ГруппаФильтр) & Chr(10) & text('Выбрано: ' & Chr(10) &(GetCurrentSelections(Chr(10) ,'= ',',',30)))& Chr(10)

---
set: ГруппаВыражениеПредГод2 
definition:  $($(=Only({<ГП_$1={$(=chr(39) & Only({<ГП_ТипПоказателя={ПредГод2}>} _ГП_ТипПоказателя) & chr(39))}>}  _ГП_$1)))
---
set: ВыбраноПлановоеИзмерение
definition: WildMatch('Склад,Группа складов,Операционный Директор','*' & Only({$1} _$1) & '*') > 0
---
set: ВыбранПоказательКонструктора
definition: SubStringCount(Concat({Конструктор} _ГруппаПоказателей_Конструктор,' | '),$1)
description: Пример $(ВыбранПоказательКонструктора('Продажи'))
#SECTION :OutOfStock
---
set: НормативOOS
definition: 0.15
---
set: ТорговыеДни
definition: Money(Sum({<ТипДокумента={'OutOfStock'}, ТипПериода={'Current'}>} Количество),'# ##0')
label: Торговые дни 
comment: Количество дней наличия на складе на начало торгового дня (с учетом продаж)
---
set: ТорговыеДниРегламентные
definition: Money(Sum({<ТипДокумента={'OutOfStock'}, ТипПериода={'Current'}>} Сумма),'# ##0')
label: Торговые дни регламентные 
comment: Максимально возможное количество дней наличия на складе товара
---
set: ДниДефицитаРегламентные
definition: Money($(ТорговыеДниРегламентные)-RangeMin($(ТорговыеДниРегламентные),$(ТорговыеДни)),'# ##0')
label: Дни дефицита регламентные
comment: Количество дней отсутствия товара на складах
---
set: OutOfStock
definition: Money((1-$(ТорговыеДни)/$(ТорговыеДниРегламентные)),'# ##0,00%')
label: %OOS
comment: Out Of Stock (отношение в днях)
---
set: ТорговыеДниПредГод
definition: Money(Sum({<ТипДокумента={'OutOfStock'}, ТипПериода={'Год'}>} Количество),'# ##0')
label: Торговые дни пред год
comment: Количество дней наличия на складе на начало торгового дня (с учетом продаж) пред год
---
set: ТорговыеДниРегламентныеПредГод
definition: Money(Sum({<ТипДокумента={'OutOfStock'}, ТипПериода={'Год'}>} Сумма),'# ##0')
label: Торговые дни регламентные пред год
comment: Максимально возможное количество дней наличия на складе матричного товара пред год 
---
set: ДниДефицитаРегламентныеПредГод
definition: Money($(ТорговыеДниРегламентныеПредГод)-RangeMin($(ТорговыеДниРегламентныеПредГод),$(ТорговыеДниПредГод)),'# ##0')
label: Дни дефицита регламентные пред год
comment: Количество дней отсутствия товара на складах пред год
---
set: OutOfStockПредГод
definition: Money((1-$(ТорговыеДниПредГод)/$(ТорговыеДниРегламентныеПредГод)),'# ##0,00%')
label: %OOS пред год
comment: Out Of Stock (отношение в днях) пред год
---
set: ПроцентOutOfStockПредГод
definition: Money($(OutOfStock)/$(OutOfStockПредГод),'# ##0,00%')
label: %OOS к пред году
comment: Процент от %OOS к предыдущему году
---
set: ТорговыеДниПредМес
definition: Money(Sum({<ТипДокумента={'OutOfStock'}, ТипПериода={'ГодМесяц'}>} Количество),'# ##0')
label: Торговые дни пред месяц
comment: Количество дней наличия на складе на начало торгового дня (с учетом продаж) пред месяц
---
set: ТорговыеДниРегламентныеПредМес
definition: Money(Sum({<ТипДокумента={'OutOfStock'}, ТипПериода={'ГодМесяц'}>} Сумма),'# ##0')
label: Торговые дни регламентные пред месяц
comment: Максимально возможное количество дней наличия на складе матричного товара пред месяц 
---
set: ДниДефицитаРегламентныеПредМес
definition: Money($(ТорговыеДниРегламентныеПредМес)-RangeMin($(ТорговыеДниРегламентныеПредМес),$(ТорговыеДниПредМес)),'# ##0')
label: Дни дефицита регламентные пред месяц
comment: Количество дней отсутствия товара на складах пред месяц
---
set: OutOfStockПредМес
definition: Money((1-$(ТорговыеДниПредМес)/$(ТорговыеДниРегламентныеПредМес)),'# ##0,00%')
label: %OOS пред месяц
comment: Out Of Stock (отношение в днях) пред месяц
---
set: ПроцентOutOfStockПредМес
definition: Money($(OutOfStock)/$(OutOfStockПредМес),'# ##0,00%')
label: %OOS к пред месяцу
comment: Процент от %OOS к предыдущему месяцу
---
set: СуммаРостаOutOfStockПредМес
definition: Money($(OutOfStock)-$(OutOfStockПредМес),'# ##0,00')
label: Рост %OOS к пред месяцу
comment: Рост %OOS к предыдущему месяцу
---
set: ТорговыеДниПредГод2
definition: Money(Sum({<ТипДокумента={'OutOfStock'}, ТипПериода={'Год-2'}>} Количество),'# ##0')
label: Торговые дни предпред год
comment: Количество дней наличия на складе на начало торгового дня (с учетом продаж) предпред год
---
set: ТорговыеДниРегламентныеПредГод2
definition: Money(Sum({<ТипДокумента={'OutOfStock'}, ТипПериода={'Год-2'}>} Сумма),'# ##0')
label: Торговые дни регламентные предпред год
comment: Максимально возможное количество дней наличия на складе матричного товара предпред год 
---
set: ДниДефицитаРегламентныеПредГод2
definition: Money($(ТорговыеДниРегламентныеПредГод2)-RangeMin($(ТорговыеДниРегламентныеПредГод2),$(ТорговыеДниПредГод2)),'# ##0')
label: Дни дефицита регламентные предпред год
comment: Количество дней отсутствия товара на складах предпред год
---
set: OutOfStockПредГод2
definition: Money((1-$(ТорговыеДниПредГод2)/$(ТорговыеДниРегламентныеПредГод2)),'# ##0,00%')
label: %OOS предпред год
comment: Out Of Stock (отношение в днях) предпред год
---
set: ПроцентOutOfStockПредГод2
definition: Money($(OutOfStock)/$(OutOfStockПредГод2),'# ##0,00%')
label: %OOS к предпред году
comment: Процент от %OOS к предпредыдущему году
---
set: Матрица
definition: (Sum({<$(СбросФильтраПоОстаткамПоДням),_ФлагДействующаяДата={1},ТипПериода={'OnHand_Sum'},ТипДокумента={'ChangeMatrix'}>} Сумма) + Sum({<$(СбросФильтраПоОстаткамПоДням), _ФлагДействующаяДата={1},ТипПериода={'OnHand_Eom'},ТипДокумента={'OutOfStock'}>} ВП))
label: Матрица
comment: Статус матрицы
---
set: ПланOutOfStock
definition: 0
label:Плановый %OOS
comment: Плановый %Out Of Stock
---
set: ПланOutOfStockПолный
definition: 0
label:Плановый %OOS за полный месяц
comment: Плановый %Out Of Stock за полный месяц
---
set: ПФ_OutOfStock
definition: Money(($(OutOfStock))/($(ПланOutOfStock)),'# ##0,00%')
label:ПФ %OOS
comment: Факт к плану %Out Of Stock
---
set: П_Ф_OutOfStock
definition: Money(($(OutOfStock))-($(ПланOutOfStock)),'# ##0,00')
label:ПФ %OOS
comment: Факт к плану %Out Of Stock
---
set: ДниНаличияНаОстатке
definition: Money(Sum({<ТипДокумента={'OutOfStock'}, ТипПериода={'Current'}>} Количество),'# ##0')
label: Количество дней наличия на складе
comment: Количество дней наличия на складе матричного товара на начало торгового дня (с учетом продаж)
---
set: ДниНаличияНаОстаткеПредМес
definition: Money(Sum({<ТипДокумента={'OutOfStock'}, ТипПериода={'ГодМесяц'}>} Количество),'# ##0')
label: Количество дней наличия на складе пред мес
comment: Количество дней наличия на складе матричного товара на начало торгового дня (с учетом продаж) предыдущий месяц
---
set: ВПСреднедневная
definition: Money(($(СуммаВП)/$(ДниНаличияНаОстатке)),'# ##0,00')
label: ВП Среднедневная руб.
comment: Среднедневная валовая прибыль руб. за выбранный период
---
set: ВПСреднедневнаяПредрассчитанная
definition: Money((Max({<ТипДокумента={'OutOfStock'}, ТипПериода={'Current'}, _МесяцПоПорядку={"$(=Max({<_ФлагДействующаяДата={1}>}_МесяцПоПорядку))"}>} Себестоимость)),'# ##0,00')
label: ВП Среднедневная руб.
comment: Среднедневная валовая прибыль руб. за выбранный период
---
set: ВПСреднедневнаяПредрассчитаннаяПредМес
definition: Money((Sum({<ТипДокумента={'OutOfStock'}, ТипПериода={'ГодМесяц'}, _МесяцПоПорядку={"$(=Max({<_ФлагДействующаяДата={1}>}_МесяцПоПорядку))"}>} Себестоимость)),'# ##0,00')
label: ВП Среднедневная руб.
comment: Среднедневная валовая прибыль руб. за выбранный период
---
set: ВПСреднедневнаяПредМесТысРуб
definition: Money(($(ВППредМес)/$(ДниНаличияНаОстаткеПредМес)),'# ##0,00')
label: ВП Среднедневная руб. пред мес
comment: Среднедневная валовая прибыль руб. за предыдущий месяц
---
set: УпущеннаяВПТысДинамика
definition: Money(Sum(Aggr($(ДниДефицитаРегламентные) * $(ВПСреднедневная),НоменклатураСсылка,СкладСсылка))/1000,'# ##0,00')
label: Упущенная прибыль тыс. руб.
comment: Упущенная ВП в тыс.руб.
---
set: УпущеннаяВП
definition: Money(Sum(Aggr($(ДниДефицитаРегламентные) * $(ВПСреднедневнаяПредрассчитанная),НоменклатураСсылка,СкладСсылка)),'# ##0,00')
label: Упущенная прибыль руб.
comment: Упущенная ВП в рублях
---
set: УпущеннаяВПТыс
definition: Money(Sum(Aggr($(ДниДефицитаРегламентные) * $(ВПСреднедневнаяПредрассчитанная),НоменклатураСсылка,СкладСсылка))/1000,'# ##0,00')
label: Упущенная прибыль тыс. руб.
comment: Упущенная ВП в тыс.руб.
---
set: УпущеннаяВПТысПредМес
definition: Money(Sum(Aggr($(ДниДефицитаРегламентныеПредМес) * $(ВПСреднедневнаяПредрассчитаннаяПредМес),НоменклатураСсылка,СкладСсылка))/1000,'# ##0,00')
label: Упущенная прибыль тыс. руб. пред мес
comment: Упущенная ВП в тыс.руб. за предыдущий месяц
---
set: УпущеннаяВПТысДинамикаПредМес
definition: Money(Sum(Aggr($(ДниДефицитаРегламентныеПредМес) * $(ВПСреднедневнаяПредМесТысРуб),НоменклатураСсылка,СкладСсылка)),'# ##0,00')
label: Упущенная прибыль тыс. руб. пред мес
comment: Упущенная ВП в тыс.руб. за предыдущий месяц
---
set: ПроцентУпущеннаяВПТысПредМес
definition: Money($(УпущеннаяВПТыс)/$(УпущеннаяВПТысПредМес),'# ##0,00%')
label: % Упущенной прибыли тыс. руб. к пред мес
comment: Процент Упущенной прибыли к предыдущему месяцу
---
set: СуммаРостаУпущеннаяВПТысПредМес
definition: Money($(УпущеннаяВПТыс)-$(УпущеннаяВПТысПредМес),'# ##0,00')
label: Сумма роста Упущенной прибыли к пред мес
comment: Сумма роста Упущенной прибыли к предыдущему месяцу
#SECTION :Константы
---
set: Мульти_Поиск_Товаров
definition: ""
---
set: Мульти_Поиск_СкладТовар
definition: ""
---
set: Тап_на_Вкладке_Остатки
definition: 
 3
---
set: Тап_АнализПродаж
definition: 
 0
label: ТТап_АнализПродаж
---
set: ЦветПлан
definition: lightRed()
label: ЦветПродаж
---
set: ЦветПрцПГ
definition: rgb(27,125,156)
label: ЦветПродаж
---
set: ШрифтЦветПрцПГ
definition: rgb(27,125,156)
label: ЦветПродаж
---
set: ЦветОшибки
definition: 
 rgb(214,231,248)
label: ЦветОшибки
---
set: ЦветПродаж
definition: 
 rgb(98,196,227)
label: ЦветПродаж
---
set: ЦветВП
definition: 
 rgb(173,194,214)
label: ЦветВП
---
set: ЦветОстатки
definition: 
 rgb(202,225,123)
label: ЦветОстатки
---
set: ЦветТрафик
definition: 
 rgb(202,115,123)
label: ЦветТрафик
---
set: ЦветКонверсия
definition: 
 rgb(202,200,123)
label: ЦветКонверсия
---
set: ЦветКолСделок
definition: 
 rgb(0,172,172)
label: ЦветСделок
---
set: ЦветКолПродаж
definition: 
 rgb(211,81,18)
label: ЦветКоличестваПродаж
---
set: ЦветСуммаОплаты
definition: 
 rgb(202,160,123)
label: ЦветСуммаОплаты
---
set: ЦветПенетрация
definition: 
 rgb(74,120,123)
label: ЦветПенетрация
---
set: ЦветСрЧек
definition: 
 rgb(252,115,98)
label: ЦветСрЧек
---
set: ЦветСуммаСписаний
definition: 
 rgb(74,120,123)
label: ЦветСуммаСписаний
---
set: ЦветСуммаСкидки
definition: 
 rgb(237,154,80)
label: ЦветСуммаСкидки
---
set: ЦветПроцентСкидки
definition: 
 rgb(185,159,83)
label: ЦветПроцентСкидки
---
set: ЦветНаценка
definition: 
 rgb(156,181,205)
label: ЦветНаценка
---
set: ЦветОборачиваемость
definition: 
 rgb(235,205,40)
label: ЦветОборачиваемость
---
set: ЦветПрцНаценка
definition: 
 rgb(142,152,185)
label: ЦветПрцНаценка
---
set: ЦветOutOfStock
definition: 
 rgb(86,145,203)
label: ЦветOutOfStock
---
set: ЦветПредГод
definition: 
 rgb(200,200,200)
label: ЦветПредГод
---
set: ЦветПредПредГод
definition: 
 rgb(220,220,200)
label: ЦветПредПредГод
---
set: ЦветПФ
definition: 
 red()
label: ЦветПФ
---
set: ЦветПроцентПредГод
definition: green()
label: ЦветПроцентПредГод
---
set: ЦветАктКнопки
definition: 
 rgb(102,255,140)
label: ЦветАктКнопки
---
set: ЦветНеАктКнопки
definition: 
 rgb(199,226,226)
label: ЦветНеАктКнопки
---
set: ЦветДлинаЧека
definition: 
 rgb(86,145,203)
label: ЦветДлинаЧека
---
set: СкроллИзмерении
definition: 0
---
set: СкроллИзмерений2
definition: 15
---
set: Тап_на_Вкладке_Динамика
definition: 0
---
set: Тап_ВидДиаграммы
definition: 0
---
set: Показать
definition: 1
---
set: Скрыть
definition: 0
---
set: ЗаливкаПФ
definition: if ($1 <= 0 OR IsNull($1), rgb(255,255,255),  
	if($1 >= 1.001,rgb(128,255,255),
	if($1 >= 0.95,rgb(128,255,128),
	if($1 >= 0.90 ,rgb(225,255,170),
	if($1 >= 0.8,rgb(255,182,147),
	if($1 >= 0 ,lightRed(),rgb(255,255,255)) )))))
---
set: ЗаливкаПФОбратная
definition: if ($1 <= 0 OR IsNull($1), rgb(255,255,255),  
	if($1 <= 0.80,rgb(128,255,255),
	if($1 <= 0.90,rgb(128,255,128),
	if($1 <= 0.95 ,rgb(225,255,170),
	if($1 <= 1.0,rgb(255,182,147),
	if($1 <= 1000000 ,lightRed(190),rgb(255,255,255)) )))))
---
set: Заливка_ПФ_Продажи
macro: ЗаливкаПФ
	- $(ПФ_Продажи)
---
set: Заливка_ПФ_ВП
macro: ЗаливкаПФ
	- $(ПФ_ВП)
---
set: Заливка_ПФ_Наценка
macro: ЗаливкаПФ
	- $(ПФРентВП)
---
set: Заливка_ПФ_Остатки
macro: ЗаливкаПФОбратная
	- $(ПФ_Остатки)
---
set: Заливка_ПФ_Оборачиваемость
macro: ЗаливкаПФОбратная
	- $(ПФ_Оборачиваемость)


---
set: ЦветВычКолонки
definition: 
rgb(230,230,230)
label: ЦветВычКолонки

---
set: ШрифтЦветПФ
definition: Red()
label: ЦветПродаж
---
set: ШрифтЦветПлан
definition: rgb(255,255,255)
label: ЦветПродаж
---
set: ШрифтЦветПродаж
definition: rgb(255,255,255)
label: ЦветПродаж
---
set: ШрифтЦветВП
definition: 
 rgb(255,255,255)
label: ШрифтЦветВП
---
set: ШрифтЦветОстатки
definition: 
 rgb(80,80,80)
label: ЦветОстатки
---
set: ШрифтЦветТрафик
definition: 
 rgb(255,255,255)
label: ЦветТрафик
---
set: ШрифтЦветКонверсия
definition: 
 rgb(80,80,80)
label: ЦветКонверсия
---
set: ШрифтЦветКолСделок
definition: 
 rgb(255,255,255)
label: ЦветСделок
---
set: ШрифтЦветСуммаОплаты
definition: 
 rgb(255,255,255)
label: ЦветСуммаОплаты
---
set: ШрифтЦветПенетрация
definition: 
 rgb(80,80,80)
label: ЦветПенетрация
---
set: ШрифтЦветСрЧек
definition: 
 rgb(80,80,80)
label: ЦветСрЧек
---
set: ШрифтЦветСуммаСкидки
definition: 
 rgb(80,80,80)
label: ЦветСуммаСкидки
---
set: ШрифтЦветПроцентСкидки
definition: 
 rgb(80,80,80)
label: ЦветПроцентСкидки
---
set: ШрифтЦветНаценка
definition: 
 rgb(80,80,80)
label: ЦветНаценка
---
set: ШрифтЦветОборачиваемость
definition: 
 rgb(80,80,80)
label: ЦветОборачиваемость
---
set: ШрифтЦветПрцНаценка
definition: 
 rgb(80,80,80)
label: ЦветПрцНаценка
---
set: ШрифтЦветOutOfStock
definition: 
 rgb(255,255,255)
label: ШрифтЦветOutOfStock
---
set: ШрифтЦветПредГод
definition: 
rgb(80,80,80)
label: ЦветПредГод
---
set: ШрифтЦветПредПредГод
definition: 
rgb(80,80,80)
label: ЦветПредПредГод
---
set: ТОППодгрупп
definition: 20
label: Топ подгрупп

#SECTION Верификация
---
set: ПродажаПроверкаФакт
definition: Money(Sum({$<ТипДокумента = {VERIFY},ТипПериода={'Current'}>}Сумма),'# ##0,00')
label: Проверка продажи ИТОГО
comment: Проверка - суммы продажи из Excel
---
set: ПродажаПроверкаРасхождение
definition: Money($(СуммаПродажи) - $(ПродажаПроверкаФакт),'# ##0,00')
label: Проверка продажи расхождение
comment: Расхождение с Excel по сумме продаж
---
set: ВППроверкаФакт
definition: Money(Sum({$<ТипДокумента = {VERIFY},ТипПериода={'Current'}>}ВП),'# ##0,00')
label: Проверка ВП ИТОГО
comment: Проверка - суммы ВП из Excel
---
set: ВППроверкаРасхождение
definition: Money($(СуммаВП) - $(ВППроверкаФакт),'# ##0,00')
label: Проверка ВП расхождение
comment: Расхождение с Excel по ВП
#SECTION Переменные пользователького интерфейса
---
set: Динамика 
definition: 0
---
set: periodSetMode 
definition: 0
---
let: periodStart 
definition: MakeDate(2014)
---
let: periodEnd
definition: MakeDate(2014)
---
let: Детально
definition: 0
---
let: ВыборСортировка
definition: -1
---
let: ВыборТипаГрадиента
definition: 1
---
set: КоличествоСКУОстаток
definition: Count({<ТипДокумента={'OnHandEoM'},
	_МесяцПоПорядку={'$(=Max({<_ФлагДействующаяДата={1}>} _МесяцПоПорядку))'}, 
		Количество ={'>0'},ТипПериода={'Current'}>} DISTINCT НоменклатураКод)
label: Кол SKU на остатке
comment: Количество SKU на остатке
---
set: КоличествоСКУПродано
definition: Money(Count({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},ТипПериода={'Current'}>} DISTINCT НоменклатураКод),'# ##0,00')
label: Кол SKU продано
comment: Количество проданных SKU
---
set: КоличествоСКУПроданоПредМес
definition: Money(Count({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},
				ТипПериода={'ГодМесяц'}>}DISTINCT НоменклатураКод),'# ##0,00')
label: Кол SKU продано пред мес
comment: Количество продано SKU за предыдущий мес  
---
set: ПроцентКоличествоСКУПроданоПредМес
definition: Money($(КоличествоСКУПродано)/$(КоличествоСКУПроданоПредМес),'# ##0,00%')
label: % Кол SKU продано к пред мес
comment: Процент Количество проданных SKU к предыдущему месяцу
---
set: СуммаРостаКоличествоСКУПроданоПредМес
definition: Money($(КоличествоСКУПродано)-$(КоличествоСКУПроданоПредМес),'# ##0,00')
label: ∆ изм. Кол SKU продано к пред мес
comment: Сумма роста Количество продано SKU к предыдущему месяцу
---
set: КоличествоСКУПроданоПредГод
definition: Money(Count({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},
				ТипПериода={'Год'}>}DISTINCT НоменклатураКод),'# ##0')
label: Кол SKU продано пред. (1) Год, шт
comment: Количество продано SKU за предыдущий год, шт
---
set: ПроцентКоличествоСКУПроданоПредГод
definition: Money($(КоличествоСКУПродано)/$(КоличествоСКУПроданоПредГод),'# ##0,00%')
label: % Кол SKU продано к пред. (1) Год
comment: Процент Количество проданных SKU к предыдущему году
---
set: СуммаРостаКоличествоСКУПроданоПредГод
definition: Money($(КоличествоСКУПродано)-$(КоличествоСКУПроданоПредГод),'# ##0,00')
label:∆ изм. Кол SKU продано к пред. (1) Год, шт
comment: Сумма роста Количество продано SKU к предыдущему году, шт
---
set: КоличествоСКУПроданоПредГод2
definition: Money(Count({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},
				ТипПериода={'Год-2'}>}DISTINCT НоменклатураКод),'# ##0,00')
label: Кол SKU продано пред. (2) Год, шт
comment: Количество продано SKU за предпредыдущий год, шт
---
set: ПроцентКоличествоСКУПроданоПредГод2
definition: Money($(КоличествоСКУПродано)/$(КоличествоСКУПроданоПредГод2),'# ##0,00%')
label: % Кол SKU продано к пред. (2) Год
comment: Процент Количество проданных SKU к предпредыдущему году
---
set: СуммаРостаКоличествоСКУПроданоПредГод2
definition: Money($(КоличествоСКУПродано)-$(КоличествоСКУПроданоПредГод2),'# ##0,00')
label:∆ изм. Кол SKU продано к пред. (2) Год, шт
comment: Сумма роста Количество продано SKU к предпредыдущему году, шт
---
set: КоличествоСКУПроданоПредГодДеньНедели
definition: Money(Count({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},
				ТипПериода={'ГодДеньНедели'}>}DISTINCT НоменклатураКод),'# ##0,00')
label: Кол SKU продано пред. (1) Год тот же день недели, шт
comment: Количество продано SKU за предыдущий год, шт
---
set: ПроцентКоличествоСКУПроданоПредГодДеньНедели
definition: Money($(КоличествоСКУПродано)/$(КоличествоСКУПроданоПредГодДеньНедели),'# ##0,00%')
label: % Кол SKU продано к пред. (1) Год тот же день недели
comment: Процент Количество проданных SKU к предыдущему году тот же день недели
---
set: СуммаРостаКоличествоСКУПроданоПредГодДеньНедели
definition: Money($(КоличествоСКУПродано)-$(КоличествоСКУПроданоПредГодДеньНедели),'# ##0,00')
label:∆ изм. Кол SKU продано к пред. (1) Год тот же день недели, шт
comment: Сумма роста Количество продано SKU к предыдущему году тот же день недели, шт
---
set: КоличествоСКУПроданоПредГод2ДеньНедели
definition: Money(Count({<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},
				ТипПериода={'Год2ДеньНедели'}>}DISTINCT НоменклатураКод),'# ##0,00')
label: Кол SKU продано пред. (2) Год тот же день недели, шт
comment: Количество продано SKU за предпредыдущий год тот же день недели, шт
---
set: ПроцентКоличествоСКУПроданоПредГод2ДеньНедели
definition: Money($(КоличествоСКУПродано)/$(КоличествоСКУПроданоПредГод2ДеньНедели),'# ##0,00%')
label: % Кол SKU продано к пред. (2) Год тот же день недели
comment: Процент Количество проданных SKU к предпредыдущему году тот же день недели
---
set: СуммаРостаКоличествоСКУПроданоПредГод2ДеньНедели
definition: Money($(КоличествоСКУПродано)-$(КоличествоСКУПроданоПредГод2ДеньНедели),'# ##0,00')
label:∆ изм. Кол SKU продано к пред. (2) Год тот же день недели, шт
comment: Сумма роста Количество продано SKU к предпредыдущему году тот же день недели, шт
---
set: КоличествоСКУПроданоПлан
definition: Money(Max({<_ФлагДействующаяДата={1},ТипДокумента={'SalePlan'},ТипПериода={'Current'}>} Количество),'# ##0,00')
label: Кол SKU продано план
comment: Количество проданных SKU план
---
set: КоличествоСКУПроданоПФ
definition: Money($(КоличествоСКУПродано)/$(КоличествоСКУПроданоПлан),'# ##0,00%')
label: ПФ кол SKU продано 
comment: Количество проданных SKU факт к плану
---
set: КоличествоСКУПродано_П_Ф
definition: Money($(КоличествоСКУПродано) - $(КоличествоСКУПроданоПлан),'# ##0,00')
label: ∆ П-Ф SKU продано
comment: Количество проданных SKU факт минус план 

#SECTION :Матричный товара
---
set: КоличествоСКУМатричныхОстаток
definition: Count({<ТипДокумента={'OnHandEoM'},МатричныйТовар={'Матричный'},
	_МесяцПоПорядку={'$(=Max({<_ФлагДействующаяДата={1}>} _МесяцПоПорядку))'}, 
		Количество ={'>0'},ТипПериода={'Current'}>} DISTINCT НоменклатураКод)
label: Кол матричных SKU на остатке
comment: Количество матричных SKU на остатке
---
set: КоличествоСКУМатричных
definition: Count({<Год,Месяц,Дата,ГодМесяц,Квартал,Полугодие,День,ДеньНедели,ГодМесяц,МатричныйТовар={'Матричный'}>} DISTINCT НоменклатураКод)
label: Кол матричных SKU план
comment: Количество матричных SKU план
---
set: МатричностьНаСейчас
definition: Max({<Год,Месяц,Дата,ГодМесяц,Квартал,Полугодие,День,ДеньНедели,ГодМесяц>}МатричныйТовар)
label: Матричность
comment: Признак матричности на текущий день


#SECTION :Комплексный анализ
---
set: ДатаВыводаИзАссортимента
definition: min(ДатаВывода)
label: Дата вывода из ассортимента
comment: Дата вывода из ассортимента
---
set: ДатаВводаВАссортимент
definition: min(ДатаВвода)
label: Дата ввода в ассортимент
comment: Дата первого ввода в ассортимент
---
set: ПослДатаПоследнейПереоценки
definition: min(ДатаПоследнейПереоценки)
label: Дата последней переоценки
comment: Дата последней переоценки
---
set: ПослЦенаТекущаяРозничная
definition: Money(min(ЦенаТекущаяРозничная),'# ##0,00')
label: Розничная цена (на полке), руб
comment: Действующая розничная цена на полке, руб
---
set: ПослДатаПоследнейЗакупки
definition: Money(min(ДатаПоследнейЗакупки),'# ##0,00')
label: Дата последней закупки
comment: Дата последней закупки
---
set: GMROI
definition: Money(($(СуммаВП)/Sum({<ТипДокумента = {'OnHandSum'},ТипПериода={'Current'}>} Себестоимость))*365,'# ##0,00%')
label: GMROI
comment: Факт GMROI % доходности на вложенный капитал в % годовых. (Ввловая прибыль отнесенная к остаткам в закупочных ценах)
---
set: Эффективность
definition: Money((($(СуммаВП))/(Sum({<ТипДокумента = {'OnHandSum'},ТипПериода={'Current'}>} Себестоимость) / $(КоличествоДней)))*1000,'# ##0,00')
label: Доход, руб на 1000 руб остатков.
comment: Эффективность остатков, руб. ( Сколько рублей мы зарабатываем на 1000 рублей остатков)
---
set: СредняяЦенаПродажи
definition: Money(Avg({$<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},ТипПериода={'Current'} $(=if($0<>2,'',',$1={$2}'))>}Сумма/Количество),'# ##0,00')
label: Розничная цена средняя (факт), руб
comment: Средняя фактическая розничная цена за выбранный период, руб
---
set: СредневзвешаннаяЦенаПродажи
definition: Money(Sum({$<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},ТипПериода={'Current'} $(=if($0<>2,'',',$1={$2}'))>}Сумма)/
	Sum({$<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},ТипПериода={'Current'} $(=if($0<>2,'',',$1={$2}'))>} Количество),'# ##0,00')
label: Средневзвешенная цена за период, руб
comment: Средневзвешенная розничная цена за выбранный период, руб
---
set: СредняяСебестоимостьПродажи
definition: Money(Avg({$<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},ТипПериода={'Current'} $(=if($0<>2,'',',$1={$2}'))>}Себестоимость/Количество),'# ##0,00')
label: Средняя себестоимость штуки за период, руб
comment: Средняя себестоимость штуки за выбранный период, руб
---
set: СредневзвешаннаяСебестоимостьПродажи
definition: Money(Sum({$<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},ТипПериода={'Current'} $(=if($0<>2,'',',$1={$2}'))>}Себестоимость)/
	Sum({$<ТипДокумента = {'Sales'},_ФлагДействующаяДата={1},ТипПериода={'Current'} $(=if($0<>2,'',',$1={$2}'))>} Количество),'# ##0,00')
label: Средневзвешенная себестоимость за период, руб
comment: Средневзвешенная себестоимость за выбранный период, руб
---
set: СредневзвешаннаяЦенаЗакупки
definition: Money(Sum(TOTAL<КодСкладНоменклатура> Aggr(Sum({$<ТипДокумента = {'Purch'},_ФлагДействующаяДата={1}, ТипПериода={'Current'}>}Себестоимость)/
Sum({$<ТипДокумента = {'Purch'},_ФлагДействующаяДата={1}, ТипПериода={'Current'}>} Количество),НоменклатураСсылка)),'# ##0,00')
label: Средневзвешенная цена закупки за период, руб
comment: Средневзвешенная цена закупки за выбранный период, руб
---
set: ПродажиСредняяРазоваяПокупкаРуб
definition: Money(Sum({<ТипДокумента = {'Sales'},ТипПериода={'Current'}>}Сумма)/$(КоличествоЧеков),'# ##0,00')
label: Средняя разовая покупка, руб
comment: Средняя разовая покупка, руб
---
set: СреднееКоличествоТовараСделки
definition: Money(Sum({<ТипДокумента = {'Sales'},ТипПериода={'Current'}>}Количество)/$(КоличествоЧеков),'# ##0,00')
label: Средняя разовая покупка, шт
comment: Средняя разовая покупка, шт
---
set: ПотенциальнаяНаценка
definition: Money(($(ОстатокВЦенахПродажНаКонецПериодаРуб) - $(ОстатокСебестоимостьНаКонецПериода_Формула)) 
	/ $(ОстатокСебестоимостьНаКонецПериода_Формула),'# ##0,00%')
label: Потенциальная Маржа, в %
comment: Потенциальная Маржа исходя из  остатков на конец периода с НДС и текущих цен продаж
---
set: ОстатокВЦенахПродажНаКонецПериодаРуб
definition: Money(Sum(Aggr($(ОстатокШтукНаКонецПериода_Формула) * Min(ЦенаТекущаяРозничная),
		НоменклатураСсылка, СкладСсылка)),'# ##0,00')
label: Остатки в дейст. розничных ценах, руб
comment: Складские остатки в действующих розничных ценах продажи на конец периода, в рублях
---
set: ОстатокВЦенахПродажНаКонецПериодаТысРуб
definition: Money(Sum(Aggr($(ОстатокШтукНаКонецПериода_Формула) * Min(ЦенаТекущаяРозничная),
		НоменклатураСсылка, СкладСсылка))/1000,'# ##0,00')
label: Остатки в дейст. розничных ценах, тыс.руб.
comment: Складские остатки в действующих розничных ценах продажи на конец периода, в тыс.руб.
---
set: ОстатокВЦенахПоследнейЗакупкиНаКонецПериодаРуб
definition: Money(Sum(Aggr($(ОстатокШтукНаКонецПериода_Формула) * Min(ЦенаПоследнейЗакупки),
		НоменклатураСсылка, СкладСсылка)),'# ##0,00')
label: Остатки в посл закуп. Ценах, руб
comment: Складские остатки в последних закупочных ценах на конец периода, руб
#SECTION :Закупки
---
set: СуммаЗакупки
definition: Money(Sum({<ТипДокумента={'Purch'}, ТипПериода={'Current'}>}СебестоимостьБезТранспортных),'# ##0,00')
label: Сумма закупки руб.
comment: Сумма закупки в руб.
---
set: СуммаЗакупкиТыс
definition: Money(Sum({<ТипДокумента={'Purch'}, ТипПериода={'Current'}>}СебестоимостьБезТранспортных)/1000,'# ##0,00')
label: Сумма закупки тыс.руб.
comment: Сумма закупки в тыс.руб.
---
set: СуммаЗакупкиПредГод
definition: Money(Sum({<ТипДокумента={'Purch'}, ТипПериода={'Год'}>}СебестоимостьБезТранспортных),'# ##0,00')
label: Сумма закуплено пред. (1) Год, шт
comment: Сумма закуплено за предыдущий год, штук
---
set: ПроцентСуммаЗакупкиПредГод
definition: Money($(СуммаЗакупкиТыс)/$(СуммаЗакупкиПредГод),'# ##0,00')
label: % Суммы закуплено к пред. (1) Год
comment: Процент суммы закуплено к предыдущему году
---
set: СуммаРостаСуммаЗакупкиПредГод
definition: Money($(СуммаЗакупкиТыс)-$(СуммаЗакупкиПредГод),'# ##0,00')
label: Рост суммы закуплено к пред. (1) Год, шт
comment: Рост суммы закуплено к предыдущему году, штук
---
set: СуммаЗакупкиПредМесяц
definition: Money(Sum({<ТипДокумента={'Purch'}, ТипПериода={'ГодМесяц'}>}СебестоимостьБезТранспортных),'# ##0,00')
label: Сумма закуплено пред месяц, шт
comment: Сумма закуплено за предыдущий месяц, штук
---
set: ПроцентСуммаЗакупкиПредМесяц
definition: Money($(СуммаЗакупкиТыс)/$(СуммаЗакупкиПредМесяц),'# ##0,00')
label: % суммы закуплено к пред месяцу
comment: Процент суммы закуплено к предыдущему месяцу
---
set: СуммаРостаСуммаЗакупкиПредМесяц
definition: Money($(СуммаЗакупкиТыс)-$(СуммаЗакупкиПредМесяц),'# ##0,00')
label: Рост суммы закуплено к пред месяцу, шт
comment: Рост суммы закуплено к предыдущему месяцу, штук
---
set: СуммаЗакупкиПредГод2
definition: Money(Sum({<ТипДокумента={'Purch'}, ТипПериода={'Год-2'}>}СебестоимостьБезТранспортных),'# ##0,00')
label: Сумма закуплено пред. (2) Год, шт
comment: Сумма закуплено за предпредыдущий год, штук
---
set: ПроцентСуммаЗакупкиПредГод2
definition: Money($(СуммаЗакупкиТыс)/$(СуммаЗакупкиПредГод2),'# ##0,00')
label: % суммы закуплено к пред. (2) Год
comment: Процент суммы закуплено к предпредыдущий году
---
set: СуммаРостаСуммаЗакупкиПредГод2
definition: Money($(СуммаЗакупкиТыс)-$(СуммаЗакупкиПредГод2),'# ##0,00')
label: Рост суммы закуплено к пред. (2) Год, шт
comment: Рост суммы закуплено к предпредыдущий году, штук
---
set: СуммаЗакупкиПредГодДеньНедели
definition: Money(Sum({<ТипДокумента={'Purch'}, ТипПериода={'ГодДеньНедели'}>}СебестоимостьБезТранспортных),'# ##0,00')
label: Сумма закуплено пред. (1) Год тот же день недели, шт
comment: Сумма закуплено за предыдущий год тот же день недели, штук
---
set: ПроцентСуммаЗакупкиПредГодДеньНедели
definition: Money($(СуммаЗакупкиТыс)/$(СуммаЗакупкиПредГодДеньНедели),'# ##0,00')
label: % суммы закуплено к пред. (1) Год тот же день недели
comment: Процент суммы закуплено к предыдущему году тот же день недели
---
set: СуммаРостаСуммаЗакупкиПредГодДеньНедели
definition: Money($(СуммаЗакупкиТыс)-$(СуммаЗакупкиПредГодДеньНедели),'# ##0,00')
label: Рост суммы закуплено к пред. (1) Год тот же день недели, шт
comment: Рост суммы закуплено к предыдущему году, штук
---
set: СуммаЗакупкиПредГод2ДеньНедели
definition: Money(Sum({<ТипДокумента={'Purch'}, ТипПериода={'Год2ДеньНедели'}>}СебестоимостьБезТранспортных),'# ##0,00')
label: Сумма закуплено пред. (2) Год тот же день недели, шт
comment: Сумма закуплено за предпредыдущий год тот же день недели, штук
---
set: ПроцентСуммаЗакупкиПредГод2ДеньНедели
definition: Money($(СуммаЗакупкиТыс)/$(СуммаЗакупкиПредГод2ДеньНедели),'# ##0,00')
label: % суммы закуплено к пред. (2) Год тот же день недели
comment: Процент суммы закуплено к предпредыдущий году тот же день недели
---
set: СуммаРостаСуммаЗакупкиПредГод2ДеньНедели
definition: Money($(СуммаЗакупкиТыс)-$(СуммаЗакупкиПредГод2ДеньНедели),'# ##0,00')
label: Рост суммы закуплено к пред. (2) Год тот же день недели, шт
comment: Рост суммы закуплено к предпредыдущий году тот же день недели, штук
---
set: КоличествоЗакупки
definition: Money(Sum({<ТипДокумента={'Purch'}, ТипПериода={'Current'}>}Количество),'# ##0,00')
label: Количество закуплено, шт
comment: Количество закуплено, шт
---
set: КоличествоЗакупкиПредГод
definition: Money(Sum({<ТипДокумента={'Purch'}, ТипПериода={'Год'}>}Количество),'# ##0,00')
label: Количество закуплено пред. (1) Год, шт
comment: Количество закуплено за предыдущий год, штук
---
set: ПроцентКоличествоЗакупкиПредГод
definition: Money($(КоличествоЗакупки)/$(КоличествоЗакупкиПредГод),'# ##0,00')
label: % количества закуплено к пред. (1) Год
comment: Процент количества закуплено к предыдущему году
---
set: СуммаРостаКоличествоЗакупкиПредГод
definition: Money($(КоличествоЗакупки)-$(КоличествоЗакупкиПредГод),'# ##0,00')
label: Рост количества закуплено к пред. (1) Год, шт
comment: Рост количества закуплено к предыдущему году, штук
---
set: КоличествоЗакупкиПредМесяц
definition: Money(Sum({<ТипДокумента={'Purch'}, ТипПериода={'ГодМесяц'}>}Количество),'# ##0,00')
label: Количество закуплено пред месяц, шт
comment: Количество закуплено за предыдущий месяц, штук
---
set: ПроцентКоличествоЗакупкиПредМесяц
definition: Money($(КоличествоЗакупки)/$(КоличествоЗакупкиПредМесяц),'# ##0,00')
label: % количества закуплено к пред месяцу
comment: Процент количества закуплено к предыдущему месяцу
---
set: СуммаРостаКоличествоЗакупкиПредМесяц
definition: Money($(КоличествоЗакупки)-$(КоличествоЗакупкиПредМесяц),'# ##0,00')
label: Рост количества закуплено к пред месяцу, шт
comment: Рост количества закуплено к предыдущему месяцу, штук
---
set: КоличествоЗакупкиПредГод2
definition: Money(Sum({<ТипДокумента={'Purch'}, ТипПериода={'Год-2'}>}Количество),'# ##0,00')
label: Количество закуплено пред. (2) Год, шт
comment: Количество закуплено за предпредыдущий год, штук
---
set: ПроцентКоличествоЗакупкиПредГод2
definition: Money($(КоличествоЗакупки)/$(КоличествоЗакупкиПредГод2),'# ##0,00')
label: % количества закуплено к пред. (2) Год
comment: Процент количества закуплено к предпредыдущий году
---
set: СуммаРостаКоличествоЗакупкиПредГод2
definition: Money($(КоличествоЗакупки)-$(КоличествоЗакупкиПредГод2),'# ##0,00')
label: Рост количества закуплено к пред. (2) Год, шт
comment: Рост количества закуплено к предпредыдущий году, штук
---
set: КоличествоЗакупкиПредГодДеньНедели
definition: Money(Sum({<ТипДокумента={'Purch'}, ТипПериода={'ГодДеньНедели'}>}Количество),'# ##0,00')
label: Количество закуплено пред. (1) Год тот же день недели, шт
comment: Количество закуплено за предыдущий год тот же день недели, штук
---
set: ПроцентКоличествоЗакупкиПредГодДеньНедели
definition: Money($(КоличествоЗакупки)/$(КоличествоЗакупкиПредГодДеньНедели),'# ##0,00')
label: % количества закуплено к пред. (1) Год тот же день недели
comment: Процент количества закуплено к предыдущему году тот же день недели
---
set: СуммаРостаКоличествоЗакупкиПредГодДеньНедели
definition: Money($(КоличествоЗакупки)-$(КоличествоЗакупкиПредГодДеньНедели),'# ##0,00')
label: Рост количества закуплено к пред. (1) Год тот же день недели, шт
comment: Рост количества закуплено к предыдущему году, штук
---
set: КоличествоЗакупкиПредГод2ДеньНедели
definition: Money(Sum({<ТипДокумента={'Purch'}, ТипПериода={'Год2ДеньНедели'}>}Количество),'# ##0,00')
label: Количество закуплено пред. (2) Год тот же день недели, шт
comment: Количество закуплено за предпредыдущий год тот же день недели, штук
---
set: ПроцентКоличествоЗакупкиПредГод2ДеньНедели
definition: Money($(КоличествоЗакупки)/$(КоличествоЗакупкиПредГод2ДеньНедели),'# ##0,00')
label: % количества закуплено к пред. (2) Год тот же день недели
comment: Процент количества закуплено к предпредыдущий году тот же день недели
---
set: СуммаРостаКоличествоЗакупкиПредГод2ДеньНедели
definition: Money($(КоличествоЗакупки)-$(КоличествоЗакупкиПредГод2ДеньНедели),'# ##0,00')
label: Рост количества закуплено к пред. (2) Год тот же день недели, шт
comment: Рост количества закуплено к предпредыдущий году тот же день недели, штук
#SECTION :Анализ чеков
---
set: КоличествоЧеков
definition: Money(Sum({<ТипПериода={'Current'}>} _СчетчикЧеков),'# ##0')
label: Количество чеков, шт
comment: Количество чеков, штук
---
set: КоличествоЧековТыс
definition: Money(Sum({<ТипПериода={'Current'}>} _СчетчикЧеков ) / 1000,'# ##0')
label: Количество чеков, тыс
comment: Количество чеков, в тысячах штук
---
set: КоличествоЧековПредГод
definition: Money(Sum({<ТипПериода={'Год'}>} _СчетчикЧеков),'# ##0')
label: Количество чеков пред. (1) Год, шт
comment: Количество чеков за предыдущий год, штук
---
set: ПроцентКоличествоЧековПредГод
definition: Money($(КоличествоЧеков)/$(КоличествоЧековПредГод),'# ##0,00')
label: % количества чеков к пред. (1) Год
comment: Процент количества чеков к предыдущему году
---
set: СуммаРостаКоличествоЧековПредГод
definition: Money($(КоличествоЧеков)-$(КоличествоЧековПредГод),'# ##0,00')
label: Рост количества чеков к пред. (1) Год, шт
comment: Рост количества чеков к предыдущему году, штук
---
set: КоличествоЧековПредМесяц
definition: Money(Sum({<ТипПериода={'ГодМесяц'}>} _СчетчикЧеков),'# ##0')
label: Количество чеков пред месяц, шт
comment: Количество чеков за предыдущий месяц, штук
---
set: ПроцентКоличествоЧековПредМесяц
definition: Money($(КоличествоЧеков)/$(КоличествоЧековПредМесяц),'# ##0,00')
label: % количества чеков к пред месяцу
comment: Процент количества чеков к предыдущему месяцу
---
set: СуммаРостаКоличествоЧековПредМесяц
definition: Money($(КоличествоЧеков)-$(КоличествоЧековПредМесяц),'# ##0,00')
label: Рост количества чеков к пред месяцу, шт
comment: Рост количества чеков к предыдущему месяцу, штук
---
set: КоличествоЧековПредГод2
definition: Money(Sum({<ТипПериода={'Год-2'}>} _СчетчикЧеков),'# ##0')
label: Количество чеков пред. (2) Год, шт
comment: Количество чеков за предпредыдущий год, штук
---
set: ПроцентКоличествоЧековПредГод2
definition: Money($(КоличествоЧеков)/$(КоличествоЧековПредГод2),'# ##0,00')
label: % количества чеков к пред. (2) Год
comment: Процент количества чеков к предпредыдущий году
---
set: СуммаРостаКоличествоЧековПредГод2
definition: Money($(КоличествоЧеков)-$(КоличествоЧековПредГод2),'# ##0,00')
label: Рост количества чеков к пред. (2) Год, шт
comment: Рост количества чеков к предпредыдущий году, штук
---
set: КоличествоЧековПредГодДеньНедели
definition: Money(Sum({<ТипПериода={'Год-2'}>} _СчетчикЧеков),'# ##0') Money(Sum({<ТипДокумента = {#CheckCount},ТипПериода={'ГодДеньНедели'}>}Количество),'# ##0,00')
label: Количество чеков пред. (1) Год тот же день недели, шт
comment: Количество чеков за предыдущий год тот же день недели, штук
---
set: ПроцентКоличествоЧековПредГодДеньНедели
definition: Money($(КоличествоЧеков)/$(КоличествоЧековПредГодДеньНедели),'# ##0,00')
label: % количества чеков к пред. (1) Год тот же день недели
comment: Процент количества чеков к предыдущему году тот же день недели
---
set: СуммаРостаКоличествоЧековПредГодДеньНедели
definition: Money($(КоличествоЧеков)-$(КоличествоЧековПредГодДеньНедели),'# ##0,00')
label: Рост количества чеков к пред. (1) Год тот же день недели, шт
comment: Рост количества чеков к предыдущему году, штук
---
set: КоличествоЧековПредГод2ДеньНедели
definition: Money(Sum({<ТипПериода={'Год2ДеньНедели'}>} _СчетчикЧеков),'# ##0')
label: Количество чеков пред. (2) Год тот же день недели, шт
comment: Количество чеков за предпредыдущий год тот же день недели, штук
---
set: ПроцентКоличествоЧековПредГод2ДеньНедели
definition: Money($(КоличествоЧеков)/$(КоличествоЧековПредГод2ДеньНедели),'# ##0,00')
label: % количества чеков к пред. (2) Год тот же день недели
comment: Процент количества чеков к предпредыдущий году тот же день недели
---
set: СуммаРостаКоличествоЧековПредГод2ДеньНедели
definition: Money($(КоличествоЧеков)-$(КоличествоЧековПредГод2ДеньНедели),'# ##0,00')
label: Рост количества чеков к пред. (2) Год тот же день недели, шт
comment: Рост количества чеков к предпредыдущий году тот же день недели, штук
---
set: СуммаПоЧекамТыс
definition: Money(Sum({<ТипПериода={'Current'}>} _СуммаПоЧеку) / 1000,'# ##0')
label: Сумма по чекам, т.р.
comment: Сумма по выбранным чекам в тыс. руб.
---
set: НаценкаПоЧекамТыс
definition: Money(Sum({<ТипПериода={'Current'}>} _НаценкаПоЧеку) / 1000,'# ##0')
label: ВП по чекам, т.р.
comment: Валовая прибыль по выбранным чекам в тыс. руб.
---
set: ПроцентНаценкиПоЧекам
definition: Money(Sum({<ТипПериода={'Current'}>} _НаценкаПоЧеку) / Sum({<ТипПериода={'Current'}>} _СебестоимостьПоЧеку),'# ##0%')
label: %Наценки по чекам.
comment: %Наценки по выбранным чекам в тыс. руб.
---
set: СуммаПоЧекамПредГод
definition: Money(Sum({<ТипПериода={'Год'}>} _СуммаПоЧеку),'# ##0')
label: Количество чеков пред. (1) Год, шт
comment: Количество чеков за предыдущий год, штук
---
set: СреднийЧек
definition: If($(КоличествоЧеков) = 0,0,Money($(СуммаПоЧекам)/$(КоличествоЧеков),'# ##0'))
label: Средний чек, руб
comment: Средний чек, руб
---
set: СреднийЧекПредГод
definition: Money($(СуммаПоЧекамПредГод)/$(КоличествоЧековПредГод),'# ##0,00')
label: Средний чек пред. (1) Год, руб
comment: Средний чек за предыдущий год, руб
---
set: ПроцентСреднийЧекПредГод
definition: Money($(СреднийЧек)/$(СреднийЧекПредГод),'# ##0,00')
label: % среднего чека к пред. (1) Год
comment: Процент роста среднего чеков к предыдущему году
---
set: СуммаРостаСреднийЧекПредГод
definition: Money($(СреднийЧек)-$(СреднийЧекПредГод),'# ##0,00')
label: Рост среднего чека к пред. (1) Год, руб
comment: Рост среднего чека к предыдущему году, руб
---
set: СреднийЧекПредМесяц
definition: Money($(ПродажиПредМесяцРуб)/$(КоличествоЧековПредМесяц),'# ##0,00')
label: Средний чек пред месяц, руб
comment: Средний чек за предыдущий месяц, руб
---
set: ПроцентСреднийЧекПредМесяц
definition: Money($(СреднийЧек)/$(СреднийЧекПредМесяц)),'# ##0,00')
label: % среднего чека к пред месяцу
comment: Процент среднего чека к предыдущему месяцу
---
set: СуммаРостаСреднийЧекПредМесяц
definition: Money($(СреднийЧек)-$(СреднийЧекПредМесяц)),'# ##0,00')
label: Рост среднего чека к пред месяцу, руб
comment: Рост среднего чека к предыдущему месяцу, руб
---
set: СреднийЧекПредГод2
definition: Money($(ПродажиПредГод2Руб)/$(КоличествоЧековПредГод2),'# ##0,00')
label: Средний чек пред. (2) Год, руб
comment: Средний чек за предпредыдущий год, руб
---
set: ПроцентСреднийЧекПредГод2
definition: Money($(СреднийЧек)/$(СреднийЧекПредГод2),'# ##0,00')
label: % среднего чека к пред. (2) Год
comment: Процент роста среднего чеков к предпредыдущему году
---
set: СуммаРостаСреднийЧекПредГод2
definition: Money($(СреднийЧек)-$(СреднийЧекПредГод2),'# ##0,00')
label: Рост среднего чека к пред. (2) Год, руб
comment: Рост среднего чека к предпредыдущему году, руб
---
set: СреднийЧекПредГодДеньНедели
definition: Money($(ПродажиПредГодДеньНеделиРуб)/$(КоличествоЧековПредГодДеньНедели),'# ##0,00')
label: Средний чек пред. (1) Год тот же день недели, руб
comment: Средний чек за предыдущий год тот же день недели, руб
---
set: ПроцентСреднийЧекПредГодДеньНедели
definition: Money($(СреднийЧек)/$(СреднийЧекПредГодДеньНедели),'# ##0,00')
label: % среднего чека к пред. (1) Год тот же день недели
comment: Процент роста среднего чеков к предыдущему году тот же день недели
---
set: СуммаРостаСреднийЧекПредГодДеньНедели
definition: Money($(СреднийЧек)-$(СреднийЧекПредГодДеньНедели),'# ##0,00')
label: Рост среднего чека к пред. (1) Год тот же день недели, руб
comment: Рост среднего чека к предыдущему году тот же день недели, руб
---
set: СреднийЧекПредГод2ДеньНедели
definition: Money($(ПродажиПредГод2ДеньНеделиРуб)/$(КоличествоЧековПредГод2ДеньНедели),'# ##0,00')
label: Средний чек пред. (2) Год тот же день недели, руб
comment: Средний чек за предпредыдущий год тот же день недели, руб
---
set: ПроцентСреднийЧекПредГод2ДеньНедели
definition: Money($(СреднийЧек)/$(СреднийЧекПредГод2ДеньНедели),'# ##0,00')
label: % среднего чека к пред. (2) Год тот же день недели
comment: Процент роста среднего чеков к предпредыдущему году тот же день недели
---
set: СуммаРостаСреднийЧекПредГод2ДеньНедели
definition: Money($(СреднийЧек)-$(СреднийЧекПредГод2ДеньНедели),'# ##0,00')
label: Рост среднего чека к пред. (2) Год тот же день недели, руб
comment: Рост среднего чека к предпредыдущему году тот же день недели, руб
---
set: ДлинаЧека
definition: Money(Sum({<ТипПериода={'Current'}>} ДлинаЧека)/$(КоличествоЧеков),'# ##0,0')
label: Длина чека
comment: Средняя длина чека (среднее количество строк в чеке)
---
set: ДлинаЧекаПредГод
definition: Money(Sum({<ТипПериода={'Год'}>} ДлинаЧека)/$(КоличествоЧековПредГод),'# ##0,00')
label: Длина чека пред. (1) Год
comment: Средняя длина чека за предыдущий год (среднее количество строк в чеке)
---
set: СбросФильтраПоТрафику
definition: Категория, Подкатегория, Группа, Подгруппа, Производитель, ТорговаяМарка, Коллекция, КатегорийныйМенеджер, Канал
---
set: Трафик
definition: Money(Sum({<ТипДокумента = {'Traffic'},ТипПериода={'Current'},$(СбросФильтраПоТрафику)>} Количество)/1000,'# ##0,0')
label: Трафик, тыс. человек
comment: Трафик, тыс. человек
---
set: Конверсия
definition: Money(($(КоличествоЧеков))/($(Трафик)*1000),'# ##0,0%')
label: Конверсия %
comment: Конверсия % посетителей в покупателей
---
set: Пенетрация
definition: Money(Sum({<ТипПериода={'Current'}>} _СчетчикЧеков)/
		Sum({<ТипПериода={'Current'}, 
			Категория, Группа,НоменклатураКод,НоменклатураНаименование,Подкатегория,Производитель,
			КатегорийныйМенеджер>} Total <Склад> _СчетчикЧеков),'# ##0,00%')
label: % Пенетрации
comment: % Пенетрации
---
set: %СвязанныхОтПродажОсновногоТовараПоПодразд
definition: 
	$(СвязанныеПродажиКолВоSecond)/Sum({$} Total <Склад> _СчетчикЧеков)
label: %Сопутствующих продаж от продаж основного товара
comment: Процент сопутствующих продаж к продажам по основному товару по городу
---
set: СвязанныеПродажиКолВоSecond
definition: Money(sum( {Second<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка),
	 ТипПериода={'Current'},Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека>} _СчетчикЧеков ),'# ##0')
label: Количество чеков по сопутствующим продажам, шт
comment: Количество чеков по сопутствующим продажам, штук
---
set: СвязанныеПродажиSecond
definition: Money(sum( {Second<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>}
	   _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка),ТипДокумента={'Sales'},ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Сумма )/1000,'# ##0,00')
label: Сумма продаж по сопутствующим продажам, тыс. руб.
comment: Сумма продаж по сопутствующим продажам, тыс. руб.
---
set: СвязанныеПродажиSecondПредМес
definition: Money(sum( {Second<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>}
	   _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка),ТипДокумента={'Sales'},ТипПериода={'ГодМесяц'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Сумма )/1000,'# ##0,00')
label: Сумма продаж по сопутствующим продажам пред мес, тыс. руб.
comment: Сумма продаж по сопутствующим продажам за предыдущий месяц, тыс. руб.
---
set: ПроцентСвязанныеПродажиПредМес
definition: Money($(СвязанныеПродажиSecond)/$(СвязанныеПродажиSecondПредМес),'# ##0,00%')
label:% изм.Продаж к пред. месяцу
comment: Процент Продажи к предыдущему месяцу
---
set: СвязаннаяМаржаSecond
definition: Money(sum( {Second<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>}
	   _КлючЗаголовкаЧека),
	 	 [НоменклатураСсылка]=e($::НоменклатураСсылка),ТипДокумента={'Sales'},ТипПериода={'Current'},
	 	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} ВП )/1000,'# ##0,00')
label: ВП по сопутствующим продажам, тыс. руб.
comment: ВП по сопутствующим продажам, тыс. руб.	
---
set: СвязанныйПроцентНаценкиSecond
definition: Money($(СвязаннаяМаржаSecond)/(sum( {Second<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>}
	   _КлючЗаголовкаЧека),
	 	 [НоменклатураСсылка]=e($::НоменклатураСсылка),ТипДокумента={'Sales'},ТипПериода={'Current'},
	 	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Себестоимость )/1000),'# ##0%')
label: % Наценки по сопутствующим продажам
comment: % Наценки по сопутствующим продажам
---
set: СвязанныеПродажиКоличествоSecond
definition: Money(sum( {Second<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>}
	   _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка),ТипДокумента={'Sales'},ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Количество ),'# ##0')
label: Количество товара по сопутствующим продажам, шт
comment: Количество товара по сопутствующим продажам, штук
---
set: СвязанныеПродажиСкидкаSecond
definition: Money(sum( {Second<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>}
	   _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка),ТипДокумента={'Sales'},ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Скидка )/1000,'# ##0,00')
label: Сумма скидки по сопутствующим продажам, тыс. руб.
comment: Сумма скидки по сопутствующим продажам, тыс. руб.
---
set: СвязанныеСуммаПоЧекамТысSecond
definition: Money(sum( {Second<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>}
	   _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка),ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} _СуммаПоЧеку )/1000,'# ##0')
label: Сопутствующая сумма по чекам, тыс. руб.
comment: Сопутствующая сумма по чекам, тыс. руб.
---
set: СвязанныеНаценкаПоЧекамТысSecond
definition: Money(sum( {Second<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>}
	   _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка),ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} _НаценкаПоЧеку )/1000,'# ##0')
label: Сопутствующая наценка по чекам, тыс. руб.
comment: Сопутствующая наценка по чекам, тыс. руб.
---
set: СвязанныеПроцентНаценкиПоЧекамSecond
definition: Money(sum( {Second<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>}
	   _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка),ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} _НаценкаПоЧеку )/sum( {Second<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>}
	   _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка),ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} _СебестоимостьПоЧеку ),'# ##0%')
label: Сопутствующий % наценки по чекам
comment: Сопутствующий % наценки по чекам
---
set: СвязанныеПродажиSecondСУчетомОсновного
definition: Money(sum( {Second<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) *
 P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=$::НоменклатураСсылка+Second::НоменклатураСсылка,ТипДокумента={'Sales'},ТипПериода={'Current'},
	 НоменклатураНаименование,Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Сумма )/1000,'# ##0,00')
label: Сумма продаж с учетом корзины по сопутствующим продажам, тыс. руб.
comment: Сумма продаж с учетом корзины по сопутствующим продажам, тыс. руб.
---		
set: СвязанныеРозничнаяЦенаSecond
definition: Money(Max( {Second<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>}
	   _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка),ТипДокумента={'Sales'},ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Сумма/Количество ),'# ##0,00')
label: Розничная цена по сопутствующим продажам, руб.
comment: Розничная цена по сопутствующим продажам, руб.
---
set: ПроцентСкидкиSecond
definition: Num(alt($(СвязанныеПродажиСкидкаSecond)/($(СвязанныеПродажиSecond)+$(СвязанныеПродажиСкидкаSecond)),0),'# ##0,00%')
label: Процент скидки по сопутствующим продажам
comment: Процент предоставленной скидки по сопутствующим продажам
---
set: %ВПСвязанныхОтПродажОсновногоТовараПоПодразд
definition: 
	Money($(СвязаннаяМаржаSecond)/Sum({$<ТипДокумента={'Sales'},ТипПериода={'Current'}>} Total <Склад> ВП),'# ##0,00%')
label: %Сопутствующих продаж от продаж основного товара
comment: Процент Сопутствующих продаж к продажам по основному товару по городу
---
set: %ПродажСвязанныхОтПродажОсновногоТовараПоПодразд
definition: 
	Money($(СвязанныеПродажиSecond)/(Sum({$<ТипДокумента={'Sales'},ТипПериода={'Current'}>} Total <Склад> Сумма)/1000),'# ##0,00%')
label: %Сопутствующих продаж от продаж основного товара
comment: Процент Сопутствующих продаж к продажам по основному товару по городу
---
set: ДлинаЧекаSecond
definition: Money(sum( {Second<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка),ТипПериода={'Current'},Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,
	 Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека>} ДлинаЧека)/$(СвязанныеПродажиКолВоSecond),'# ##0,0')
label: Длина чека
comment: Средняя длина чека (среднее количество строк в чеке)
---
set: СреднийЧекSecond
definition: Money(($(СвязанныеПродажиSecond)*1000)/$(СвязанныеПродажиКолВоSecond),'# ##0')	 
label: Средний чек
comment: Средний чек
---
set: %СвязанныхПродажSecond
definition: 
	Money($(СвязанныеПродажиSecond) / 
	Sum({Second<[НоменклатураСсылка]=,НоменклатураНаименованиеУровня2=,Номенклатура=,		
		НоменклатураСсылка=>} Сумма),'# ##0,00%')
label: %Продаж по номенклатуре в целом
comment: Процент сопутствующих продаж к продажам по данной номенклатуре в целом
---
set: ПроцентСопутствующейПенетрации
definition: Money($(СвязанныеПродажиКолВоSecond)/
		Sum({$<ТипПериода={'Current'}>} TOTAL _СчетчикЧеков),'# ##0,00%')
label: % Пенетрации по сопутствующим продажам
comment: % Пенетрации по сопутствующим продажам
---
set:ДоляСвязанныхПродажSecond
definition: 
	Money($(СвязанныеПродажиSecond) /
	(sum( {Second<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>}
	   _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка),ТипДокумента={'Sales'},ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Total Сумма )/1000),'# ##0,00%')
label: Доля в сопутствующих продаж, %
comment: Доля в сопутствующих продаж, %
---
set: СвязанныеПродажиThird
definition: Money(sum( {Third<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) *
 P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка),ТипДокумента={'Sales'},ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Сумма )/1000,'# ##0,00')
label: Сумма продаж по сопутствующим продажам, тыс. руб.
comment: Сумма продаж по сопутствующим продажам, тыс. руб.
---
set: СвязанныеПродажиКоличествоThird
definition: Money(sum( {Third<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) *
 P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка),ТипДокумента={'Sales'},ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Количество ),'# ##0,00')
label: Количество товара по сопутствующим продажам, шт
comment: Количество товара по сопутствующим продажам, шт
---
set: СвязаннаяМаржаThird
definition: Money(sum( {Third<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) *
 P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка),ТипДокумента={'Sales'},ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} ВП )/1000,'# ##0,00')
label: ВП по сопутствующим продажам, тыс. руб.
comment: ВП по сопутствующим продажам, тыс. руб.
---
set: СвязанныеПродажиСкидкаThird
definition: Money(sum( {Third<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) *
 P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка),ТипДокумента={'Sales'},ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Скидка )/1000,'# ##0,00')
label: Сумма скидки по сопутствующим продажам, тыс. руб.
comment: Сумма скидки по сопутствующим продажам, тыс. руб.
---
set: ПроцентСкидкиThird
definition: Num(alt($(СвязанныеПродажиСкидкаThird)/($(СвязанныеПродажиThird)+$(СвязанныеПродажиСкидкаThird)),0),'# ##0,00%')
label: Процент скидки по сопутствующим продажам
comment: Процент предоставленной скидки по сопутствующим продажам
---
set: СвязанныеПродажиКолВоThird
definition: Money(sum( {Third<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) *
 P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка),
	 ТипПериода={'Current'},Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека>} _СчетчикЧеков ),'# ##0')
label: Количество чеков по сопутствующим продажам, шт
comment: Количество чеков по сопутствующим продажам, штук
---
set: ПроцентСопутствующейПенетрацииThird
definition: Money($(СвязанныеПродажиКолВоThird)/
		Sum({$<ТипПериода={'Current'}>} TOTAL _СчетчикЧеков),'# ##0,00%')
label: % Пенетрации по сопутствующим продажам
comment: % Пенетрации по сопутствующим продажам
---
set: ДлинаЧекаThird
definition: Money(sum( {Third<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) *
 P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка),
	 ТипПериода={'Current'},Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека>} ДлинаЧека)/$(СвязанныеПродажиКолВоThird),'# ##0,0')
label: Длина чека
comment: Средняя длина чека (среднее количество строк в чеке)
---
set: СреднийЧекThird
definition: Money(($(СвязанныеПродажиThird)*1000)/$(СвязанныеПродажиКолВоThird),'# ##0')	 
label: Средний чек
comment: Средний чек
---
set: СвязанныйПроцентНаценкиThird
definition: Money($(СвязаннаяМаржаThird)/(sum( {Third<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) *
 P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка),ТипДокумента={'Sales'},ТипПериода={'Current'},
	 	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Себестоимость )/1000),'# ##0%')
label: % Наценки по сопутствующим продажам
comment: % Наценки по сопутствующим продажам
---
set: СвязанныеСуммаПоЧекамТысThird
definition: Money(sum( {Third<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека) *
	P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка),ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} _СуммаПоЧеку )/1000,'# ##0')
label: Сопутствующая сумма по чекам, тыс. руб.
comment: Сопутствующая сумма по чекам, тыс. руб.
---
set: СвязанныеНаценкаПоЧекамТысThird
definition: Money(sum( {Third<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека) *
	P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка),ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} _НаценкаПоЧеку )/1000,'# ##0')
label: Сопутствующая наценка по чекам, тыс. руб.
comment: Сопутствующая наценка по чекам, тыс. руб.
---
set: СвязанныеПроцентНаценкиПоЧекамThird
definition: Money(sum( {Third<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека) *
	P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка),ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} _НаценкаПоЧеку )/sum( {Third<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>}) *
	P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка),ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} _СебестоимостьПоЧеку ),'# ##0%')
label: Сопутствующий % наценки по чекам
comment: Сопутствующий % наценки по чекам
---
set: СвязанныеПродажиThirdСУчетомОсновного
definition: Money(sum( {Third<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) *
 P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека)*
P({Third<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека) ,
	 [НоменклатураСсылка]=($::НоменклатураСсылка)+(Second::НоменклатураСсылка)+(Third::НоменклатураСсылка),ТипДокумента={'Sales'},ТипПериода={'Current'},НоменклатураНаименование,
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Сумма )/1000,'# ##0,00')
label: Сумма продаж с учетом корзины по сопутствующим продажам, тыс. руб.
comment: Сумма продаж с учетом корзины по сопутствующим продажам, тыс. руб.
---		
set: СвязанныеПродажиFourth
definition: Money(sum( {Fourth<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
 *P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
 *P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка),ТипДокумента={'Sales'},ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Сумма )/1000,'# ##0,00')
label: Сумма продаж по сопутствующим продажам, тыс. руб.
comment: Сумма продаж по сопутствующим продажам, тыс. руб.
---
set: СвязанныеПродажиКоличествоFourth
definition: Money(sum( {Fourth<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
 *P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
 *P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка),ТипДокумента={'Sales'},ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Количество ),'# ##0,00')
label: Количество товара по сопутствующим продажам, шт
comment: Количество товара по сопутствующим продажам, шт
---
set: СвязаннаяМаржаFourth
definition: Money(sum( {Fourth<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
 *P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка),ТипДокумента={'Sales'},ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} ВП )/1000,'# ##0,00')
label: ВП по сопутствующим продажам, тыс. руб.
comment: ВП по сопутствующим продажам, тыс. руб.
---
set: СвязанныеПродажиСкидкаFourth
definition: Money(sum( {Fourth<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
 *P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка),ТипДокумента={'Sales'},ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Скидка )/1000,'# ##0,00')
label: Сумма скидки по сопутствующим продажам, тыс. руб.
comment: Сумма скидки по сопутствующим продажам, тыс. руб.
---
set: ПроцентСкидкиFourth
definition: Num(alt($(СвязанныеПродажиСкидкаFourth)/($(СвязанныеПродажиFourth)+$(СвязанныеПродажиСкидкаFourth)),0),'# ##0,00%')
label: Процент скидки по сопутствующим продажам
comment: Процент предоставленной скидки по сопутствующим продажам
---
set: СвязанныеПродажиКолВоFourth
definition: Money(sum( {Fourth<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
	*P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка),
	 ТипПериода={'Current'},Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека>} _СчетчикЧеков ),'# ##0')
label: Количество чеков по сопутствующим продажам, шт
comment: Количество чеков по сопутствующим продажам, штук
---
set: ПроцентСопутствующейПенетрацииFourth
definition: Money($(СвязанныеПродажиКолВоFourth)/
		Sum({$<ТипПериода={'Current'}>} TOTAL _СчетчикЧеков),'# ##0,00%')
label: % Пенетрации по сопутствующим продажам
comment: % Пенетрации по сопутствующим продажам
---
set: ДлинаЧекаFourth
definition: Money(sum( {Fourth<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
 *P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка),
	 ТипПериода={'Current'},Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека>} ДлинаЧека)/$(СвязанныеПродажиКолВоFourth),'# ##0,0')
label: Длина чека
comment: Средняя длина чека (среднее количество строк в чеке)
---
set: СреднийЧекFourth
definition: Money(($(СвязанныеПродажиFourth)*1000)/$(СвязанныеПродажиКолВоFourth),'# ##0')	 
label: Средний чек
comment: Средний чек
---
set: СвязанныйПроцентНаценкиFourth
definition: Money($(СвязаннаяМаржаFourth)/(sum( {Fourth<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
 *P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка),ТипДокумента={'Sales'},ТипПериода={'Current'},
	 	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Себестоимость )/1000),'# ##0%')
label: % Наценки по сопутствующим продажам
comment: % Наценки по сопутствующим продажам
---
set: СвязанныеСуммаПоЧекамТысFourth
definition: Money(sum( {Fourth<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
	*P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка),ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} _СуммаПоЧеку )/1000,'# ##0')
label: Сопутствующая сумма по чекам, тыс. руб.
comment: Сопутствующая сумма по чекам, тыс. руб.
---
set: СвязанныеНаценкаПоЧекамТысFourth
definition: Money(sum( {Fourth<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
	*P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка),ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} _НаценкаПоЧеку )/1000,'# ##0')
label: Сопутствующая наценка по чекам, тыс. руб.
comment: Сопутствующая наценка по чекам, тыс. руб.
---
set: СвязанныеПроцентНаценкиПоЧекамFourth
definition: Money(sum( {Fourth<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
	*P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка),ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} _НаценкаПоЧеку )/sum( {Fourth<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>}) 
	*P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка),ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} _СебестоимостьПоЧеку ),'# ##0%')
label: Сопутствующий % наценки по чекам
comment: Сопутствующий % наценки по чекам
---
set: СвязанныеПродажиFourthСУчетомОсновного
definition: Money(sum( {Fourth<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) *
 P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека)*
P({Third<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека)*
P({Fourth<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека) ,
	 [НоменклатураСсылка]=($::НоменклатураСсылка)+(Second::НоменклатураСсылка)+(Third::НоменклатураСсылка)+(Fourth::НоменклатураСсылка),
	 ТипДокумента={'Sales'},ТипПериода={'Current'},НоменклатураНаименование,
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Сумма )/1000,'# ##0,00')
label: Сумма продаж с учетом корзины по сопутствующим продажам, тыс. руб.
comment: Сумма продаж с учетом корзины по сопутствующим продажам, тыс. руб.
---		
set: СвязанныеПродажиFifth
definition: Money(sum( {Fifth<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
 *P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
 *P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Fourth<НоменклатураСсылка =Fourth::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка)*e(Fourth::НоменклатураСсылка),
	 ТипДокумента={'Sales'},ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Сумма )/1000,'# ##0,00')
label: Сумма продаж по сопутствующим продажам, тыс. руб.
comment: Сумма продаж по сопутствующим продажам, тыс. руб.
---
set: СвязанныеПродажиКоличествоFifth
definition: Money(sum( {Fifth<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
 *P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
 *P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Fourth<НоменклатураСсылка =Fourth::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка)*e(Fourth::НоменклатураСсылка)
	 ,ТипДокумента={'Sales'},ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Количество ),'# ##0,00')
label: Количество товара по сопутствующим продажам, шт
comment: Количество товара по сопутствующим продажам, шт
---
set: СвязаннаяМаржаFifth
definition: Money(sum( {Fifth<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
 *P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Fourth<НоменклатураСсылка =Fourth::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка)*e(Fourth::НоменклатураСсылка)
	 ,ТипДокумента={'Sales'},ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} ВП )/1000,'# ##0,00')
label: ВП по сопутствующим продажам, тыс. руб.
comment: ВП по сопутствующим продажам, тыс. руб.
---
set: СвязанныеПродажиСкидкаFifth
definition: Money(sum( {Fifth<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
 *P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Fourth<НоменклатураСсылка =Fourth::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка)*e(Fourth::НоменклатураСсылка)
	 ,ТипДокумента={'Sales'},ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Скидка )/1000,'# ##0,00')
label: Сумма скидки по сопутствующим продажам, тыс. руб.
comment: Сумма скидки по сопутствующим продажам, тыс. руб.
---
set: ПроцентСкидкиFifth
definition: Num(alt($(СвязанныеПродажиСкидкаFifth)/($(СвязанныеПродажиFifth)+$(СвязанныеПродажиСкидкаFifth)),0),'# ##0,00%')
label: Процент скидки по сопутствующим продажам
comment: Процент предоставленной скидки по сопутствующим продажам
---
set: СвязанныеПродажиКолВоFifth
definition: Money(sum( {Fifth<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
	*P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Fourth<НоменклатураСсылка =Fourth::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка)*e(Fourth::НоменклатураСсылка)
	 ,ТипПериода={'Current'},Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
	 >} _СчетчикЧеков ),'# ##0')
label: Количество чеков по сопутствующим продажам, шт
comment: Количество чеков по сопутствующим продажам, штук
---
set: ПроцентСопутствующейПенетрацииFifth
definition: Money($(СвязанныеПродажиКолВоFifth)/
		Sum({$<ТипПериода={'Current'}>} TOTAL _СчетчикЧеков),'# ##0,00%')
label: % Пенетрации по сопутствующим продажам
comment: % Пенетрации по сопутствующим продажам
---
set: ДлинаЧекаFifth
definition: Money(sum( {Fifth<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
 *P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Fourth<НоменклатураСсылка =Fourth::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка)*e(Fourth::НоменклатураСсылка)
	 ,ТипПериода={'Current'},Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
	 >} ДлинаЧека)/$(СвязанныеПродажиКолВоFifth),'# ##0,0')
label: Длина чека
comment: Средняя длина чека (среднее количество строк в чеке)
---
set: СреднийЧекFifth
definition: Money(($(СвязанныеПродажиFifth)*1000)/$(СвязанныеПродажиКолВоFifth),'# ##0')	 
label: Средний чек
comment: Средний чек
---
set: СвязанныйПроцентНаценкиFifth
definition: Money($(СвязаннаяМаржаFifth)/(sum( {Fifth<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
 *P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Fourth<НоменклатураСсылка =Fourth::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка)*e(Fourth::НоменклатураСсылка)
	 	 ,ТипДокумента={'Sales'},ТипПериода={'Current'},
	 	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Себестоимость )/1000),'# ##0%')
label: % Наценки по сопутствующим продажам
comment: % Наценки по сопутствующим продажам
---
set: СвязанныеСуммаПоЧекамТысFifth
definition: Money(sum( {Fifth<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
	*P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Fourth<НоменклатураСсылка =Fourth::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка)*e(Fourth::НоменклатураСсылка)
	 ,ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} _СуммаПоЧеку )/1000,'# ##0')
label: Сопутствующая сумма по чекам, тыс. руб.
comment: Сопутствующая сумма по чекам, тыс. руб.
---
set: СвязанныеНаценкаПоЧекамТысFifth
definition: Money(sum( {Fifth<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
	*P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Fourth<НоменклатураСсылка =Fourth::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка)*e(Fourth::НоменклатураСсылка)
	 ,ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} _НаценкаПоЧеку )/1000,'# ##0')
label: Сопутствующая наценка по чекам, тыс. руб.
comment: Сопутствующая наценка по чекам, тыс. руб.
---
set: СвязанныеПроцентНаценкиПоЧекамFifth
definition: Money(sum( {Fifth<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
	*P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Fourth<НоменклатураСсылка =Fourth::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка)*e(Fourth::НоменклатураСсылка)
	 ,ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} _НаценкаПоЧеку )/sum( {Fifth<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>}) 
	*P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Fourth<НоменклатураСсылка =Fourth::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка)*e(Fourth::НоменклатураСсылка)
	 ,ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} _СебестоимостьПоЧеку ),'# ##0%')
label: Сопутствующий % наценки по чекам
comment: Сопутствующий % наценки по чекам
---
set: СвязанныеПродажиFifthСУчетомОсновного
definition: Money(sum( {Fifth<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) *
 P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека)*
P({Third<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека)*
P({Fourth<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека)*
P({Fifth<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека) ,
	 [НоменклатураСсылка]=($::НоменклатураСсылка)+(Second::НоменклатураСсылка)+(Third::НоменклатураСсылка)+(Fourth::НоменклатураСсылка)+(Fifth::НоменклатураСсылка)
	 ,ТипДокумента={'Sales'},ТипПериода={'Current'},НоменклатураНаименование,
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Сумма )/1000,'# ##0,00')
label: Сумма продаж с учетом корзины по сопутствующим продажам, тыс. руб.
comment: Сумма продаж с учетом корзины по сопутствующим продажам, тыс. руб.
---		
set: СвязанныеПродажиSixth
definition: Money(sum( {Sixth<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
 *P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
 *P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Fourth<НоменклатураСсылка =Fourth::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Fifth<НоменклатураСсылка =Fifth::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка)*e(Fourth::НоменклатураСсылка)*e(Fifth::НоменклатураСсылка),
	 ТипДокумента={'Sales'},ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Сумма )/1000,'# ##0,00')
label: Сумма продаж по сопутствующим продажам, тыс. руб.
comment: Сумма продаж по сопутствующим продажам, тыс. руб.
---
set: СвязанныеПродажиКоличествоSixth
definition: Money(sum( {Sixth<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
 *P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
 *P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Fourth<НоменклатураСсылка =Fourth::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Fifth<НоменклатураСсылка =Fifth::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка)*e(Fourth::НоменклатураСсылка)*e(Fifth::НоменклатураСсылка)
	 ,ТипДокумента={'Sales'},ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Количество ),'# ##0,00')
label: Количество товара по сопутствующим продажам, шт
comment: Количество товара по сопутствующим продажам, шт
---
set: СвязаннаяМаржаSixth
definition: Money(sum( {Sixth<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
 *P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Fourth<НоменклатураСсылка =Fourth::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Fifth<НоменклатураСсылка =Fifth::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка)*e(Fourth::НоменклатураСсылка)*e(Fifth::НоменклатураСсылка)
	 ,ТипДокумента={'Sales'},ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} ВП )/1000,'# ##0,00')
label: ВП по сопутствующим продажам, тыс. руб.
comment: ВП по сопутствующим продажам, тыс. руб.
---
set: СвязанныеПродажиСкидкаSixth
definition: Money(sum( {Sixth<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
 *P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Fourth<НоменклатураСсылка =Fourth::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Fifth<НоменклатураСсылка =Fifth::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка)*e(Fourth::НоменклатураСсылка)*e(Fifth::НоменклатураСсылка)
	 ,ТипДокумента={'Sales'},ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Скидка )/1000,'# ##0,00')
label: Сумма скидки по сопутствующим продажам, тыс. руб.
comment: Сумма скидки по сопутствующим продажам, тыс. руб.
---
set: ПроцентСкидкиSixth
definition: Num(alt($(СвязанныеПродажиСкидкаSixth)/($(СвязанныеПродажиSixth)+$(СвязанныеПродажиСкидкаSixth)),0),'# ##0,00%')
label: Процент скидки по сопутствующим продажам
comment: Процент предоставленной скидки по сопутствующим продажам
---
set: СвязанныеПродажиКолВоSixth
definition: Money(sum( {Sixth<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
	*P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Fourth<НоменклатураСсылка =Fourth::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Fifth<НоменклатураСсылка =Fifth::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка)*e(Fourth::НоменклатураСсылка)*e(Fifth::НоменклатураСсылка)
	 ,ТипПериода={'Current'},Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека>} _СчетчикЧеков ),'# ##0')
label: Количество чеков по сопутствующим продажам, шт
comment: Количество чеков по сопутствующим продажам, штук
---
set: ПроцентСопутствующейПенетрацииSixth
definition: Money($(СвязанныеПродажиКолВоSixth)/
		Sum({$<ТипПериода={'Current'}>} TOTAL _СчетчикЧеков),'# ##0,00%')
label: % Пенетрации по сопутствующим продажам
comment: % Пенетрации по сопутствующим продажам
---
set: ДлинаЧекаSixth
definition: Money(sum( {Sixth<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
 *P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Fourth<НоменклатураСсылка =Fourth::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Fifth<НоменклатураСсылка =Fifth::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка)*e(Fourth::НоменклатураСсылка)*e(Fifth::НоменклатураСсылка)
	 ,ТипПериода={'Current'},Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека>} ДлинаЧека)/$(СвязанныеПродажиКолВоSixth),'# ##0,0')
label: Длина чека
comment: Средняя длина чека (среднее количество строк в чеке)
---
set: СреднийЧекSixth
definition: Money(($(СвязанныеПродажиSixth)*1000)/$(СвязанныеПродажиКолВоSixth),'# ##0')	 
label: Средний чек
comment: Средний чек
---
set: СвязанныйПроцентНаценкиSixth
definition: Money($(СвязаннаяМаржаSixth)/(sum( {Sixth<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
 *P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Fourth<НоменклатураСсылка =Fourth::НоменклатураСсылка>} _КлючЗаголовкаЧека)
 *P({Fifth<НоменклатураСсылка =Fifth::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка)*e(Fourth::НоменклатураСсылка)*e(Fifth::НоменклатураСсылка)
	 	 ,ТипДокумента={'Sales'},ТипПериода={'Current'},
	 	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Себестоимость )/1000),'# ##0%')
label: % Наценки по сопутствующим продажам
comment: % Наценки по сопутствующим продажам
---
set: СвязанныеСуммаПоЧекамТысSixth
definition: Money(sum( {Sixth<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
	*P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Fourth<НоменклатураСсылка =Fourth::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Fifth<НоменклатураСсылка =Fifth::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка)*e(Fourth::НоменклатураСсылка)*e(Fifth::НоменклатураСсылка)
	 ,ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} _СуммаПоЧеку )/1000,'# ##0')
label: Сопутствующая сумма по чекам, тыс. руб.
comment: Сопутствующая сумма по чекам, тыс. руб.
---
set: СвязанныеНаценкаПоЧекамТысSixth
definition: Money(sum( {Sixth<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
	*P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Fourth<НоменклатураСсылка =Fourth::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Fifth<НоменклатураСсылка =Fifth::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка)*e(Fourth::НоменклатураСсылка)*e(Fifth::НоменклатураСсылка)
	 ,ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} _НаценкаПоЧеку )/1000,'# ##0')
label: Сопутствующая наценка по чекам, тыс. руб.
comment: Сопутствующая наценка по чекам, тыс. руб.
---
set: СвязанныеПроцентНаценкиПоЧекамSixth
definition: Money(sum( {Sixth<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека) 
	*P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Fourth<НоменклатураСсылка =Fourth::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Fifth<НоменклатураСсылка =Fifth::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка)*e(Fourth::НоменклатураСсылка)*e(Fifth::НоменклатураСсылка)
	 ,ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} _НаценкаПоЧеку )/sum( {Sixth<_КлючЗаголовкаЧека = P({$<НоменклатураСсылка =$::НоменклатураСсылка>}) 
	*P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Third<НоменклатураСсылка =Third::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Fourth<НоменклатураСсылка =Fourth::НоменклатураСсылка>} _КлючЗаголовкаЧека)
	*P({Fifth<НоменклатураСсылка =Fifth::НоменклатураСсылка>} _КлючЗаголовкаЧека),
	 [НоменклатураСсылка]=e($::НоменклатураСсылка)*e(Second::НоменклатураСсылка)*e(Third::НоменклатураСсылка)*e(Fourth::НоменклатураСсылка)*e(Fifth::НоменклатураСсылка)
	 ,ТипПериода={'Current'},
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,Дата=$::Дата,Кассир=$::Кассир,ДлинаЧека=$::ДлинаЧека,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} _СебестоимостьПоЧеку ),'# ##0%')
label: Сопутствующий % наценки по чекам
comment: Сопутствующий % наценки по чекам
#SECTION :СегментацияПоЧекам 
---
set: СвязанныеПродажиSixthСУчетомОсновного
definition: Money(sum( {Sixth<_КлючЗаголовкаЧека = P({Second<НоменклатураСсылка =Second::НоменклатураСсылка>} _КлючЗаголовкаЧека) *
 P({$<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека)*
P({Third<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека)*
P({Fourth<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека)*
P({Fifth<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека)*
P({Sixth<НоменклатураСсылка =$::НоменклатураСсылка>} _КлючЗаголовкаЧека) ,
	 [НоменклатураСсылка]=($::НоменклатураСсылка)+(Second::НоменклатураСсылка)+(Third::НоменклатураСсылка)+(Fourth::НоменклатураСсылка)+(Fifth::НоменклатураСсылка)+(Sixth::НоменклатураСсылка)
	 ,ТипДокумента={'Sales'},ТипПериода={'Current'},НоменклатураНаименование,
	 Год = $::Год,Месяц=$::Месяц,Склад=$::Склад,ДлинаЧека=$::ДлинаЧека,Кассир=$::Кассир,ШкалаСуммаЧека=$::ШкалаСуммаЧека
		>} Сумма )/1000,'# ##0,00')
label: Сумма продаж с учетом корзины по сопутствующим продажам, тыс. руб.
comment: Сумма продаж с учетом корзины по сопутствующим продажам, тыс. руб.
---		
set: ГруппировкаБезДиапазона
definition: 
	if(round(aggr($2,$1),$3)>0,
		if(round(aggr($2,$1),$3)>$5,Dual('>' & $5/$6, $5),
			if(round(aggr($2,$1),$3,$3/2)>=$4,Dual($4/$6 & ' - ' & $5/$6, $4),
				Dual(Money(Floor(round(aggr({<_ТипДокумента = {'Чек'}>}$2,$1),$3,$3/2),$3)/$6,'#0'),round(aggr({<_ТипДокумента = {'Чек'}>}$2,$1),$3)/$6))),
		if (round(aggr($2,$1),$3)<0,'Возвр.',null()))
label: ГруппировкаШагГраницыТолькоПоложительные
description: Параметры - Измерение для группировки, Выражение, Шаг сегментации, Первая верхняя граница, Вторая верхняя граница,Масштаб
---
set: ГруппировкаШагГраницыТолькоПоложительные
definition:  
	if(round(aggr($2,$1),$3,$3/2)>0,
		if(round(aggr($2,$1),$3,$3/2)>$5,Dual('>' & $5/$6, $5),
			if(round(aggr($2,$1),$3,$3/2)>=$4,Dual($4/$6 & ' - ' & $5/$6, $4),
				Dual(Money(Floor(round(aggr($2,$1),$3,$3/2),$3)/$6,'#0') & '-' & Money(Floor(round(aggr($2,$1),$3,$3/2),$3)/$6+$3/$6,'#0'),
				round(aggr($2,$1),$3,$3/2)/$6))),
		if (round(aggr($2,$1),$3,$3/2)<0,'Возвр.',null()))
label: ГруппировкаШагГраницыТолькоПоложительные
comment: Параметры - Измерение для группировки, Выражение, Шаг сегментации, Первая верхняя граница, Вторая верхняя граница,Масштаб
---
set: РазбивкаПоСуммеЧека
macro: ГруппировкаШагГраницыТолькоПоложительные
- _КлючЗаголовкаЧека
- $(СуммаЧеков)
- $(ШагСегментаЧек)
- $(ШагСегментаЧекВерхГраница1)
- $(ШагСегментаЧекВерхГраница2)
- 1000
label: РазбивкаПоСуммеЧека
description: РазбивкаПоСуммеЧека
---
set: ШагДлинаЧекВерхГраница1
definition: 3
---
set: ШагДлинаЧекВерхГраница2
definition: 6
---
set: РазбивкаПоДлинеЧека
macro: ГруппировкаБезДиапазона
- _КлючЗаголовкаЧека
- $(ДлинаЧека)
- 1
- $(ШагДлинаЧекВерхГраница1)
- $(ШагДлинаЧекВерхГраница2)
- 1
label: РазбивкаПоДлинеЧека
comment: Разбивка по длине чека
---
set: РазбивкаПоРазмеруСкидки
definition: $(ГруппировкаШагГраницыТолькоПоложительные%(_КлючЗаголовкаЧека, 
	(Sum({<_ТипДокумента = {'Чек'},ТипПериода={'Current'}>}ПродажиСкидка)/(Sum({<_ТипДокумента = {'Чек'},ТипПериода={'Current'}>}ПродажиСкидка)+Sum({<_ТипДокумента = {'Чек'},ТипПериода={'Current'}>}Сумма))), 0.05, 0.3, 0.6,1))
label: РазбивкаПоРазмеруСкидки
description: Разбивка по размеру скидки
---
set: ШагСегментаЧек
definition: 2000
label: ШагСегментаЧек
description: Шаг Сегмента для среднего Чека
---
set: РазбивкаПоЧасам
definition: $(ГруппировкаШагГраницыТолькоПоложительные(_КлючЗаголовкаЧека, Час, 1, 30, 31,1))
label: РазбивкаПоЧасам
comment: Разбивка по времени покупки (часы)

#SECTION :Списания
---
set: СуммаСписаний
definition: Money(Sum({$<ТипДокумента={'Spis'},
	ТипПериода={'Current'}>}Себестоимость)/1000,'# ##0,00')
label:Списания тыс. руб.
comment: Сумма списаний в тыс. руб.
---
set: СуммаСписанийПредГод
definition: Money(sum({$<ТипДокумента = {'Spis'},_ФлагДействующаяДата={1},
        ТипПериода={'Год'}>}Себестоимость)/1000,'# ##0,00')
label:Списания пред. (1) Год, тыс. руб.
comment: Cумма cписаний за предыдущий год тыс.руб.  
---
set: СуммаСписанийПредГод2
definition: Money((sum({<ТипДокумента = {'Spis'},_ФлагДействующаяДата={1},
    ТипПериода={'Год-2'}>}Себестоимость)/1000),'# ##0,00')
label:Списания пред. (2) Год, тыс. руб.
comment: Cумма списаний за предпредыдущий год тыс.руб.
---
set: ПроцентСуммыСписанийПредГод
definition: Money($(СуммаСписаний)/$(СуммаСписанийПредГод),'# ##0,00%')
label:% изм.Продаж к пред. (1) Год
comment: Процент списаний к предыдущему году
---
set: ПроцентСуммыСписанийПредГод2
definition: Money($(СуммаСписаний)/$(СуммаСписанийПредГод2),'# ##0,00%')
label:% изм.Продаж к пред. (2) Год
comment: Процент списаний к предпредыдущему году
---
set: СуммаРостаСуммыСписанийПредГод
definition: Money($(СуммаСписаний)-$(СуммаСписанийПредГод),'# ##0,00')
label:∆ изм. Продаж к пред. (1) Год
comment: Сумма роста cписаний к предыдущему году
---
set: СуммаРостаСуммыСписанийПредГод2
definition: Money($(СуммаСписаний)-$(СуммаСписанийПредГод2),'# ##0,00')
label:∆ изм. Продаж к пред. (2) Год
comment: Сумма роста cписаний к предпредыдущему году
---
set: СуммаСписанийПредМес
definition: Money(sum({<ТипДокумента = {'Spis'},_ФлагДействующаяДата={1},
        ТипПериода={'ГодМесяц'}>}Себестоимость)/1000,'# ##0,00')
label: Списания тыс.руб. пред мес
comment: Cумма списаний за предыдущий мес тыс.руб.  
---
set: ПроцентСуммыСписанийПредМес
definition: Money($(СуммаСписаний)/$(СуммаСписанийПредМес),'# ##0,00%')
label: % Списания к пред мес
comment: Процент списаний к предыдущему месяцу
---
set: СуммаРостаСуммыСписанийПредМес
definition: Money($(СуммаСписаний)-$(СуммаСписанийПредМес),'# ##0,00')
label: Сумма роста Продаж к пред мес
comment: Сумма роста cписаний к предыдущему месяцу
---
set: СписанияКоличество
definition: Money(Sum({$<ТипДокумента ={'Spis'},ТипПериода={'Current'}>}Количество),'# ##0,00')
label:Кол списанного товара, шт
comment: Количество списанного товара в штуках
---
set: СуммаСписанийПредГодДеньНедели
definition: Money(sum({<ТипДокумента = {'Spis'},_ФлагДействующаяДата={1},
        ТипПериода={'ГодДеньНедели'}>}Себестоимость)/1000,'# ##0,00')
label:Списания пред. (1) Год тот же день недели, тыс. руб.
comment: Cумма cписаний за предыдущий тот же день недели год тыс.руб.  
---
set: ПроцентСуммыСписанийПредГодДеньНедели
definition: Money($(СуммаСписаний)/$(СуммаСписанийПредГодДеньНедели),'# ##0,00%')
label:% изм.Продаж к пред. (1) Год тот же день недели
comment: Процент списаний к предыдущему году тот же день недели
---
set: СуммаРостаСуммыСписанийПредГодДеньНедели
definition: Money($(СуммаСписаний)-$(СуммаСписанийПредГодДеньНедели),'# ##0,00')
label:∆ изм. Продаж к пред. (1) Год тот же день недели
comment: Сумма роста cписаний к предыдущему году тот же день недели
---
set: СуммаСписанийПредГод2ДеньНедели
definition: Money(sum({<ТипДокумента = {'Spis'},_ФлагДействующаяДата={1},
        ТипПериода={'Год2ДеньНедели'}>}Себестоимость)/1000,'# ##0,00')
label:Списания пред. (2) Год тот же день недели, тыс. руб.
comment: Cумма cписаний за предпредыдущий тот же день недели год тыс.руб.  
---
set: ПроцентСуммыСписанийПредГод2ДеньНедели
definition: Money($(СуммаСписаний)/$(СуммаСписанийПредГод2ДеньНедели),'# ##0,00%')
label:% изм.Продаж к пред. (2) Год тот же день недели
comment: Процент списаний к предпредыдущему году тот же день недели
---
set: СуммаРостаСуммыСписанийПредГод2ДеньНедели
definition: Money($(СуммаСписаний)-$(СуммаСписанийПредГод2ДеньНедели),'# ##0,00')
label:∆ изм. Продаж к пред. (2) Год тот же день недели
comment: Сумма роста cписаний к предпредыдущему году тот же день недели
#SECTION :Дополнительные планы
---
set: КоэфОбслуживанияПлан
definition: Money(Max({<_ФлагДействующаяДата={1},ТипДокумента={'PlanKO'},ТипПериода={'Current'}>} Сумма),'# ##0,00%')
label: Коэф обсл план, %
comment: Коэффициент обслуживания план, %
---
set: КоэфОбслуживанияФакт
definition: Money(Max({<_ФлагДействующаяДата={1},ТипДокумента={'PlanKO'},ТипПериода={'Current'}>} Себестоимость),'# ##0,00%')
label: Коэф обсл факт, %
comment: Коэффициент обслуживания факт, %
---
set: КоэфОбслуживанияПФ
definition: Money($(КоэфОбслуживанияФакт)/$(КоэфОбслуживанияПлан),'# ##0,00%')
label: ПФ Коэф обсл, %
comment: Коэффициент обслуживания факт к плану, %
---
set: КоэфОбслуживания_П_Ф
definition: Money($(КоличествоСКУПродано) - $(КоличествоСКУПроданоПлан),'# ##0,00')
label: ∆ П-Ф Коэф обсл, %
comment: Коэффициент обслуживания факт минус план, %
---
set: КоэфОбслуживанияФактПредГод
definition: Money(Max({<ТипДокумента = {'PlanKO'},_ФлагДействующаяДата={1},ТипПериода={'Год'}>}Себестоимость),'# ##0,00%')
label: Коэф обсл факт, % пред год
comment: Коэффициент обслуживания факт, % за предыдущий год  
---
set: ПроцентКоэфОбслуживанияФактПредГод
definition: Money($(КоэфОбслуживанияФакт)/$(КоэфОбслуживанияФактПредГод),'# ##0,00%')
label: % Коэф обсл факт, % к пред год
comment: Процент коэффициента обслуживания факт, % к предыдущему году
---
set: СуммаРостаКоэфОбслуживанияФактПредГод
definition: Money($(КоэфОбслуживанияФакт)-$(КоэфОбслуживанияФактПредГод),'# ##0,00')
label: Сумма роста Коэф обсл факт, % к пред год
comment: Сумма роста коэффициента обслуживания факт, % к предыдущему году
---
set: КоэфОбслуживанияФактПредМес
definition: Money(Max({<ТипДокумента = {'PlanKO'},_ФлагДействующаяДата={1},ТипПериода={'ГодМесяц'}>}Себестоимость),'# ##0,00%')
label: Коэф обсл факт, % пред мес
comment: Коэффициент обслуживания факт, % за предыдущий мес 
---
set: ПроцентКоэфОбслуживанияФактПредМес
definition: Money($(КоэфОбслуживанияФакт)/$(КоэфОбслуживанияФактПредМес),'# ##0,00%')
label: % Коэф обсл факт, % к пред мес
comment: Процент коэффициента обслуживания факт, % к предыдущему месяцу
---
set: СуммаРостаКоэфОбслуживанияФактПредМес
definition: Money($(КоэфОбслуживанияФакт)-$(КоэфОбслуживанияФактПредМес),'# ##0,00%')
label: Сумма роста Коэф обсл факт, % к пред мес
comment: Сумма роста коэффициента обслуживания факт, % к предыдущему месяцу
---
set: КоэфОбслуживанияФактПредГодДеньНедели
definition: Money(Max({<ТипДокумента = {'PlanKO'},_ФлагДействующаяДата={1},ТипПериода={'ГодДеньНедели'}>}Себестоимость),'# ##0,00%')
label:Коэф обсл факт, % пред. (1) Год тот же день недели
comment: Коэффициент обслуживания факт, % за предыдущий тот же день недели год
---
set: ПроцентКоэфОбслуживанияФактПредГодДеньНедели
definition: Money($(КоэфОбслуживанияФакт)/$(КоэфОбслуживанияФактПредГодДеньНедели),'# ##0,00%')
label:% изм.Коэф обсл факт, % к пред. (1) Год тот же день недели
comment: Процент коэффициента обслуживания факт, % к предыдущему году тот же день недели
---
set: СуммаРостаКоэфОбслуживанияФактПредГодДеньНедели
definition: Money($(КоэфОбслуживанияФакт)-$(КоэфОбслуживанияФактПредГодДеньНедели),'# ##0,00%')
label:∆ изм. Коэф обсл факт, % к пред. (1) Год тот же день недели
comment: Сумма роста коэффициента обслуживания факт, % к предыдущему году тот же день недели
---
set: КоэфОбслуживанияФактПредГод2ДеньНедели
definition: Money(Max({<ТипДокумента = {'PlanKO'},_ФлагДействующаяДата={1},ТипПериода={'Год2ДеньНедели'}>}Себестоимость),'# ##0,00%')
label:Коэф обсл факт, % пред. (2) Год тот же день недели
comment: Коэффициент обслуживания факт, % за предпредыдущий тот же день недели год 
---
set: ПроцентКоэфОбслуживанияФактПредГод2ДеньНедели
definition: Money($(КоэфОбслуживанияФакт)/$(КоэфОбслуживанияФактПредГод2ДеньНедели),'# ##0,00%')
label:% изм.Коэф обсл факт, % к пред. (2) Год тот же день недели
comment: Процент коэффициента обслуживания факт, % к предпредыдущему году тот же день недели
---
set: СуммаРостаКоэфОбслуживанияФактПредГод2ДеньНедели
definition: Money($(КоэфОбслуживанияФакт)-$(КоэфОбслуживанияФактПредГод2ДеньНедели),'# ##0,00%')
label:∆ изм. Коэф обсл факт, % к пред. (2) Год тот же день недели
comment: Сумма роста коэффициента обслуживания факт, % к предпредыдущему году тот же день недели
---
set: КоэфТайПоПлан
definition: Money(Max({<_ФлагДействующаяДата={1},ТипДокумента={'PlanTP'},ТипПериода={'Current'}>} Сумма),'# ##0,00%')
label: Коэф ТайПо план, %
comment: Коэффициент тайный покупатель план, %
---
set: КоэфТайПо
definition: Money(Max({<_ФлагДействующаяДата={1},ТипДокумента={'PlanTP'},ТипПериода={'Current'}>} Себестоимость	),'# ##0,00%')
label: Коэф ТайПо факт, %
comment: Коэффициент тайный покупатель факт, %
---
set: ПФ_КоэфТайПо
definition: Money($(КоэфТайПо)/$(КоэфТайПоПлан),'# ##0,00%')
label:% вып ТайПо
comment: Факт отнесенный к плану по тайному покупателю, %
---
set: П_Ф_КоэфТайПо
definition: Money(($(КоэфТайПо)-$(КоэфТайПоПлан)),'# ##0,00%')
label:∆ ПФ ТайПо
comment: План минус факт по тайному покупателю, %
---
set: КоэфТайПоПредГод
definition: Money(Max({<ТипДокумента = {'PlanTP'},_ФлагДействующаяДата={1},ТипПериода={'Год'}>}Себестоимость),'# ##0,00%')
label: Коэф ТайПо факт, % пред год
comment: Коэффициент тайный покупатель факт, % за предыдущий год  
---
set: ПроцентКоэфТайПоПредГод
definition: Money($(КоэфТайПо)/$(КоэфТайПоПредГод),'# ##0,00%')
label: % Коэф ТайПо факт, % к пред год
comment: Процент коэффициента тайный покупатель факт, % к предыдущему году
---
set: СуммаРостаКоэфТайПоПредГод
definition: Money($(КоэфТайПо)-$(КоэфТайПоПредГод),'# ##0,00')
label: Сумма роста Коэф ТайПо факт, % к пред год
comment: Сумма роста коэффициента тайный покупатель факт, % к предыдущему году
---
set: КоэфТайПоПредМес
definition: Money(Max({<ТипДокумента = {'PlanTP'},_ФлагДействующаяДата={1},ТипПериода={'ГодМесяц'}>}Себестоимость),'# ##0,00%')
label: Коэф ТайПо факт, % пред мес
comment: Коэффициент тайный покупатель факт, % за предыдущий мес 
---
set: ПроцентКоэфТайПоПредМес
definition: Money($(КоэфТайПо)/$(КоэфТайПоПредМес),'# ##0,00%')
label: % Коэф ТайПо факт, % к пред мес
comment: Процент коэффициента тайный покупатель факт, % к предыдущему месяцу
---
set: СуммаРостаКоэфТайПоПредМес
definition: Money($(КоэфТайПо)-$(КоэфТайПоПредМес),'# ##0,00%')
label: Сумма роста Коэф ТайПо факт, % к пред мес
comment: Сумма роста коэффициента тайный покупатель факт, % к предыдущему месяцу
---
set: КоэфТайПоПредГодДеньНедели
definition: Money(Max({<ТипДокумента = {'PlanTP'},_ФлагДействующаяДата={1},ТипПериода={'ГодДеньНедели'}>}Себестоимость),'# ##0,00%')
label:Коэф ТайПо факт, % пред. (1) Год тот же день недели
comment: Коэффициент тайный покупатель факт, % за предыдущий тот же день недели год
---
set: ПроцентКоэфТайПоПредГодДеньНедели
definition: Money($(КоэфТайПо)/$(КоэфТайПоПредГодДеньНедели),'# ##0,00%')
label:% изм.Коэф ТайПо факт, % к пред. (1) Год тот же день недели
comment: Процент коэффициента тайный покупатель факт, % к предыдущему году тот же день недели
---
set: СуммаРостаКоэфТайПоПредГодДеньНедели
definition: Money($(КоэфТайПо)-$(КоэфТайПоПредГодДеньНедели),'# ##0,00%')
label:∆ изм. Коэф ТайПо факт, % к пред. (1) Год тот же день недели
comment: Сумма роста коэффициента тайный покупатель факт, % к предыдущему году тот же день недели
---
set: КоэфТайПоПредГод2ДеньНедели
definition: Money(Max({<ТипДокумента = {'PlanTP'},_ФлагДействующаяДата={1},ТипПериода={'Год2ДеньНедели'}>}Себестоимость),'# ##0,00%')
label:Коэф обсл ТайПо, % пред. (2) Год тот же день недели
comment: Коэффициент тайный покупатель факт, % за предпредыдущий тот же день недели год 
---
set: ПроцентКоэфТайПоПредГод2ДеньНедели
definition: Money($(КоэфТайПо)/$(КоэфТайПоПредГод2ДеньНедели),'# ##0,00%')
label:% изм.Коэф обсл ТайПо, % к пред. (2) Год тот же день недели
comment: Процент коэффициента тайный покупатель факт, % к предпредыдущему году тот же день недели
---
set: СуммаРостаКоэфТайПоПредГод2ДеньНедели
definition: Money($(КоэфТайПо)-$(КоэфТайПоПредГод2ДеньНедели),'# ##0,00%')
label:∆ изм. Коэф ТайПо факт, % к пред. (2) Год тот же день недели
comment: Сумма роста коэффициента тайный покупатель факт, % к предпредыдущему году тот же день недели
---
set: КоэфISEПлан
definition: Money(Max({<_ФлагДействующаяДата={1},ТипДокумента={'PlanISE'},ТипПериода={'Current'}>} Сумма),'# ##0,00%')
label: Коэф ISE план, %
comment: Коэффициент ISE план, %
---
set: КоэфISE
definition: Money(Max({<_ФлагДействующаяДата={1},ТипДокумента={'PlanISE'},ТипПериода={'Current'}>} Себестоимость),'# ##0')
label: Коэф ISE факт, выполнен или нет
comment: Коэффициент ISE факт, выполнен или нет
---
set: ПФ_КоэфISE
definition: Money($(КоэфISE)/$(КоэфISEПлан),'# ##0,0%')
label:% вып ISE
comment: Факт отнесенный к плану по ISE, %
---
set: П_Ф_ISE
definition: Money(($(КоэфISE)-$(КоэфISEПлан)),'# ##0,00%')
label:∆ ПФ ISE
comment: План минус факт по ISE, %
---
set: КоэфISEПредГод
definition: Money(Max({<ТипДокумента = {'PlanISE'},_ФлагДействующаяДата={1},ТипПериода={'Год'}>}Себестоимость),'# ##0,00%')
label: Коэф ISE факт, % пред год
comment: Коэффициент ISE факт, % за предыдущий год  
---
set: ПроцентКоэфISEПредГод
definition: Money($(КоэфISE)/$(КоэфISEПредГод),'# ##0,00%')
label: % Коэф ISE факт, % к пред год
comment: Процент коэффициента ISE факт, % к предыдущему году
---
set: СуммаРостаКоэфISEПредГод
definition: Money($(КоэфISE)-$(КоэфISEПредГод),'# ##0,00')
label: Сумма роста Коэф ISE факт, % к пред год
comment: Сумма роста коэффициента ISE факт, % к предыдущему году
---
set: КоэфISEПредМес
definition: Money(Max({<ТипДокумента = {'PlanISE'},_ФлагДействующаяДата={1},ТипПериода={'ГодМесяц'}>}Себестоимость),'# ##0,00%')
label: Коэф ISE факт, % пред мес
comment: Коэффициент ISE факт, % за предыдущий мес 
---
set: ПроцентКоэфISEПредМес
definition: Money($(КоэфISE)/$(КоэфISEПредМес),'# ##0,00%')
label: % Коэф ISE факт, % к пред мес
comment: Процент коэффициента ISE факт, % к предыдущему месяцу
---
set: СуммаРостаКоэфISEПредМес
definition: Money($(КоэфISE)-$(КоэфISEПредМес),'# ##0,00%')
label: Сумма роста Коэф ISE факт, % к пред мес
comment: Сумма роста коэффициента ISE факт, % к предыдущему месяцу
---
set: КоэфISEПредГодДеньНедели
definition: Money(Max({<ТипДокумента = {'PlanISE'},_ФлагДействующаяДата={1},ТипПериода={'ГодДеньНедели'}>}Себестоимость),'# ##0,00%')
label:Коэф ISE факт, % пред. (1) Год тот же день недели
comment: Коэффициент ISE факт, % за предыдущий тот же день недели год
---
set: ПроцентКоэфISEПредГодДеньНедели
definition: Money($(КоэфISE)/$(КоэфISEПредГодДеньНедели),'# ##0,00%')
label:% изм.Коэф ISE факт, % к пред. (1) Год тот же день недели
comment: Процент коэффициента ISE факт, % к предыдущему году тот же день недели
---
set: СуммаРостаКоэфISEПредГодДеньНедели
definition: Money($(КоэфISE)-$(КоэфISEПредГодДеньНедели),'# ##0,00%')
label:∆ изм. Коэф ISE факт, % к пред. (1) Год тот же день недели
comment: Сумма роста коэффициента ISE факт, % к предыдущему году тот же день недели
---
set: КоэфISEПредГод2ДеньНедели
definition: Money(Max({<ТипДокумента = {'PlanISE'},_ФлагДействующаяДата={1},ТипПериода={'Год2ДеньНедели'}>}Себестоимость),'# ##0,00%')
label:Коэф обсл ISE, % пред. (2) Год тот же день недели
comment: Коэффициент ISE факт, % за предпредыдущий тот же день недели год 
---
set: ПроцентКоэфISEПредГод2ДеньНедели
definition: Money($(КоэфISE)/$(КоэфISEПредГод2ДеньНедели),'# ##0,00%')
label:% изм.Коэф обсл ISE, % к пред. (2) Год тот же день недели
comment: Процент коэффициента ISE факт, % к предпредыдущему году тот же день недели
---
set: СуммаРостаКоэфISEПредГод2ДеньНедели
definition: Money($(КоэфISE)-$(КоэфISEПредГод2ДеньНедели),'# ##0,00%')
label:∆ изм. Коэф ISE факт, % к пред. (2) Год тот же день недели
comment: Сумма роста коэффициента ISE факт, % к предпредыдущему году тот же день недели

#SECTION :Сезонность
---
set: Сезонность
definition: Money(Max({<_ФлагДействующаяДата={1},ТипДокумента={'Season'},ТипПериода={'Current'},ШкалаЛиквидностиИсторическая,Склад>} Сумма),'# ##0,00')
label: Сезонность
comment: Сезонность (коэффициент, помесячно)
---
set: СезонностьМесяцВперед
definition: Money(Max({<ТипДокумента = {'Season'},_ФлагДействующаяДата={1},
				ТипПериода={'ГодМесяцВперед'},ШкалаЛиквидностиИсторическая,Склад>}Сумма),'# ##0,00')
label: Сезонность сл. месяц
comment: Сезонность в сл. месяце (коэффициент, помесячно)
---
set: СуммаРостаСезонностьМесяцВперед
definition: Money($(СезонностьМесяцВперед)-$(Сезонность),'# ##0,00')
label:∆ изм. сезонность сл. месяц
comment: Сумма изменений сезонность в сл. месяце (коэффициент, помесячно)
---
set: ПроцентСезонностьМесяцВперед
definition: Money($(СезонностьМесяцВперед)/$(Сезонность),'# ##0,00%')
label:% изм.Продаж к сл. месяцу
comment: Процент изменений сезонность к сл. месяце (коэффициент, помесячно)
---
#SECTION :Излишки
---
set: ОстаткиИзлишки540
definition: Money(Sum({<ТипПериода={'Current'},ТипДокумента={'OnHandEoM'},ПризнакИзлишкиИсторический={'Излишки 540'},$(СбросФильтраПоОстаткам)>} Себестоимость)/1000,'# ##0,00')
label: Излишки 540 по себестоимости на конец месяца, тыс.руб.
comment: Излишки 540 по себестоимости на конец месяца, тыс.руб.
---
set: ОстаткиИзлишки540ПредМес
definition: Money(Sum({<ТипПериода={'ГодМесяц'},ТипДокумента={'OnHandEoM'},ПризнакИзлишкиИсторический={'Излишки 540'},$(СбросФильтраПоОстаткам)>} Себестоимость)/1000,'# ##0,00')
label: Излишки 540 по себестоимости на конец пред мес, тыс.руб.
comment: Излишки 540 по себестоимости на конец предыдущего месяца, тыс.руб.
---
set: СуммаРостаОстаткиИзлишки540ПредМес
definition: Money($(ОстаткиИзлишки540)-$(ОстаткиИзлишки540ПредМес),'# ##0,00')
label: Сумма роста Излишки 540 по себестоимости на конец месяца, тыс.руб. к пред мес
comment: Сумма роста Излишки 540 по себестоимости на конец месяца, тыс.руб. к предыдущему месяцу
---
set: ОстаткиИзлишки540ПредГод
definition: Money(Sum({<ТипПериода={'Год'},ТипДокумента={'OnHandEoM'},ПризнакИзлишкиИсторический={'Излишки 540'},$(СбросФильтраПоОстаткам)>} Себестоимость)/1000,'# ##0,00')
label:Излишки 540 по себестоимости на конец месяца, тыс.руб. пред. (1) Год
comment: Излишки 540 по себестоимости на конец месяца, тыс.руб. за пред год
---
set: ПроцентОстаткиИзлишки540ПредГод
definition: Money($(ОстаткиИзлишки540)/$(ОстаткиИзлишки540ПредГод),'# ##0,00%')
label:% изм. Излишки 540 по себестоимости на конец месяца, тыс.руб. к пред. (1) Год
comment: Процент от Излишки 540 по себестоимости на конец месяца, тыс.руб. к предыдущему году
---
set: СуммаРостаОстаткиИзлишки540ПредГод
definition: Money($(ОстаткиИзлишки540)-$(ОстаткиИзлишки540ПредГод),'# ##0,00%')
label:∆ изм. Излишки 540по себестоимости на конец месяца, тыс.руб. к пред. (1) Год
comment: Изменение Излишки 540 по себестоимости на конец месяца, тыс.руб. к предыдущему году
---
set: ОстаткиИзлишки540ПредГод2
definition: Money(Sum({<ТипПериода={'Год-2'},ТипДокумента={'OnHandEoM'},ПризнакИзлишкиИсторический={'Излишки 540'},$(СбросФильтраПоОстаткам)>} Себестоимость)/1000,'# ##0,00')
label:Излишки 540 по себестоимости на конец месяца, тыс.руб. пред. (2) Год
comment: Излишки 540по себестоимости на конец месяца, тыс.руб. за предпред год
---
set: ПроцентОстаткиИзлишки540ПредГод2
definition: Money($(ОстаткиИзлишки540)/$(ОстаткиИзлишки540ПредГод2),'# ##0,00%')
label:% изм. Излишки 540 по себестоимости на конец месяца, тыс.руб. к пред. (2) Год
comment: Процент Излишки 540 по себестоимости на конец месяца, тыс.руб. к предпредыдущему году
---
set: СуммаРостаОстаткиИзлишки540ПредГод2
definition: Money($(ОстаткиИзлишки540)-$(ОстаткиИзлишки540ПредГод2),'# ##0,00%')
label:∆ изм. Излишки по себестоимости на конец месяца, тыс.руб. к пред. (2) Год
comment: Изменение Излишки по себестоимости на конец месяца, тыс.руб. к предпредыдущему году
---
set: ОстаткиИзлишки90
definition: Money(Sum({<ТипПериода={'Current'},ТипДокумента={'OnHandEoM'},ПризнакИзлишкиИсторический={'Излишки 90'},$(СбросФильтраПоОстаткам)>} Себестоимость)/1000,'# ##0,00')
label: Излишки 90 по себестоимости на конец месяца, тыс.руб.
comment: Излишки 90 по себестоимости на конец месяца, тыс.руб.
---
set: ОстаткиИзлишки90ПредМес
definition: Money(Sum({<ТипПериода={'ГодМесяц'},ТипДокумента={'OnHandEoM'},ПризнакИзлишкиИсторический={'Излишки 90'},$(СбросФильтраПоОстаткам)>} Себестоимость)/1000,'# ##0,00')
label: Излишки 90 по себестоимости на конец пред мес, тыс.руб.
comment: Излишки 90 по себестоимости на конец предыдущего месяца, тыс.руб.
---
set: СуммаРостаОстаткиИзлишки90ПредМес
definition: Money($(ОстаткиИзлишки540)-$(ОстаткиИзлишки540ПредМес),'# ##0,00')
label: Сумма роста Излишки 90 по себестоимости на конец месяца, тыс.руб. к пред мес
comment: Сумма роста Излишки 90 по себестоимости на конец месяца, тыс.руб. к предыдущему месяцу
---
set: ОстаткиИзлишки90ПредГод
definition: Money(Sum({<ТипПериода={'Год'},ТипДокумента={'OnHandEoM'},ПризнакИзлишкиИсторический={'Излишки 90'},$(СбросФильтраПоОстаткам)>} Себестоимость)/1000,'# ##0,00')
label:Излишки 90 по себестоимости на конец месяца, тыс.руб. пред. (1) Год
comment: Излишки 90 по себестоимости на конец месяца, тыс.руб. за пред год
---
set: ПроцентОстаткиИзлишки90ПредГод
definition: Money($(ОстаткиИзлишки540)/$(ОстаткиИзлишки540ПредГод),'# ##0,00%')
label:% изм. Излишки 90 по себестоимости на конец месяца, тыс.руб. к пред. (1) Год
comment: Процент от Излишки 90 по себестоимости на конец месяца, тыс.руб. к предыдущему году
---
set: СуммаРостаОстаткиИзлишки90ПредГод
definition: Money($(ОстаткиИзлишки540)-$(ОстаткиИзлишки540ПредГод),'# ##0,00%')
label:∆ изм. Излишки 90 по себестоимости на конец месяца, тыс.руб. к пред. (1) Год
comment: Изменение Излишки 90 по себестоимости на конец месяца, тыс.руб. к предыдущему году
---
set: ОстаткиИзлишки90ПредГод2
definition: Money(Sum({<ТипПериода={'Год-2'},ТипДокумента={'OnHandEoM'},ПризнакИзлишкиИсторический={'Излишки 90'},$(СбросФильтраПоОстаткам)>} Себестоимость)/1000,'# ##0,00')
label:Излишки 90 по себестоимости на конец месяца, тыс.руб. пред. (2) Год
comment: Излишки 90 по себестоимости на конец месяца, тыс.руб. за предпред год
---
set: ПроцентОстаткиИзлишки90ПредГод2
definition: Money($(ОстаткиИзлишки540)/$(ОстаткиИзлишки540ПредГод2),'# ##0,00%')
label:% изм. Излишки 90 по себестоимости на конец месяца, тыс.руб. к пред. (2) Год
comment: Процент Излишки 90 по себестоимости на конец месяца, тыс.руб. к предпредыдущему году
---
set: СуммаРостаОстаткиИзлишки90ПредГод2
definition: Money($(ОстаткиИзлишки540)-$(ОстаткиИзлишки540ПредГод2),'# ##0,00%')
label:∆ изм. Излишки 90 по себестоимости на конец месяца, тыс.руб. к пред. (2) Год
comment: Изменение Излишки 90 по себестоимости на конец месяца, тыс.руб. к предпредыдущему году
---
set: ОстаткиИзлишки540НаКонецМесяца
definition: Money(Sum({<ТипПериода={'Current'},ТипДокумента={'OnHandEoM'},ПризнакИзлишкиИсторический={'Излишки 540'},$(СбросФильтраПоОстаткам),_МесяцПоПорядку={'$(=Max({<_ФлагДействующаяДата={1}>} _МесяцПоПорядку))'}>} Себестоимость)/1000,'# ##0,00')
label: Излишки 540 по себестоимости на конец месяца, тыс.руб.
comment: Излишки 540 по себестоимости на конец месяца, тыс.руб.
---
set: ОстаткиИзлишки540ПредМесНаКонецМесяца
definition: Money(Sum({<ТипПериода={'ГодМесяц'},ТипДокумента={'OnHandEoM'},ПризнакИзлишкиИсторический={'Излишки 540'},$(СбросФильтраПоОстаткам),_МесяцПоПорядку={'$(=Max({<_ФлагДействующаяДата={1}>} _МесяцПоПорядку))'}>} Себестоимость)/1000,'# ##0,00')
label: Излишки 540 по себестоимости на конец пред мес, тыс.руб.
comment: Излишки 540 по себестоимости на конец предыдущего месяца, тыс.руб.
---